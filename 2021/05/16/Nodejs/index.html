<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Nodejs | ������</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="张丽超个人博客" />
  
  <meta name="description" content="Node.js1、为什么要学习node？企业需求​        全栈（gan）工程师 ​        front-end（前端） ​        back-end（后端）​                node就是后端 基本的网站开发能力​        服务端 ​        前端 ​        运维部署能力 2、Node是什么？一般后端语言是什么​    java ​    py">
<meta property="og:type" content="article">
<meta property="og:title" content="Nodejs">
<meta property="og:url" content="http://example.com/2021/05/16/Nodejs/index.html">
<meta property="og:site_name" content="������">
<meta property="og:description" content="Node.js1、为什么要学习node？企业需求​        全栈（gan）工程师 ​        front-end（前端） ​        back-end（后端）​                node就是后端 基本的网站开发能力​        服务端 ​        前端 ​        运维部署能力 2、Node是什么？一般后端语言是什么​    java ​    py">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92%E5%9B%BE.png">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/node/2.png">
<meta property="og:image" content="f:/桌面文件/node/3.png">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/node/4.png">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/5.png">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/6.png">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/7.png">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/8.png">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/9.png">
<meta property="og:image" content="d:/东软广州/nodeNote/11.png">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/14.png">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/13.png">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93.png">
<meta property="og:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93.png">
<meta property="og:image" content="f:/桌面文件/node/15.png">
<meta property="og:image" content="d:/东软广州/nodeNote/hadouken-code.jpg">
<meta property="og:image" content="f:/桌面文件/node/promise.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/13610935-1d33c08b39a5c501.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/814/format/webp">
<meta property="article:published_time" content="2021-05-16T02:32:05.000Z">
<meta property="article:modified_time" content="2021-10-16T02:37:07.854Z">
<meta property="article:author" content="ZhangLichao">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/05/16/Nodejs/Nodejs/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92%E5%9B%BE.png">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>

  

  
  

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">ZhangLichao&#39;s Blog</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="/">
                        <i class="fa fa-home"></i>
                        <span>首页</span>
                    </a>
                    
                    <a  href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>归档</span>
                    </a>
                    
                    <a  href="/about">
                        <i class="fa fa-user"></i>
                        <span>关于我</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        ZhangLichao&#39;s Blog
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        一个专注 WEB 开发的技术博客
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-Nodejs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      Nodejs
    </h1>
    <div class="post-title-bar">
      <ul>
          
        <li>
          <i class="fa fa-calendar"></i>  2021-05-16
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <h1 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h1><h2 id="1、为什么要学习node？"><a href="#1、为什么要学习node？" class="headerlink" title="1、为什么要学习node？"></a>1、为什么要学习node？</h2><h4 id="企业需求"><a href="#企业需求" class="headerlink" title="企业需求"></a>企业需求</h4><p>​        全栈（gan）工程师</p>
<p>​        front-end（前端）</p>
<p>​        back-end（后端）<br>​                node就是后端</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="./Nodejs/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92%E5%9B%BE.png" alt="前后端交互图"></h2><h4 id="基本的网站开发能力"><a href="#基本的网站开发能力" class="headerlink" title="基本的网站开发能力"></a>基本的网站开发能力</h4><p>​        服务端</p>
<p>​        前端</p>
<p>​        运维部署能力</p>
<h2 id="2、Node是什么？"><a href="#2、Node是什么？" class="headerlink" title="2、Node是什么？"></a>2、Node是什么？</h2><h4 id="一般后端语言是什么"><a href="#一般后端语言是什么" class="headerlink" title="一般后端语言是什么"></a>一般后端语言是什么</h4><p>​    java</p>
<p>​    python</p>
<p>​    php</p>
<p>​    Ruby</p>
<p>​    .net(c#)</p>
<p>​    …..</p>
<p>​    <strong>node.js</strong></p>
<h2 id="3、Node介绍"><a href="#3、Node介绍" class="headerlink" title="3、Node介绍"></a>3、Node介绍</h2><p><u>凡是能用js实现的，最终都会用js来实现</u></p>
<p>node官网：<a target="_blank" rel="noopener" href="https://nodejs.org/en/">https://nodejs.org/en/</a></p>
<p>​    node不是一门语言</p>
<p>​    node不是库，不是框架</p>
<p>​    node是一个js运行时环境</p>
<p>​    也就是说node可以解析和执行js代码</p>
<p>​    以前只有浏览器可以解析执行js代码</p>
<p>​    也就是说现在的js可以脱离浏览器来运行</p>
<h4 id="浏览器中的js"><a href="#浏览器中的js" class="headerlink" title="浏览器中的js"></a>浏览器中的js</h4><p>ECMAScript：if，var ，function，object，Array等</p>
<p>Bom 浏览器操作 (获取窗口宽高等等)</p>
<p>Dom  节点操作(createElement,removeElement)</p>
<h4 id="Node中的js"><a href="#Node中的js" class="headerlink" title="Node中的js"></a>Node中的js</h4><p>没有BOM，DOM，只有ECMAScript，因为服务端不操作页面</p>
<p>但是在node这个js运行环境中也提供了一些浏览器端所没有，服务端特有的API：</p>
<p>文件读写</p>
<p>网络服务的构建</p>
<p>网络通信</p>
<p>http服务器</p>
<p>……</p>
<p>node就是web服务器开发</p>
<h4 id="node特点"><a href="#node特点" class="headerlink" title="node特点"></a>node特点</h4><p>Node.js® is a JavaScript runtime built on Chrome’s V8 JavaScript engine.node基于chrome V8引擎（v8引擎是目前公认最快的引擎）</p>
<p>​    event-driven事件驱动</p>
<p>​    non-blocking I/Omodel非阻塞I/O模型（异步）</p>
<p>​    lightweight and efficient 轻量和高效</p>
<p>​    有npm包生态系统（会装包就行）</p>
<p>​    npm：基于node的包安装工具，世界上最大的开源生态系统</p>
<p>​    绝大多数js相关的包都可以在npm上下载</p>
<p>比如<code>npm install jquery</code></p>
<h4 id="node介绍"><a href="#node介绍" class="headerlink" title="node介绍"></a>node介绍</h4><ul>
    <li>Web服务器后台</li>
    <li>命令行工具</li>
</ul>

<p>对于前端工程师来将，我们接触node 最多的就是其命令行工具</p>
<p>自己写的很少，主要是使用别人第三方的</p>
<p>比如webpack，gulp，npm等</p>
<h4 id="node预备知识"><a href="#node预备知识" class="headerlink" title="node预备知识"></a>node预备知识</h4><p>html，css，js</p>
<p>简单的命令行操作cd，dir，ls，mkdir，rmdir（删除）</p>
<h4 id="推荐一些资源"><a href="#推荐一些资源" class="headerlink" title="推荐一些资源"></a>推荐一些资源</h4><p>《深入浅出Node》朴灵</p>
<p>​    （偏理论，纯底层，不推荐现在看）</p>
<p>《Node.js权威指南》</p>
<p>​    （API讲解，也没有业务偏理论）</p>
<p>《node入门》http:<a target="_blank" rel="noopener" href="http://www.nodebeginner.org/index-zh-ch.html">www.nodebeginner.org/index-zh-ch.html</a></p>
<h4 id="这门课程能学到啥"><a href="#这门课程能学到啥" class="headerlink" title="这门课程能学到啥"></a>这门课程能学到啥</h4><h5 id="B-S编程模型"><a href="#B-S编程模型" class="headerlink" title="B/S编程模型"></a>B/S编程模型</h5><p>Browser-Server浏览器服务器</p>
<p>back-end后台</p>
<p>任何服务端技术这种BS模型都是一样的，和语言无关</p>
<p>node只是作为我们学会BS的一个工具而已</p>
<h5 id="模块化编程"><a href="#模块化编程" class="headerlink" title="模块化编程"></a>模块化编程</h5><p>Require.js<br>​        <code>@import(&#39;文件路径&#39;）</code><br>​        以前我们认知的JavaScript只能通过script标签来加载<br>​        在node中可以像@import()一样来加载js脚本文件</p>
<h5 id="Node常用API"><a href="#Node常用API" class="headerlink" title="Node常用API"></a>Node常用API</h5><h5 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h5><p>回调函数</p>
<p>Promise</p>
<p>async</p>
<p>generator</p>
<h5 id="Express-Web开发框架"><a href="#Express-Web开发框架" class="headerlink" title="Express Web开发框架"></a>Express Web开发框架</h5><h5 id="ECMAScript6"><a href="#ECMAScript6" class="headerlink" title="ECMAScript6"></a>ECMAScript6</h5><p>学习node不仅会打开服务端黑盒，同时会帮助我们学习前端高级内容vue，react，angular等</p>
<h2 id="4、Node环境安装"><a href="#4、Node环境安装" class="headerlink" title="4、Node环境安装"></a>4、Node环境安装</h2><h4 id="先查看是否已经安装node"><a href="#先查看是否已经安装node" class="headerlink" title="先查看是否已经安装node"></a>先查看是否已经安装node</h4><p>命令行输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node --version</span><br></pre></td></tr></table></figure>

<p>来查看node版本，如果已经有node，那么可以升级</p>
<p>无论已经有了，还是没有，都需要下载</p>
<h5 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h5><p>LTS版：长期支持版（稳定版）</p>
<p>Current：体验版</p>
<p>点击下载即可</p>
<h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><p>傻瓜式一路next</p>
<p>已有node，会升级成新版本，没有会安装</p>
<p>再次查看版本</p>
<h2 id="5、使用Node执行js脚本"><a href="#5、使用Node执行js脚本" class="headerlink" title="5、使用Node执行js脚本"></a>5、使用Node执行js脚本</h2><p>创建编写js脚本</p>
<p>打开终端定位到脚本文件所属目录</p>
<p>输入node文件名执行对应的文件</p>
<p>要注意：不能使用node作为js文件的名字</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node.js<span class="comment">//错误</span></span><br></pre></td></tr></table></figure>

<p>也最好不要使用除了英文与数字以外的字符</p>
<h2 id="6、Hello，Node！"><a href="#6、Hello，Node！" class="headerlink" title="6、Hello，Node！"></a>6、Hello，Node！</h2><p>验证一下node中是不是真的没有window和document</p>
<p>//浏览器中的JavaScript是没有文件操作能力的</p>
<p>但是node中的JavaScript具有文件操作的能力</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//浏览器中的JavaScript是没有文件操作能力的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//但是node中的JavaScript具有文件操作的能力</span></span><br><span class="line"><span class="comment">//fs是file-system的简写,就是文件系统的意思</span></span><br><span class="line"><span class="comment">//在Node中，如果想要进行文件操作，就必须引入fs这个核心模块</span></span><br><span class="line"><span class="comment">//在fs这个核心模块中，提供了所有的文件操作相关的API</span></span><br><span class="line"><span class="comment">//例如：fs.readFile就是用来读取文件的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.使用require方法加载fs核心模块</span></span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="comment">//2.读取文件</span></span><br><span class="line">	<span class="comment">//第一个参数是要读取的文件路径</span></span><br><span class="line">	<span class="comment">//第二个参数是一个回调函数</span></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		读取成功</span></span><br><span class="line"><span class="comment">			data 是读取到的数据</span></span><br><span class="line"><span class="comment">			error null</span></span><br><span class="line"><span class="comment">		读取失败</span></span><br><span class="line"><span class="comment">			data null</span></span><br><span class="line"><span class="comment">			error 错误对象</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">fs.readFile(<span class="string">&#x27;hello.txt&#x27;</span>，<span class="function"><span class="keyword">function</span> (<span class="params">error,data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 回调函数里的两个参数，第一个是错误对象，第二个是数据，位置不可以颠倒</span></span><br><span class="line">	<span class="built_in">console</span>.log(data.toString())</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="7、写文件和简单的错误处理"><a href="#7、写文件和简单的错误处理" class="headerlink" title="7、写文件和简单的错误处理"></a>7、写文件和简单的错误处理</h2><h3 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="comment">//第一个参数：文件路径</span></span><br><span class="line"><span class="comment">//第二个参数：文件内容</span></span><br><span class="line"><span class="comment">// 第三个参数：回调函数</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	error</span></span><br><span class="line"><span class="comment">	成功：文件写入成功</span></span><br><span class="line"><span class="comment">		error是null</span></span><br><span class="line"><span class="comment">	失败：文件写入失败 </span></span><br><span class="line"><span class="comment">		error是错误对象</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">fs.writeFile(<span class="string">&#x27;Hello.txt&#x27;</span>,<span class="string">&#x27;大家好，我是node&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;文件写入成功&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>新写入的内容将原来的内容覆盖掉</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="comment">//第一个参数：文件路径</span></span><br><span class="line"><span class="comment">//第二个参数：文件内容</span></span><br><span class="line"><span class="comment">// 第三个参数：回调函数</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	error</span></span><br><span class="line"><span class="comment">	成功：文件写入成功</span></span><br><span class="line"><span class="comment">		error是null</span></span><br><span class="line"><span class="comment">	失败：文件写入失败 </span></span><br><span class="line"><span class="comment">		error是错误对象</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">fs.writeFile(<span class="string">&#x27;Hello.txt&#x27;</span>,<span class="string">&#x27;大家好，我是node&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;文件写入成功&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">fs.readFile(<span class="string">&quot;Hello.txt&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">error,data</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(data.toString())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="./Nodejs/node/2.png" alt="2"></p>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">fs.readFile(<span class="string">&quot;Hello2.txt&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">error,data</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//注意此时我们要读的是Hello2.txt，此文件并不存在</span></span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/*if（第一个参数文件路径==true）&#123;</span></span><br><span class="line"><span class="comment">	把原来的内容覆盖掉</span></span><br><span class="line"><span class="comment">&#125;else&#123;</span></span><br><span class="line"><span class="comment">	在该路径下新建该文件</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br></pre></td></tr></table></figure>

<p><img src="F:/桌面文件/node/3.png" alt="3.png"></p>
<p>此时Hello2.txt并不存在，所以读取并不成功，在这里报undefined，而实际上这里应该是一个错误。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">fs.readFile(<span class="string">&quot;Hello2.txt&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">error,data</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//注意此时我们要读的是Hello2.txt，此文件并不存在</span></span><br><span class="line">	<span class="built_in">console</span>.log(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="./Nodejs/node/4.png"></p>
<p>通过判断error是否存在，来确认是否有错误</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">fs.readFile(<span class="string">&quot;Hello2.txt&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">error,data</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//注意此时我们要读的是Hello2.txt，此文件并不存在</span></span><br><span class="line">	<span class="built_in">console</span>.log(error)</span><br><span class="line">	<span class="keyword">if</span> (error) &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&quot;读取文件失败&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">		<span class="built_in">console</span>.log(data.toString())</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>写入错误也类似</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">fs.writeFile(<span class="string">&quot;Hello2***.txt&quot;</span>,<span class="string">&quot;大家好，我是node&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//注意此时我们要读的是Hello2***.txt，windows系统不允许文件名中有“*”，所以本次写入会失败</span></span><br><span class="line">	<span class="built_in">console</span>.log(error)</span><br><span class="line">	<span class="keyword">if</span> (error) &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&quot;读取文件失败&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="./Nodejs/5.png"></p>
<h2 id="8、简单的http服务"><a href="#8、简单的http服务" class="headerlink" title="8、简单的http服务"></a>8、简单的http服务</h2><p>使用Node构建一个web服务器</p>
<p>用Node中的http模块搭建</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.加载http核心模块</span></span><br><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">// 2.使用htpp。createServer(	)创建一个web服务器</span></span><br><span class="line"><span class="comment">// 返回一个Server实例</span></span><br><span class="line"><span class="keyword">var</span> server=http.createServer();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.服务器的作用</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	提供服务：对数据的服务</span></span><br><span class="line"><span class="comment">	发送请求</span></span><br><span class="line"><span class="comment">	接受请求</span></span><br><span class="line"><span class="comment">	处理请求</span></span><br><span class="line"><span class="comment">	给个反馈（发送响应）</span></span><br><span class="line"><span class="comment">	注册request请求事件</span></span><br><span class="line"><span class="comment">	当客户端请求过来，自动触发服务器的request请求时间，然后执行第二个参数，：回调函数</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;受到客户端请求了&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 4.绑定端口号，启动服务器(凡是涉及到网络的，都有端口号)</span></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;服务器启动成功了，可以通过http:127.0.0.1:3000来进行访问&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>命令行启动</p>
<p><img src="./Nodejs/6.png"></p>
<p>此时在浏览器输入http:127.0.0.1:3000，再查看终端</p>
<p><img src="./Nodejs/7.png"></p>
<h2 id="9、发送响应"><a href="#9、发送响应" class="headerlink" title="9、发送响应"></a>9、发送响应</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server=http.createServer();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">request请求事件处理函数，需要接受两个参数</span></span><br><span class="line"><span class="comment">Request请求对象</span></span><br><span class="line"><span class="comment">	请求对象可以用来获取客户端的一些请求信息，例如请求路径</span></span><br><span class="line"><span class="comment">Response响应对象</span></span><br><span class="line"><span class="comment">	相对应对象可以用来给客户端发送响应消息	</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">request,response</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;收到客户端请求了,请求路径是：&quot;</span>+request.url)</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;服务器启动成功了，可以通过http:127.0.0.1:3000来进行访问&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>打开浏览器，输入<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/%EF%BC%8C%E5%86%8D%E6%9F%A5%E7%9C%8B%E7%BB%88%E7%AB%AF">http://127.0.0.1:3000/，再查看终端</a></p>
<p><img src="./Nodejs/8.png"></p>
<p>尝试把浏览器url修改成<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/a/b/c/d%E7%AD%89%EF%BC%8C%E6%88%91%E4%BB%AC%E4%BC%9A%E5%8F%91%E7%8E%B0%E7%BB%88%E7%AB%AF">http://127.0.0.1:3000/a/b/c/d等，我们会发现终端</a></p>
<p><img src="./Nodejs/9.png"></p>
<p>也就是说这里获取到的request就是我们浏览器url端口号后面的字符串</p>
<p>并且都是以“/”开头的</p>
<h2 id="10、根据不同请求路径返回不同数据"><a href="#10、根据不同请求路径返回不同数据" class="headerlink" title="10、根据不同请求路径返回不同数据"></a>10、根据不同请求路径返回不同数据</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server=http.createServer();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">request请求事件处理函数，需要接受两个参数</span></span><br><span class="line"><span class="comment">Request请求对象</span></span><br><span class="line"><span class="comment">	请求对象可以用来获取客户端的一些请求信息，例如请求路径</span></span><br><span class="line"><span class="comment">Response响应对象</span></span><br><span class="line"><span class="comment">	相对应对象可以用来给客户端发送响应消息	</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">request,response</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//console.log(&quot;受到客户端请求了,请求路径是：&quot;+request.url)</span></span><br><span class="line">	<span class="keyword">var</span> url=request.url;</span><br><span class="line">	<span class="keyword">if</span>(url===<span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line">		response.end(<span class="string">&quot;index page&quot;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(url===<span class="string">&#x27;/login&#x27;</span>)&#123;</span><br><span class="line">		response.end(<span class="string">&#x27;login page&#x27;</span>)</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		response.end(<span class="string">&#x27;404 page&#x27;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;服务器启动成功了，可以通过http:127.0.0.1:3000来进行访问&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server=http.createServer();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">request请求事件处理函数，需要接受两个参数</span></span><br><span class="line"><span class="comment">Request请求对象</span></span><br><span class="line"><span class="comment">	请求对象可以用来获取客户端的一些请求信息，例如请求路径</span></span><br><span class="line"><span class="comment">Response响应对象</span></span><br><span class="line"><span class="comment">	相对应对象可以用来给客户端发送响应消息	</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">request,response</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//console.log(&quot;受到客户端请求了,请求路径是：&quot;+request.url)</span></span><br><span class="line">	<span class="keyword">var</span> url=request.url;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(url===<span class="string">&#x27;/products&#x27;</span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> products=[</span><br><span class="line">			&#123;<span class="attr">name</span>:<span class="string">&quot;apple X&quot;</span>,<span class="attr">price</span>:<span class="string">&quot;8999&quot;</span>&#125;,</span><br><span class="line">			&#123;<span class="attr">name</span>:<span class="string">&quot;mate30 &quot;</span>,<span class="attr">price</span>:<span class="string">&quot;5999&quot;</span>&#125;,</span><br><span class="line">			&#123;<span class="attr">name</span>:<span class="string">&quot;mate40 pro&quot;</span>,<span class="attr">price</span>:<span class="string">&quot;12000&quot;</span>&#125;</span><br><span class="line">		];</span><br><span class="line">		response.end(<span class="built_in">JSON</span>.stringify(products))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;服务器启动成功了，可以通过http:127.0.0.1:3000来进行访问&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>response.end()里面只能是字符串或二进制，上述代码中的对象，转成字符串才可以。</p>
<h2 id="11、node中的js——核心模块"><a href="#11、node中的js——核心模块" class="headerlink" title="11、node中的js——核心模块"></a>11、node中的js——核心模块</h2><p>Node为js提供了很多服务器级别的API，这些API绝大多数都被包装到了一个具名的核心模块中了，例如文件操作的<code>fs</code>核心模块，http服务构建的http模块，<code>path</code>路径操作模块，<code>os</code>操作系统信息模块。。。</p>
<p>以后只要提到这个模块是核心模块，那么就要想到要使用它就要引用它</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)<span class="comment">//require方法引用fs这个核心模块</span></span><br></pre></td></tr></table></figure>

<p>打开官网文档，“File system”就是我们用到的这个“fs”模块</p>
<p><img src="D:\东软广州\nodeNote\11.png"></p>
<p>创建目录，mkdir</p>
<p>读目录，readdir</p>
<h2 id="上图箭头下面有我们在用的HTTP模块"><a href="#上图箭头下面有我们在用的HTTP模块" class="headerlink" title="上图箭头下面有我们在用的HTTP模块"></a>上图箭头下面有我们在用的HTTP模块</h2><p>还有<code>os</code>模块等，注意核心模块，要引用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> os=<span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>)<span class="comment">//用来获取机器信息</span></span><br><span class="line"><span class="built_in">console</span>.log(os.cpus())<span class="comment">//查看cpu信息</span></span><br><span class="line"><span class="built_in">console</span>.log(os.totalmem())<span class="comment">//获取当前机器的内存（字节bytes）</span></span><br></pre></td></tr></table></figure>

<p>在终端查看。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path=<span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)<span class="comment">//用来操作路径</span></span><br><span class="line"><span class="built_in">console</span>.log(path.extname(<span class="string">&#x27;c:a/b/c/d/e/f/hello.txt&#x27;</span>))<span class="comment">//读出文件后缀名</span></span><br></pre></td></tr></table></figure>

<p>extension name</p>
<p>核心模块有很多，常用的不超过5个</p>
<h2 id="12、node中的js——模块系统"><a href="#12、node中的js——模块系统" class="headerlink" title="12、node中的js——模块系统"></a>12、node中的js——模块系统</h2><p>浏览器中我们可以在html里引入多个js文件，但是在node里面，我们似乎只执行了一个js文件。</p>
<p>咋办呢？</p>
<p>​    我们在同一个文件夹下新建两个js文件，分别为<code>a.js</code>和<code>b.js</code></p>
<h4 id="a-js中的代码"><a href="#a-js中的代码" class="headerlink" title="a.js中的代码"></a>a.js中的代码</h4><p>require是一个方法<br>它的作用就是用来加载模块的，在node中，模块有三种：</p>
<ol>
<li> 具名的核心模块，比如“fs”，“http”</li>
<li> 用户自己编写的文件模块（本节重点讲）</li>
<li> 第三方的模块</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;a start&#x27;</span>)</span><br><span class="line"><span class="built_in">require</span> (<span class="string">&#x27;./b.js&#x27;</span>)<span class="comment">//注意在这里，必须以“./”或“../”开头</span></span><br><span class="line"><span class="built_in">require</span> (<span class="string">&#x27;./b&#x27;</span>)<span class="comment">//后缀可以省略</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;a end&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="b-js中的代码"><a href="#b-js中的代码" class="headerlink" title="b.js中的代码"></a>b.js中的代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;b文件被加载执行了&#x27;</span>)</span><br><span class="line"><span class="comment">// require(&#x27;./c.js&#x27;)</span></span><br><span class="line"><span class="comment">//我们也可以在这里继续调用c.js</span></span><br></pre></td></tr></table></figure>

<h3 id="在node中没有全局作用域，只有模块作用域"><a href="#在node中没有全局作用域，只有模块作用域" class="headerlink" title="在node中没有全局作用域，只有模块作用域"></a>在node中没有全局作用域，只有模块作用域</h3><p>在<code>a.js</code>中声明的变量variable，到b文件中仍然可以声明，二者不冲突，不覆盖</p>
<p>在a里面写的函数，在b中也不可以被调用</p>
<p>外部访问不到内部，内部也访问不到外部</p>
<p><strong>写写试试</strong></p>
<h4 id="为什么”-“不可以省略呢？"><a href="#为什么”-“不可以省略呢？" class="headerlink" title="为什么”./“不可以省略呢？"></a>为什么”./“不可以省略呢？</h4><h4 id="既然是模块作用域，默认都是封闭的，那如何让模块之间进行通信呢？"><a href="#既然是模块作用域，默认都是封闭的，那如何让模块之间进行通信呢？" class="headerlink" title="既然是模块作用域，默认都是封闭的，那如何让模块之间进行通信呢？"></a>既然是模块作用域，默认都是封闭的，那如何让模块之间进行通信呢？</h4><p>​    有时候，我们加载文件模块的目的不是为了简单的执行里面的代码，更重要的是为了使用里面的某个成员</p>
<p>新建<code>a.js</code>,<code>b.js</code></p>
<h4 id="a-js"><a href="#a-js" class="headerlink" title="a.js"></a>a.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// require方法有两个作用：</span></span><br><span class="line">    <span class="comment">// 加载文件模块并执行里面的代码</span></span><br><span class="line">    <span class="comment">// 拿到被家长文件模块导出的接口对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在每个文件模块中都提供了一个对象exports，它默认是一个空对象</span></span><br><span class="line"><span class="comment">// 我们要做的是把所有需要被外部访问的成员挂载到exports中</span></span><br><span class="line"><span class="keyword">var</span> bExports=<span class="built_in">require</span>(<span class="string">&#x27;./b&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(bExports.foo)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(bExports.add(<span class="number">1</span>,<span class="number">2</span>))<span class="comment">//调用b中的函数</span></span><br></pre></td></tr></table></figure>

<h4 id="b-js"><a href="#b-js" class="headerlink" title="b.js"></a>b.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo=<span class="string">&#x27;bbb&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.foo=<span class="string">&#x27;hello&#x27;</span><span class="comment">//把字符串挂到exports这个空对象中</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.add=<span class="function"><span class="keyword">function</span> (<span class="params">x,y</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x+y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 把函数挂载到exports这个空对象中</span></span><br></pre></td></tr></table></figure>

<p>查看执行结果</p>
<p>再将<code>b.js</code>代码做个修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo=<span class="string">&#x27;bbb&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.foo=<span class="string">&#x27;hello&#x27;</span><span class="comment">//把字符串挂到exports这个空对象中</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.add=<span class="function"><span class="keyword">function</span> (<span class="params">x,y</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x+y</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x-y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 把函数挂载到exports这个空对象中</span></span><br></pre></td></tr></table></figure>

<p>结果仍然与之前一致</p>
<h2 id="13、ip地址和端口号的概念"><a href="#13、ip地址和端口号的概念" class="headerlink" title="13、ip地址和端口号的概念"></a>13、ip地址和端口号的概念</h2><p>所有联网的程序都需要联网通信</p>
<p>计算机只有一个物理网卡，而且局域网中网卡的地址是唯一的</p>
<p>网卡必须是通过唯一的ip地址来进行定位</p>
<p>ip定位到计算机，而端口号定位到该计算机上的那个程序</p>
<p><em>发给大家我的ip地址，和端口号，查看访问我的用户的ip和port</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server=http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">request,response</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(request.socket.remoteAddress,request.socket.remotePort)</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;服务器启动成功了，可以通过http:127.0.0.1:3000来进行访问&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="14、端口号补充"><a href="#14、端口号补充" class="headerlink" title="14、端口号补充"></a>14、端口号补充</h2><ul>
<li>ip是用来定位计算机</li>
<li>端口号是用来定位具体的应用程序</li>
<li>一切需要联网通信的软件都会占用一个端口号</li>
<li>端口号的范围从0~65535</li>
<li>在计算机中有写默认端口号，最好不要去使用<ul>
<li>比如http服务的80。我们的网站上线部署的时候才使用80</li>
</ul>
</li>
<li>我们在开发过程中使用一些简单好记的比如3000，5000，8888等</li>
<li>可以同时开启多个服务，但是一定要确保不同服务占用的端口号不一致</li>
<li>在一台计算机中，同一个端口号在同一时间只能被同一个程序占用</li>
</ul>
<h2 id="15、响应式内容类型Content-type"><a href="#15、响应式内容类型Content-type" class="headerlink" title="15、响应式内容类型Content-type"></a>15、响应式内容类型Content-type</h2><h3 id="解决乱码问题"><a href="#解决乱码问题" class="headerlink" title="解决乱码问题"></a>解决乱码问题</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server=http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">request,response</span>)</span>&#123;</span><br><span class="line">	response.end(<span class="string">&#x27;你好，node&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;服务器启动成功了，可以通过http:127.0.0.1:3000来进行访问&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果</p>
<p><img src="./Nodejs/14.png"></p>
<p>服务器默认发送的数据，其实是utf-8编码的内容，但是浏览器不知道</p>
<p>浏览器在不知道服务器响应内容编码格式的情况下，会按照当前操作系统的默认编码格式去解析</p>
<p>中文操作系统默认是gbk</p>
<p>解决办法——告诉浏览器我给你发送的内容是什么编码的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server=http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">request,response</span>)</span>&#123;</span><br><span class="line">	response.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>,<span class="string">&#x27;text/plain;charset=utf-8&#x27;</span>)</span><br><span class="line">	response.end(<span class="string">&#x27;你好，node&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;服务器启动成功了，可以通过http:127.0.0.1:3000来进行访问&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结果</p>
<p><img src="./Nodejs/13.png"></p>
<p><em>查看百度，也是如此</em></p>
<p>在http协议中，就是告知浏览器我给你发送的数据内容是什么类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> server=http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">request,response</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> url=request.url</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (url===<span class="string">&#x27;/plain&#x27;</span>) &#123;</span><br><span class="line">		response.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>,<span class="string">&#x27;text/plain;charset=utf-8&#x27;</span>)</span><br><span class="line">		response.end(<span class="string">&#x27;&lt;p&gt;hello,世界&lt;/p&gt;&#x27;</span>)</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span> (url===<span class="string">&#x27;/html&#x27;</span>) &#123;</span><br><span class="line">		response.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>,<span class="string">&#x27;text/html;charset=utf-8&#x27;</span>)</span><br><span class="line">		response.end(<span class="string">&#x27;&lt;p&gt;hello,世界&lt;/p&gt;&#x27;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;服务器启动成功了，可以通过http:127.0.0.1:3000来进行访问&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>根据不同的类型，浏览器作不同的解读</p>
<p>text/plain是普通文本</p>
<p>text/html是html格式内容</p>
<h2 id="16、发送文件中的数据以及Content-type内容类型"><a href="#16、发送文件中的数据以及Content-type内容类型" class="headerlink" title="16、发送文件中的数据以及Content-type内容类型"></a>16、发送文件中的数据以及Content-type内容类型</h2><h3 id="html文件怎么发送"><a href="#html文件怎么发送" class="headerlink" title="html文件怎么发送"></a>html文件怎么发送</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> server=http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> url=req.url;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(url===<span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line">		fs.readFile(<span class="string">&#x27;./index.html&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">error,data</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (error) &#123;</span><br><span class="line">				res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>,<span class="string">&#x27;text/plain;charset=utf-8&#x27;</span>)</span><br><span class="line">				res.end(<span class="string">&#x27;文件读取失败&#x27;</span>)</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>,<span class="string">&#x27;text/html;charset=utf-8&#x27;</span>)</span><br><span class="line">				res.end(data)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;server is running……&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="问题：图片怎么读？"><a href="#问题：图片怎么读？" class="headerlink" title="问题：图片怎么读？"></a>问题：图片怎么读？</h4><p><a target="_blank" rel="noopener" href="https://tool.oschina.net/commons">https://tool.oschina.net/commons</a></p>
<h2 id="17、总结"><a href="#17、总结" class="headerlink" title="17、总结"></a>17、总结</h2><h2 id="18、反馈"><a href="#18、反馈" class="headerlink" title="18、反馈"></a>18、反馈</h2><h2 id="19、代码风格及代码中的分号问题"><a href="#19、代码风格及代码中的分号问题" class="headerlink" title="19、代码风格及代码中的分号问题"></a>19、代码风格及代码中的分号问题</h2><h3 id="代码风格"><a href="#代码风格" class="headerlink" title="代码风格"></a>代码风格</h3><p>为了约定大家的代码风格，所以在社区中诞生了一些比较规范的代码风格规范：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://standardjs.com/">JavaScript Standard Style</a></li>
<li>Airbnb JavaScript Style</li>
</ul>
<h3 id="分号问题"><a href="#分号问题" class="headerlink" title="分号问题"></a>分号问题</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">say()</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="comment">// TypeError: say(...) is not a function</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>改成</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TypeError: say(...) is not a function</span></span><br><span class="line">say()</span><br><span class="line"></span><br><span class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;[<span class="string">&#x27;苹果&#x27;</span>, <span class="string">&#x27;香蕉&#x27;</span>].forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">;<span class="string">`hello`</span>.toString()</span><br></pre></td></tr></table></figure>

<p>当你采用了无分号的代码风格的时候，只需要注意以下情况就不会有上面的问题了</p>
<ul>
<li>(</li>
</ul>
<ul>
<li><p><code>[</code></p>
</li>
<li><p>`</p>
<p>最好前面补分号，避免一些问题</p>
<ul>
<li>《编写可维护的 JavaScript》</li>
<li></li>
<li><ul>
<li>不仅是功能，还要写的漂亮</li>
</ul>
</li>
<li></li>
</ul>
</li>
</ul>
<h2 id="20、初步实现Apache功能"><a href="#20、初步实现Apache功能" class="headerlink" title="20、初步实现Apache功能"></a>20、初步实现Apache功能</h2><p>先新建几个文件</p>
<p>./a.txt<br>./index.html<br>./apple/login.html</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 创建 Server</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 监听 Server 的 request 请求事件，设置请求处理函数</span></span><br><span class="line"><span class="comment">//    请求</span></span><br><span class="line"><span class="comment">//      处理</span></span><br><span class="line"><span class="comment">//    响应</span></span><br><span class="line"><span class="comment">//    一个请求对应一个响应，如果在一个请求的过程中，已经结束响应了，则不能重复发送响应。</span></span><br><span class="line"><span class="comment">//    没有请求就没有响应。</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// 咱们以前使用过 Apache 服务器软件，这个软件默认有一个 www 目录，所有存放在 www 目录中的资源都可以通过网址来浏览</span></span><br><span class="line"><span class="comment">// 127.0.0.1:80/a.txt</span></span><br><span class="line"><span class="comment">// 127.0.0.1:80/index.html</span></span><br><span class="line"><span class="comment">// 127.0.0.1:80/apple/login.html</span></span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> url = req.url</span><br><span class="line">  <span class="keyword">if</span>(url===<span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line">      fs.readFile(<span class="string">&#x27;C:/app/www/index.html&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">          <span class="comment">//注意这里的文件路径要改</span></span><br><span class="line">       <span class="comment">/*   if(err)&#123;</span></span><br><span class="line"><span class="comment">             res.end(&#x27;404 not found&#x27;)//可以设计一个好看的404页面</span></span><br><span class="line"><span class="comment">          &#125;else&#123;</span></span><br><span class="line"><span class="comment">               res.end(data)</span></span><br><span class="line"><span class="comment">          &#125;//这种写法不好，用后面的if（err）代替</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">          <span class="keyword">if</span>(err)&#123;</span><br><span class="line">              <span class="keyword">return</span> res.end(<span class="string">&#x27;404 not found&#x27;</span>)</span><br><span class="line">              <span class="comment">//return有两个作用</span></span><br><span class="line">              <span class="comment">//1.方法返回值</span></span><br><span class="line">              <span class="comment">//2.阻止代码继续往后执行</span></span><br><span class="line">          &#125;</span><br><span class="line">          res.end(data)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(url===<span class="string">&#x27;/a.txt&#x27;</span>)&#123;</span><br><span class="line">      fs.readFile(<span class="string">&#x27;C:app/www/a.txt&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(err)&#123;</span><br><span class="line">          <span class="keyword">return</span> res.end(<span class="number">404</span> not found)</span><br><span class="line">      &#125;</span><br><span class="line">          res.end(data)</span><br><span class="line">      &#125;)</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(url===<span class="string">&#x27;/index.html&#x27;</span>)&#123;</span><br><span class="line">       fs.readFile(<span class="string">&#x27;C:app/www/index.html&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(err)&#123;</span><br><span class="line">          <span class="keyword">return</span> res.end(<span class="number">404</span> not found)</span><br><span class="line">      &#125;</span><br><span class="line">          res.end(data)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(url===<span class="string">&#x27;apple/login.html&#x27;</span>)&#123;</span><br><span class="line">       fs.readFile(<span class="string">&#x27;C:app/www/apple/login.html&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(err)&#123;</span><br><span class="line">          <span class="keyword">return</span> res.end(<span class="number">404</span> not found)</span><br><span class="line">      &#125;</span><br><span class="line">          res.end(data)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 绑定端口号，启动服务</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;running...&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意：前端页面代码中，meta charset=utf-8,不要忘记</p>
<p>上面的代码做个改动</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 创建 Server</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 监听 Server 的 request 请求事件，设置请求处理函数</span></span><br><span class="line"><span class="comment">//    请求</span></span><br><span class="line"><span class="comment">//      处理</span></span><br><span class="line"><span class="comment">//    响应</span></span><br><span class="line"><span class="comment">//    一个请求对应一个响应，如果在一个请求的过程中，已经结束响应了，则不能重复发送响应。</span></span><br><span class="line"><span class="comment">//    没有请求就没有响应。</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// 咱们以前使用过 Apache 服务器软件，这个软件默认有一个 www 目录，所有存放在 www 目录中的资源都可以通过网址来浏览</span></span><br><span class="line"><span class="comment">// 127.0.0.1:80/a.txt</span></span><br><span class="line"><span class="comment">// 127.0.0.1:80/index.html</span></span><br><span class="line"><span class="comment">// 127.0.0.1:80/apple/login.html</span></span><br><span class="line"><span class="keyword">var</span> wwwDir=<span class="string">&#x27;C:/app/www&#x27;</span></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> url = req.url</span><br><span class="line">  <span class="keyword">if</span>(url===<span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line">      fs.readFile(wwwDir+<span class="string">&#x27;/index.html&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">          <span class="comment">//注意这里的文件路径要改</span></span><br><span class="line">       <span class="comment">/*   if(err)&#123;</span></span><br><span class="line"><span class="comment">             res.end(&#x27;404 not found&#x27;)//可以设计一个好看的404页面</span></span><br><span class="line"><span class="comment">          &#125;else&#123;</span></span><br><span class="line"><span class="comment">               res.end(data)</span></span><br><span class="line"><span class="comment">          &#125;//这种写法不好，用后面的if（err）代替</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">          <span class="keyword">if</span>(err)&#123;</span><br><span class="line">              <span class="keyword">return</span> res.end(<span class="string">&#x27;404 not found&#x27;</span>)</span><br><span class="line">              <span class="comment">//return有两个作用</span></span><br><span class="line">              <span class="comment">//1.方法返回值</span></span><br><span class="line">              <span class="comment">//2.阻止代码继续往后执行</span></span><br><span class="line">          &#125;</span><br><span class="line">          res.end(data)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(url===<span class="string">&#x27;/a.txt&#x27;</span>)&#123;</span><br><span class="line">      fs.readFile(wwwDir+<span class="string">&#x27;/a.txt&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(err)&#123;</span><br><span class="line">          <span class="keyword">return</span> res.end(<span class="number">404</span> not found)</span><br><span class="line">      &#125;</span><br><span class="line">          res.end(data)</span><br><span class="line">      &#125;)</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(url===<span class="string">&#x27;/index.html&#x27;</span>)&#123;</span><br><span class="line">       fs.readFile(wwwDir+<span class="string">&#x27;/index.html&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(err)&#123;</span><br><span class="line">          <span class="keyword">return</span> res.end(<span class="number">404</span> not found)</span><br><span class="line">      &#125;</span><br><span class="line">          res.end(data)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(url===<span class="string">&#x27;apple/login.html&#x27;</span>)&#123;</span><br><span class="line">       fs.readFile(wwwDir+<span class="string">&#x27;/login.html&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(err)&#123;</span><br><span class="line">          <span class="keyword">return</span> res.end(<span class="number">404</span> not found)</span><br><span class="line">      &#125;</span><br><span class="line">          res.end(data)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 绑定端口号，启动服务</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;running...&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>代码简化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wwwDir = <span class="string">&#x27;D:/app/www&#x27;</span></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> url = req.url</span><br><span class="line">  <span class="keyword">var</span> filePath = <span class="string">&#x27;/index.html&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (url !== <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">    filePath = url</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fs.readFile(wwwDir + filePath, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.end(<span class="string">&#x27;404 Not Found.&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    res.end(data)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 绑定端口号，启动服务</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;running...&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="21、Apache-2"><a href="#21、Apache-2" class="headerlink" title="21、Apache-2"></a>21、Apache-2</h2><p>在浏览器中输入file:///C:/app/www/，复制其源代码，然后把js删除，留下页面作为template.html</p>
<p>Apache目录列表.js代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> server=http.createServer()</span><br><span class="line"><span class="keyword">var</span> wwwDir=<span class="string">&#x27;c:/app/www&#x27;</span></span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> url=req.url</span><br><span class="line">	fs.readFile(<span class="string">&#x27;./template.html&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> res.end(<span class="string">&#x27;404&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">    <span class="comment">// 1. 如何得到 wwwDir 目录列表中的文件名和目录名</span></span><br><span class="line">    <span class="comment">//    fs.readdir（参考readdir.js)</span></span><br><span class="line">    <span class="comment">// 2. 如何将得到的文件名和目录名替换到 template.html 中</span></span><br><span class="line">    <span class="comment">//    2.1 在 template.html 中需要替换的位置预留一个特殊的标记（就像以前使用模板引擎的标记一样）</span></span><br><span class="line">    <span class="comment">//    2.2 根据 files 生成需要的 HTML 内容</span></span><br><span class="line">    <span class="comment">// 只要你做了这两件事儿，那这个问题就解决了</span></span><br><span class="line">		res.end(data);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;running&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这样可以输出服务器页面了，但是我们现在要解决的是上注释中的问题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wwwDir = <span class="string">&#x27;C:/app/www&#x27;</span></span><br><span class="line"></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> url = req.url</span><br><span class="line">  fs.readFile(<span class="string">&#x27;./template.html&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.end(<span class="string">&#x27;404 Not Found.&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1. 如何得到 wwwDir 目录列表中的文件名和目录名</span></span><br><span class="line">    <span class="comment">//    fs.readdir</span></span><br><span class="line">    <span class="comment">// 2. 如何将得到的文件名和目录名替换到 template.html 中</span></span><br><span class="line">    <span class="comment">//    2.1 在 template.html 中需要替换的位置预留一个特殊的标记（就像以前使用模板引擎的标记一样）</span></span><br><span class="line">    <span class="comment">//    2.2 根据 files 生成需要的 HTML 内容</span></span><br><span class="line">    <span class="comment">// 只要你做了这两件事儿，那这个问题就解决了</span></span><br><span class="line">    fs.readdir(wwwDir, <span class="function"><span class="keyword">function</span> (<span class="params">err, files</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.end(<span class="string">&#x27;Can not find www dir.&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2.1 生成需要替换的内容</span></span><br><span class="line">      <span class="keyword">var</span> content = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      files.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 在 EcmaScript 6 的 ` 字符串中，可以使用 $&#123;&#125; 来引用变量</span></span><br><span class="line">        content += <span class="string">`</span></span><br><span class="line"><span class="string">          &lt;tr&gt;</span></span><br><span class="line"><span class="string">            &lt;td data-value=&quot;apple/&quot;&gt;&lt;a class=&quot;icon dir&quot; href=&quot;/D:/app/www/apple/&quot;&gt;<span class="subst">$&#123;item&#125;</span>&lt;/a&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;td class=&quot;detailsColumn&quot; data-value=&quot;0&quot;&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="string">            &lt;td class=&quot;detailsColumn&quot; data-value=&quot;1509589967&quot;&gt;2017/11/2 上午10:32:47&lt;/td&gt;</span></span><br><span class="line"><span class="string">          &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        `</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2.3 替换</span></span><br><span class="line">      data = data.toString()</span><br><span class="line">      data = data.replace(<span class="string">&#x27;^_^&#x27;</span>, content)<span class="comment">//提前查个坐标进去^_^</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. 发送解析替换过后的响应数据</span></span><br><span class="line">      res.end(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;running...&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>附：readdir.js代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fs.readdir(<span class="string">&#x27;D:/app/www&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, files</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&#x27;目录不存在&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(files)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="22、Apache完成目录列表渲染"><a href="#22、Apache完成目录列表渲染" class="headerlink" title="22、Apache完成目录列表渲染"></a>22、Apache完成目录列表渲染</h2><h2 id="23、模板引擎不关心内容"><a href="#23、模板引擎不关心内容" class="headerlink" title="23、模板引擎不关心内容"></a>23、模板引擎不关心内容</h2><h2 id="24、在node中使用模板引擎"><a href="#24、在node中使用模板引擎" class="headerlink" title="24、在node中使用模板引擎"></a>24、在node中使用模板引擎</h2><h2 id="25、使用模板引擎解析替换HTML"><a href="#25、使用模板引擎解析替换HTML" class="headerlink" title="25、使用模板引擎解析替换HTML"></a>25、使用模板引擎解析替换HTML</h2><h2 id="26、客户端渲染和服务端渲染"><a href="#26、客户端渲染和服务端渲染" class="headerlink" title="26、客户端渲染和服务端渲染"></a>26、客户端渲染和服务端渲染</h2><p><img src="./Nodejs/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93.png"></p>
<p><img src="./Nodejs/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93.png"></p>
<ul>
<li><p>服务端渲染</p>
<ul>
<li>说白了就是在服务端使用模板引擎</li>
<li>模板引擎最早诞生于服务端，后来才发展到了前端</li>
</ul>
</li>
<li><p>服务端渲染和客户端渲染的区别</p>
<ul>
<li>客户端渲染不利于 SEO 搜索引擎优化</li>
<li>服务端渲染是可以被爬虫抓取到的，客户端异步渲染是很难被爬虫抓取到的</li>
<li>所以你会发现真正的网站既不是纯异步也不是纯服务端渲染出来的</li>
<li>而是两者结合来做的</li>
<li>例如京东的商品列表就采用的是服务端渲染，目的了为了 SEO 搜索引擎优化</li>
<li>而它的商品评论列表为了用户体验，而且也不需要 SEO 优化，所以采用是客户端渲染</li>
</ul>
</li>
</ul>
<h2 id="27、处理网站中的静态资源"><a href="#27、处理网站中的静态资源" class="headerlink" title="27、处理网站中的静态资源"></a>27、处理网站中的静态资源</h2><p>​        做一个留言板项目</p>
<p>​        新建多个空白文件</p>
<p>​        <img src="F:/桌面文件/node/15.png"></p>
<h4 id="app-js中的代码"><a href="#app-js中的代码" class="headerlink" title="app.js中的代码"></a>app.js中的代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app application应用程序</span></span><br><span class="line"><span class="comment">//把当前模块的所有依赖项都声明在文件模块的最上面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">var server=http.createServer()</span></span><br><span class="line"><span class="comment">server.on(&#x27;request&#x27;,function (req,res) &#123;</span></span><br><span class="line"><span class="comment">  res.end(&#x27;aaa&#x27;)</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">server.listen(3000,function () &#123;</span></span><br><span class="line"><span class="comment">  console.log(&quot;Server is running&quot;)</span></span><br><span class="line"><span class="comment">&#125;)*/</span></span><br><span class="line"><span class="comment">/*************************简写************************/</span></span><br><span class="line">http</span><br><span class="line">    .createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">      res.end(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;Server is running&quot;</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>然后</p>
<h4 id="在index-html代码"><a href="#在index-html代码" class="headerlink" title="在index.html代码"></a>在index.html代码</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>留言本<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/public/lib/bootstrap/dist/css/bootstrap.css&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css&quot; integrity=&quot;sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk&quot; crossorigin=&quot;anonymous&quot;&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page-header&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Example page header <span class="tag">&lt;<span class="name">small</span>&gt;</span>Subtext for header<span class="tag">&lt;/<span class="name">small</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/post&quot;</span>&gt;</span>发表留言<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  &lt;div class=&quot;comments container&quot;&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;ul class=&quot;list-group&quot;&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--      &#123;&#123;each comments&#125;&#125;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--      &lt;li class=&quot;list-group-item&quot;&gt;&#123;&#123; $value.name &#125;&#125;说：&#123;&#123; $value.message &#125;&#125; &lt;span class=&quot;pull-right&quot;&gt;&#123;&#123; $value.dateTime &#125;&#125;&lt;/span&gt;&lt;/li&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--      &#123;&#123;/each&#125;&#125;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;/ul&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  &lt;/div&gt;--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;comments container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span>小明说：老师太帅了 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;pull-right&quot;</span>&gt;</span>2020-09-25<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这时候，我们发现，页面一直刷新不出来，这是因为css路径错误，将下一行注释打开即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">浏览器收到 HTML 响应内容之后，就要开始从上到下依次解析，</span><br><span class="line">当在解析的过程中，如果发现：</span><br><span class="line">  link</span><br><span class="line">  script</span><br><span class="line">  img</span><br><span class="line">  iframe</span><br><span class="line">  video</span><br><span class="line">  audio</span><br><span class="line">等带有 src 或者 href（link） 属性标签（具有外链的资源）的时候，浏览器会自动对这些资源发起新的请求。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们打开京东官网，在”Network”中会看到有很多很多请求，每个图片/文件都会发起一个新的请求</p>
<p>把所有的<code>静态资源</code>统统放到public里面</p>
<p>在index.html里，有引入一个main.css</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app application应用程序</span></span><br><span class="line"><span class="comment">//把当前模块的所有依赖项都声明在文件模块的最上面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">var server=http.createServer()</span></span><br><span class="line"><span class="comment">server.on(&#x27;request&#x27;,function (req,res) &#123;</span></span><br><span class="line"><span class="comment">  res.end(&#x27;aaa&#x27;)</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">server.listen(3000,function () &#123;</span></span><br><span class="line"><span class="comment">  console.log(&quot;Server is running&quot;)</span></span><br><span class="line"><span class="comment">&#125;)*/</span></span><br><span class="line"><span class="comment">/*************************简写************************/</span></span><br><span class="line">http</span><br><span class="line">    .createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> url=req.url</span><br><span class="line">        <span class="keyword">if</span>(url===<span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line">            fs.readFile(<span class="string">&#x27;./views/index.html&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    <span class="keyword">return</span> res.end(<span class="string">&#x27;404&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                res.end(data)</span><br><span class="line">                <span class="comment">//什么时候处理成字符串，什么时候不处理</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (url.indexOf(<span class="string">&#x27;/public/&#x27;</span>)===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">/*比如：</span></span><br><span class="line"><span class="comment">            * /public/css/main.css</span></span><br><span class="line"><span class="comment">            * /publick/js/main.js</span></span><br><span class="line"><span class="comment">            * public/img/XXX.jpg</span></span><br><span class="line"><span class="comment">            * */</span></span><br><span class="line">            <span class="comment">// 统一处理：</span></span><br><span class="line">            <span class="comment">//    如果请求路径是以 /public/ 开头的，则我认为你要获取 public 中的某个资源</span></span><br><span class="line">            <span class="comment">//    所以我们就直接可以把请求路径当作文件路径来直接进行读取</span></span><br><span class="line">            <span class="built_in">console</span>.log(url)</span><br><span class="line">            fs.readFile(<span class="string">&#x27;.&#x27;</span>+url,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">                <span class="comment">//这里给url拼一个点，这样路径就变成了</span></span><br><span class="line">                <span class="comment">/*比如：</span></span><br><span class="line"><span class="comment">               * 。/public/css/main.css</span></span><br><span class="line"><span class="comment">               * 。/publick/js/main.js</span></span><br><span class="line"><span class="comment">               * 。/public/img/XXX.jpg</span></span><br><span class="line"><span class="comment">               * */</span></span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    <span class="keyword">return</span> res.end(<span class="string">&#x27;404&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                res.end(data)</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    .listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Server is running&quot;</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>



<p>需要配置好public后才能正常引入，其他比如js文件夹里的“main.js”的引入也是如此</p>
<p>如此做，就把public里的资源开放，可以被用户访问到</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     注意：在服务端中，文件中的路径就不要去写相对路径了。</span></span><br><span class="line"><span class="comment">     因为这个时候所有的资源都是通过 url 标识来获取的</span></span><br><span class="line"><span class="comment">     我的服务器开放了 /public/ 目录</span></span><br><span class="line"><span class="comment">     所以这里的请求路径都写成：/public/xxx</span></span><br><span class="line"><span class="comment">     / 在这里就是 url 根路径的意思。</span></span><br><span class="line"><span class="comment">     浏览器在真正发请求的时候会最终把 http://127.0.0.1:3000 拼上</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     不要再想文件路径了，把所有的路径都想象成 url 地址</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="28、走通页面跳转加入404处理"><a href="#28、走通页面跳转加入404处理" class="headerlink" title="28、走通页面跳转加入404处理"></a>28、走通页面跳转加入404处理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app application应用程序</span></span><br><span class="line"><span class="comment">//把当前模块的所有依赖项都声明在文件模块的最上面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">var server=http.createServer()</span></span><br><span class="line"><span class="comment">server.on(&#x27;request&#x27;,function (req,res) &#123;</span></span><br><span class="line"><span class="comment">  res.end(&#x27;aaa&#x27;)</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">server.listen(3000,function () &#123;</span></span><br><span class="line"><span class="comment">  console.log(&quot;Server is running&quot;)</span></span><br><span class="line"><span class="comment">&#125;)*/</span></span><br><span class="line"><span class="comment">/*************************简写************************/</span></span><br><span class="line">http</span><br><span class="line">    .createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> url=req.url</span><br><span class="line">        <span class="keyword">if</span>(url===<span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line">            fs.readFile(<span class="string">&#x27;./views/index.html&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    <span class="keyword">return</span> res.end(<span class="string">&#x27;404&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                res.end(data)</span><br><span class="line">                <span class="comment">//什么时候处理成字符串，什么时候不处理</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (url.indexOf(<span class="string">&#x27;/public/&#x27;</span>)===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">/*比如：</span></span><br><span class="line"><span class="comment">            * /public/css/main.css</span></span><br><span class="line"><span class="comment">            * /publick/js/main.js</span></span><br><span class="line"><span class="comment">            * public/img/XXX.jpg</span></span><br><span class="line"><span class="comment">            * */</span></span><br><span class="line">            <span class="comment">// 统一处理：</span></span><br><span class="line">            <span class="comment">//    如果请求路径是以 /public/ 开头的，则我认为你要获取 public 中的某个资源</span></span><br><span class="line">            <span class="comment">//    所以我们就直接可以把请求路径当作文件路径来直接进行读取</span></span><br><span class="line">            <span class="built_in">console</span>.log(url)</span><br><span class="line">            fs.readFile(<span class="string">&#x27;.&#x27;</span>+url,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">                <span class="comment">//这里给url拼一个点，这样路径就变成了</span></span><br><span class="line">                <span class="comment">/*比如：</span></span><br><span class="line"><span class="comment">               * 。/public/css/main.css</span></span><br><span class="line"><span class="comment">               * 。/publick/js/main.js</span></span><br><span class="line"><span class="comment">               * 。/public/img/XXX.jpg</span></span><br><span class="line"><span class="comment">               * */</span></span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    <span class="keyword">return</span> res.end(<span class="string">&#x27;404&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                res.end(data)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/******************404*********************/</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//其他的都处理成404</span></span><br><span class="line">            fs.readFile(<span class="string">&#x27;./views/404.html&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    <span class="keyword">return</span> res.end(<span class="string">&#x27;404&#x27;</span>)</span><br><span class="line">                &#125;res.end(data)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//这时候我们会发现，传过去的文字是正常显示的</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Server is running&quot;</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>



<h2 id="29、渲染评论首页"><a href="#29、渲染评论首页" class="headerlink" title="29、渲染评论首页"></a>29、渲染评论首页</h2><p>在index点击跳转到评论首页</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app application应用程序</span></span><br><span class="line"><span class="comment">//把当前模块的所有依赖项都声明在文件模块的最上面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">var server=http.createServer()</span></span><br><span class="line"><span class="comment">server.on(&#x27;request&#x27;,function (req,res) &#123;</span></span><br><span class="line"><span class="comment">  res.end(&#x27;aaa&#x27;)</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">server.listen(3000,function () &#123;</span></span><br><span class="line"><span class="comment">  console.log(&quot;Server is running&quot;)</span></span><br><span class="line"><span class="comment">&#125;)*/</span></span><br><span class="line"><span class="comment">/*************************简写************************/</span></span><br><span class="line">http</span><br><span class="line">    .createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> url=req.url</span><br><span class="line">        <span class="keyword">if</span>(url===<span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line">            fs.readFile(<span class="string">&#x27;./views/index.html&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    <span class="keyword">return</span> res.end(<span class="string">&#x27;404bbb&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                res.end(data)</span><br><span class="line">                <span class="comment">//什么时候处理成字符串，什么时候不处理</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (url.indexOf(<span class="string">&#x27;/public/&#x27;</span>)===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">/*比如：</span></span><br><span class="line"><span class="comment">            * /public/css/main.css</span></span><br><span class="line"><span class="comment">            * /publick/js/main.js</span></span><br><span class="line"><span class="comment">            * public/img/XXX.jpg</span></span><br><span class="line"><span class="comment">            * */</span></span><br><span class="line">            <span class="comment">// 统一处理：</span></span><br><span class="line">            <span class="comment">//    如果请求路径是以 /public/ 开头的，则我认为你要获取 public 中的某个资源</span></span><br><span class="line">            <span class="comment">//    所以我们就直接可以把请求路径当作文件路径来直接进行读取</span></span><br><span class="line">           <span class="comment">// console.log(url)</span></span><br><span class="line">            fs.readFile(<span class="string">&#x27;.&#x27;</span>+url,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">                <span class="comment">//这里给url拼一个点，这样路径就变成了</span></span><br><span class="line">                <span class="comment">/*比如：</span></span><br><span class="line"><span class="comment">               * 。/public/css/main.css</span></span><br><span class="line"><span class="comment">               * 。/publick/js/main.js</span></span><br><span class="line"><span class="comment">               * 。/public/img/XXX.jpg</span></span><br><span class="line"><span class="comment">               * */</span></span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    <span class="keyword">return</span> res.end(<span class="string">&#x27;404aaa&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                res.end(data)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="comment">/******************处理post请求*********************/</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (url===<span class="string">&#x27;/post&#x27;</span>)&#123;</span><br><span class="line">            fs.readFile(<span class="string">&#x27;./views/post.html&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&#x27;111&#x27;</span>)</span><br><span class="line">                    <span class="keyword">return</span> res.end(<span class="string">&#x27;4044444&#x27;</span>)</span><br><span class="line">                &#125;res.end(data)</span><br><span class="line">            &#125;)<span class="comment">//改完以后，再去index.html把a标签里的链接地址改成  href=&quot;/post&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/******************404*********************/</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            fs.readFile(<span class="string">&#x27;./views/404.html&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    <span class="keyword">return</span> res.end(<span class="string">&#x27;444404&#x27;</span>)</span><br><span class="line">                &#125;res.end(data)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Server is running&quot;</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>//改完以后，再去index.html把a标签里的链接地址改成  href=”/post”</p>
<p>这样，点击a标签，将直接跳转到评论页</p>
<h4 id="评论页代码"><a href="#评论页代码" class="headerlink" title="评论页代码"></a>评论页代码</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  &lt;link rel=&quot;stylesheet&quot; href=&quot;/public/lib/bootstrap/dist/css/bootstrap.css&quot;&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css&quot;</span> <span class="attr">integrity</span>=<span class="string">&quot;sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page-header&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">small</span>&gt;</span>发表评论<span class="tag">&lt;/<span class="name">small</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;comments container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      以前表单是如何提交的？</span></span><br><span class="line"><span class="comment">      表单中需要提交的表单控件元素必须具有 name 属性</span></span><br><span class="line"><span class="comment">      表单提交分为：</span></span><br><span class="line"><span class="comment">        1. 默认的提交行为</span></span><br><span class="line"><span class="comment">        2. 表单异步提交</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        action 就是表单提交的地址，说白了就是请求的 url 地址</span></span><br><span class="line"><span class="comment">        method 请求方法</span></span><br><span class="line"><span class="comment">            get</span></span><br><span class="line"><span class="comment">            post</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/pinglun&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;input_name&quot;</span>&gt;</span>你的大名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">required</span> <span class="attr">minlength</span>=<span class="string">&quot;2&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;10&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input_name&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请写入你的姓名&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;textarea_message&quot;</span>&gt;</span>留言内容<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">id</span>=<span class="string">&quot;textarea_message&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;30&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;10&quot;</span> <span class="attr">required</span> <span class="attr">minlength</span>=<span class="string">&quot;5&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;20&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span>发表<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="渲染"><a href="#渲染" class="headerlink" title="渲染"></a>渲染</h4><p>把<code>.list-group</code>里的li只留一个，改成以下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span><br><span class="line">	&#123;&#123;each comments&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;说：&#123;&#123;$value.message&#125;&#125; <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;pull-right&quot;</span>&gt;</span>&#123;&#123;$value.dateTime&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     &#123;&#123;/each&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>给feedback安装模板引擎art-template，方法</p>
<p>​                <code>npm  install  art-template</code></p>
<p>然后回到<code>app.js</code>导入该模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> template=<span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> comments=[</span><br><span class="line">    &#123;......................</span><br><span class="line">     ......................</span><br></pre></td></tr></table></figure>

<p>在index.html被读取后，渲染模板,app.js:49~59</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(<span class="string">&#x27;./views/index.html&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.end(<span class="string">&#x27;404&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> htmlStr=template.render(data.toString(), &#123;</span><br><span class="line">        <span class="attr">comments</span>: comments</span><br><span class="line">    &#125;</span><br><span class="line">                               )</span><br><span class="line">    res.end(htmlStr)</span><br><span class="line">    <span class="comment">//什么时候处理成字符串，什么时候不处理</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="30、处理表单get提交"><a href="#30、处理表单get提交" class="headerlink" title="30、处理表单get提交"></a>30、处理表单get提交</h2><p>我们在post页面，输入信息，然后提交，发现url变成</p>
<p><code>http://127.0.0.1:3000/pinglun?name=gfh&amp;message=gfhsghfrrtweyrte</code></p>
<p>而页面显示的是404.html</p>
<p>这时候我们要引入一个新的模块——url</p>
<p>//注意：这是一个模块</p>
<p>在命令行输入node 回车</p>
<p>进入node，再输入</p>
<p>url.parse(‘<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/pinglun?name=gfh&amp;message=gfhsghfrrtweyrte&#39;">http://127.0.0.1:3000/pinglun?name=gfh&amp;message=gfhsghfrrtweyrte&#39;</a>)  回车</p>
<p>得到下面信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Url &#123;</span><br><span class="line">  protocol: &#x27;http:&#x27;,</span><br><span class="line">  slashes: true,</span><br><span class="line">  auth: null,</span><br><span class="line">  host: &#x27;127.0.0.1:3000&#x27;,</span><br><span class="line">  port: &#x27;3000&#x27;,</span><br><span class="line">  hostname: &#x27;127.0.0.1&#x27;,</span><br><span class="line">  hash: null,</span><br><span class="line">  search: &#x27;?name=gfh&amp;message=gfhsghfrrtweyrte&#x27;,</span><br><span class="line">  query: &#x27;name=gfh&amp;message=gfhsghfrrtweyrte&#x27;,</span><br><span class="line">  pathname: &#x27;/pinglun&#x27;,</span><br><span class="line">  path: &#x27;/pinglun?name=gfh&amp;message=gfhsghfrrtweyrte&#x27;,</span><br><span class="line">  href: &#x27;http://127.0.0.1:3000/pinglun?name=gfh&amp;message=gfhsghfrrtweyrte&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再次输入</p>
<p>url.parse(‘<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/pinglun?name=gfh&amp;message=gfhsghfrrtweyrte&#39;,true">http://127.0.0.1:3000/pinglun?name=gfh&amp;message=gfhsghfrrtweyrte&#39;,true</a>)  回车</p>
<p>会得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Url &#123;</span><br><span class="line">  protocol: &#x27;http:&#x27;,</span><br><span class="line">  slashes: true,</span><br><span class="line">  auth: null,</span><br><span class="line">  host: &#x27;127.0.0.1:3000&#x27;,</span><br><span class="line">  port: &#x27;3000&#x27;,</span><br><span class="line">  hostname: &#x27;127.0.0.1&#x27;,</span><br><span class="line">  hash: null,</span><br><span class="line">  search: &#x27;?name=gfh&amp;message=gfhsghfrrtweyrte&#x27;,</span><br><span class="line">  query: [Object: null prototype] &#123; name: &#x27;gfh&#x27;, message: &#x27;gfhsghfrrtweyrte&#x27; &#125;,</span><br><span class="line">  pathname: &#x27;/pinglun&#x27;,</span><br><span class="line">  path: &#x27;/pinglun?name=gfh&amp;message=gfhsghfrrtweyrte&#x27;,</span><br><span class="line">  href: &#x27;http://127.0.0.1:3000/pinglun?name=gfh&amp;message=gfhsghfrrtweyrte&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面下面，再query中是不同的，其他基本一致，后者的query是一个对象，可以直接用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 对于这种表单提交的请求路径，由于其中具有用户动态填写的内容</span><br><span class="line">// 所以你不可能通过去判断完整的 url 路径来处理这个请求</span><br><span class="line">// </span><br><span class="line">// 结论：对于我们来讲，其实只需要判定，如果你的请求路径是 /pinglun 的时候，那我就认为你提交表单的请求过来了</span><br></pre></td></tr></table></figure>

<p>我们现在想把浏览器中的url进行拆解，可以通过pathname得到<code>/pinglun</code>,可以通过query得到对象</p>
<p>所以我们回到app.js中，引入url模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url=<span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>此时，我们引入的这个模块跟之前的url冲突，于是我们来改一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> comments = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;今天天气不错！&#x27;</span>,</span><br><span class="line">    <span class="attr">dateTime</span>: <span class="string">&#x27;2015-10-16&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三2&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;今天天气不错！&#x27;</span>,</span><br><span class="line">    <span class="attr">dateTime</span>: <span class="string">&#x27;2015-10-16&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三3&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;今天天气不错！&#x27;</span>,</span><br><span class="line">    <span class="attr">dateTime</span>: <span class="string">&#x27;2015-10-16&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三4&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;今天天气不错！&#x27;</span>,</span><br><span class="line">    <span class="attr">dateTime</span>: <span class="string">&#x27;2015-10-16&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三5&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;今天天气不错！&#x27;</span>,</span><br><span class="line">    <span class="attr">dateTime</span>: <span class="string">&#x27;2015-10-16&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http</span><br><span class="line">  .createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123; </span><br><span class="line">    <span class="comment">// 使用 url.parse 方法将路径解析为一个方便操作的对象，第二个参数为 true 表示直接将查询字符串转为一个对象（通过 query 属性来访问）</span></span><br><span class="line">    <span class="keyword">var</span> parseObj = url.parse(req.url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单独获取不包含查询字符串的路径部分（该路径不包含 ? 之后的内容）</span></span><br><span class="line">    <span class="keyword">var</span> pathname = parseObj.pathname</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">      fs.readFile(<span class="string">&#x27;./views/index.html&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.end(<span class="string">&#x27;404 Not Found.&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> htmlStr = template.render(data.toString(), &#123;</span><br><span class="line">          <span class="attr">comments</span>: comments</span><br><span class="line">        &#125;)</span><br><span class="line">        res.end(htmlStr)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname === <span class="string">&#x27;/post&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 其它的都处理成 404 找不到</span></span><br><span class="line">      fs.readFile(<span class="string">&#x27;./views/post.html&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.end(<span class="string">&#x27;404 Not Found.&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        res.end(data)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname.indexOf(<span class="string">&#x27;/public/&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// /public/css/main.css</span></span><br><span class="line">      <span class="comment">// /public/js/main.js</span></span><br><span class="line">      <span class="comment">// /public/lib/jquery.js</span></span><br><span class="line">      <span class="comment">// 统一处理：</span></span><br><span class="line">      <span class="comment">//    如果请求路径是以 /public/ 开头的，则我认为你要获取 public 中的某个资源</span></span><br><span class="line">      <span class="comment">//    所以我们就直接可以把请求路径当作文件路径来直接进行读取</span></span><br><span class="line">      fs.readFile(<span class="string">&#x27;.&#x27;</span> + pathname, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.end(<span class="string">&#x27;404 Not Found.&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        res.end(data)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pathname === <span class="string">&#x27;/pinglun&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 注意：这个时候无论 /pinglun?xxx 之后是什么，我都不用担心了，因为我的 pathname 是不包含 ? 之后的那个路径</span></span><br><span class="line">      <span class="comment">// 一次请求对应一次响应，响应结束这次请求也就结束了</span></span><br><span class="line">      <span class="comment">// res.end(JSON.stringify(parseObj.query))</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 我们已经使用 url 模块的 parse 方法把请求路径中的查询字符串给解析成一个对象了</span></span><br><span class="line">      <span class="comment">// 所以接下来要做的就是：</span></span><br><span class="line">      <span class="comment">//    1. 获取表单提交的数据 parseObj.query</span></span><br><span class="line">      <span class="comment">//    2. 将当前时间日期添加到数据对象中，然后存储到数组中</span></span><br><span class="line">      <span class="comment">//    3. 让用户重定向跳转到首页 /</span></span><br><span class="line">      <span class="comment">//       当用户重新请求 / 的时候，我数组中的数据已经发生变化了，所以用户看到的页面也就变了</span></span><br><span class="line">      <span class="keyword">var</span> comment = parseObj.query</span><br><span class="line">      comment.dateTime = <span class="string">&#x27;2017-11-2 17:11:22&#x27;</span></span><br><span class="line">      comments.unshift(comment)</span><br><span class="line">      <span class="comment">// 服务端这个时候已经把数据存储好了，接下来就是让用户重新请求 / 首页，就可以看到最新的留言内容了</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如何通过服务器让客户端重定向？</span></span><br><span class="line">      <span class="comment">//    1. 状态码设置为 302 临时重定向</span></span><br><span class="line">      <span class="comment">//        statusCode</span></span><br><span class="line">      <span class="comment">//    2. 在响应头中通过 Location 告诉客户端往哪儿重定向</span></span><br><span class="line">      <span class="comment">//        setHeader</span></span><br><span class="line">      <span class="comment">// 如果客户端发现收到服务器的响应的状态码是 302 就会自动去响应头中找 Location ，然后对该地址发起新的请求</span></span><br><span class="line">      <span class="comment">// 所以你就能看到客户端自动跳转了</span></span><br><span class="line">      res.statusCode = <span class="number">302</span></span><br><span class="line">      res.setHeader(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">      res.end()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 其它的都处理成 404 找不到</span></span><br><span class="line">      fs.readFile(<span class="string">&#x27;./views/404.html&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.end(<span class="string">&#x27;404 Not Found.&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        res.end(data)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;running...&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Node 不适合从来没有接触过服务端的人学习</span></span><br><span class="line"><span class="comment">// 如果想要真正的学号服务端，还是老牌的 Java、PHP 这些平台</span></span><br><span class="line"><span class="comment">// Node 不是特别适合入门服务端，但不代表 Node 不强大</span></span><br><span class="line"><span class="comment">// Node 很厉害，具有经验的人可以玩儿的非常的牛</span></span><br><span class="line"><span class="comment">// 不适合新手的原因就在于比较偏底层、而且太灵活</span></span><br><span class="line"><span class="comment">// Java、PHP 好入门的原因就在于：这些平台屏蔽了一些底层</span></span><br><span class="line"><span class="comment">// res.redirect(&#x27;重定向&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 写案例照着下面的步骤写：</span></span><br><span class="line"><span class="comment">// 1. / index.html</span></span><br><span class="line"><span class="comment">// 2. 开放 public 目录中的静态资源</span></span><br><span class="line"><span class="comment">//    当请求 /public/xxx 的时候，读取响应 public 目录中的具体资源</span></span><br><span class="line"><span class="comment">// 3. /post post.html</span></span><br><span class="line"><span class="comment">// 4. /pinglun</span></span><br><span class="line"><span class="comment">//    4.1 接收表单提交数据</span></span><br><span class="line"><span class="comment">//    4.2 存储表单提交的数据</span></span><br><span class="line"><span class="comment">//    4.3 让表单重定向到 /</span></span><br><span class="line"><span class="comment">//        statusCode</span></span><br><span class="line"><span class="comment">//        setHeader</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//    使用框架的目的就是让我们更加专注于业务，而不是底层细节</span></span><br><span class="line">		</span><br></pre></td></tr></table></figure>



<h2 id="31、表单提交重定向"><a href="#31、表单提交重定向" class="headerlink" title="31、表单提交重定向"></a>31、表单提交重定向</h2><h2 id="32、总结"><a href="#32、总结" class="headerlink" title="32、总结"></a>32、总结</h2><h2 id="33、node中的console"><a href="#33、node中的console" class="headerlink" title="33、node中的console"></a>33、node中的console</h2><p>在命令行中,输入node回车</p>
<p>就进入node了,这就相当于浏览器中的console</p>
<p>可以输出一些东西,比如输入1+1</p>
<p>得到结果2这样</p>
<p>也可以直接使用node中的一些方法,比如上节讲到的url模块</p>
<p>ctrl+C可以退出</p>
<h2 id="34、反馈-each和forEach"><a href="#34、反馈-each和forEach" class="headerlink" title="34、反馈-each和forEach"></a>34、反馈-each和forEach</h2><p>art-template</p>
<p>each是art-template的模板语法,是专属的</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;each  遍历项&#125;&#125;</span><br><span class="line"></span><br><span class="line">&lt;li&gt;&#123;&#123;$value&#125;&#125;&lt;/li&gt;</span><br><span class="line"></span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br><span class="line">  <span class="comment">//这是art-template中的方法,只能在它里面用</span></span><br></pre></td></tr></table></figure>

<p>$.each(数组,function)//这是jq里的</p>
<p>forEach是es5中的一个数组遍历函数,是js原生的遍历方法,可以遍历原生的所有成员</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://libs.baidu.com/jquery/2.0.0/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	<span class="comment">/*;[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;].forEach(function (item,index) &#123;</span></span></span><br><span class="line"><span class="comment"><span class="javascript">		console.log(item,index)</span></span></span><br><span class="line"><span class="comment"><span class="javascript">	&#125;)*/</span></span></span><br><span class="line"><span class="javascript">	<span class="comment">//但是上述方法,ie8不支持</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">	<span class="comment">// jq可以</span></span></span><br><span class="line"><span class="javascript">	$.each([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>],<span class="function"><span class="keyword">function</span>(<span class="params">index,item</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="built_in">console</span>.log(item,index)</span></span><br><span class="line"><span class="javascript">	&#125;)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span>	</span><br></pre></td></tr></table></figure>

<p>总结:</p>
<p>foreach是es5的方法</p>
<p>jq的each由jq这个第三方库提供,jq2以下的版本是兼容ie8的</p>
<p>它的each方法主要用来遍历jq实例对象(伪数组)</p>
<p>jq的实力对象不能使用foreach方法,如果想使用,必须转为数组才能使用</p>
<h2 id="35、反馈结束"><a href="#35、反馈结束" class="headerlink" title="35、反馈结束"></a>35、反馈结束</h2><p>node用的多吗?</p>
<p>Node对于前端来讲,是高级前端开发工程师必备技能</p>
<h2 id="36、复习"><a href="#36、复习" class="headerlink" title="36、复习"></a>36、复习</h2><h2 id="37、模块系统-基本规则"><a href="#37、模块系统-基本规则" class="headerlink" title="37、模块系统-基本规则"></a>37、模块系统-基本规则</h2><p>在node中,编写应用程序,主要就是在使用</p>
<ul>
<li>ECMAScript<ul>
<li>和浏览器不一样,在node中没有dom,bom</li>
</ul>
</li>
<li>核心模块<ul>
<li>文件操作的fs</li>
<li>http服务的http</li>
<li>url路径操作</li>
<li>path路径处理模块</li>
<li>os操作系统信息</li>
</ul>
</li>
<li>第三方模块<ul>
<li>art-template</li>
<li>必须通过npm下载才使用</li>
</ul>
</li>
<li>自己写的<ul>
<li>自己创建的文件</li>
</ul>
</li>
</ul>
<h3 id="什么是模块化"><a href="#什么是模块化" class="headerlink" title="什么是模块化"></a>什么是模块化</h3><ul>
<li>文件作用域,不会有污染的情况</li>
<li>通信规则<ul>
<li>加载require</li>
<li>导出exports</li>
</ul>
</li>
</ul>
<h3 id="CommonJs模块规范"><a href="#CommonJs模块规范" class="headerlink" title="CommonJs模块规范"></a>CommonJs模块规范</h3><p>在node中的js还有个很重要的概念,叫模块系统</p>
<ul>
<li><p>模块作用域</p>
</li>
<li><p>使用require来加载模块</p>
</li>
<li><p>使用exports接口对象来到处模块中的成员</p>
</li>
</ul>
<p>a文件即使加载了b文件,那么在b中声明的变量,在a中也无法使用</p>
<h2 id="38、加载和导出的使用规则"><a href="#38、加载和导出的使用规则" class="headerlink" title="38、加载和导出的使用规则"></a>38、加载和导出的使用规则</h2><p>exports是一个对象,我们可以通过为这个对象添加成员来实现,模块间的通信</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">我们现在有个需求:</span><br><span class="line"></span><br><span class="line">希望加载得到直接就是一个:</span><br><span class="line"></span><br><span class="line">​	方法</span><br><span class="line"></span><br><span class="line">​	字符串</span><br><span class="line"></span><br><span class="line">​	数字</span><br><span class="line"></span><br><span class="line">​	数组</span><br></pre></td></tr></table></figure>

<p>如果一个模块,需要直接导出某个成员,而非挂载的方式导出</p>
<p>,可以使用<code>module.exports=&#39;hello&#39;</code>这种方式</p>
<h4 id="a-js代码"><a href="#a-js代码" class="headerlink" title="a.js代码"></a>a.js代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bExports=<span class="built_in">require</span>(<span class="string">&#x27;./b&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(bExports)</span><br></pre></td></tr></table></figure>

<h4 id="b-js代码"><a href="#b-js代码" class="headerlink" title="b.js代码"></a>b.js代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x+y</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports=add</span><br></pre></td></tr></table></figure>

<h5 id="加载require"><a href="#加载require" class="headerlink" title="加载require"></a>加载<code>require</code></h5><p>语法:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> 自定义变量名=<span class="built_in">require</span>(<span class="string">&#x27;模块&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>两个作用:</p>
<ul>
<li>执行被加载模块中的代码</li>
<li>得到被加载模块中的exports导出接口对象</li>
</ul>
<h5 id="导出exports"><a href="#导出exports" class="headerlink" title="导出exports"></a>导出<code>exports</code></h5><p>Node是模块作用域,默认文件中所有的成员旨在当前文件模块有效</p>
<p>对于希望可以被其他模块访问的成员,我们就需要把这些公开的成员都挂在到<code>exports</code>接口对象中就可以了</p>
<ul>
<li><p>导出多个成员(必须在对象里)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.a=<span class="number">123</span></span><br><span class="line"><span class="built_in">exports</span>.b=<span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="built_in">exports</span>.c=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;cccc&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.d=&#123;</span><br><span class="line">    <span class="attr">foo</span>:<span class="string">&#x27;bar&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>导出单个成员(拿到的就是函数或字符串)</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports=<span class="string">&#x27;a&#x27;</span></span><br></pre></td></tr></table></figure>

<p>以下情况会覆盖</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports=<span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="built_in">module</span>.exports=<span class="function"><span class="keyword">function</span> (<span class="params">x,y</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x+y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>module.exports也可以导出多个</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="attr">add</span>:<span class="function"><span class="keyword">function</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x+y</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">str</span>:<span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="39、exports和module-expots的区别"><a href="#39、exports和module-expots的区别" class="headerlink" title="39、exports和module-expots的区别"></a>39、exports和module-expots的区别</h2><p>在node 中,每个模块内部都有一个自己的module对象</p>
<p>该module对象中有一个成员叫exports,而exports也是一个对象</p>
<p>也就是说,需要对外导出成员,只需要把该成员挂载到module.exports身上</p>
<p>而node 为了简化操作,用var exports=module.exports,于是我们直接操作exports即可</p>
<h2 id="40、复习"><a href="#40、复习" class="headerlink" title="40、复习"></a>40、复习</h2><h2 id="41、优先从缓存加载"><a href="#41、优先从缓存加载" class="headerlink" title="41、优先从缓存加载"></a>41、优先从缓存加载</h2><p>如果缓存里面有某模块(之前已经加载过),那么就不会再次加载,而是拿过来直接用</p>
<h2 id="42、require方法加载规则"><a href="#42、require方法加载规则" class="headerlink" title="42、require方法加载规则"></a>42、require方法加载规则</h2><p>判断模块标识</p>
<ul>
<li><p>​    核心模块</p>
</li>
<li><p>​    第三方模块</p>
</li>
<li><p>​    自己写的模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*如果是非路径形式的模块标识</span></span><br><span class="line"><span class="comment">	`reqire(&#x27;foo.js&#x27;)&#x27;//错误</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">路径形式的模块</span></span><br><span class="line"><span class="comment">    ./当前目录,不可省略</span></span><br><span class="line"><span class="comment">    ../上一级目录,不可省略</span></span><br><span class="line"><span class="comment">    /xxx    //这种形式几乎不用,/代表的是(mac/Linux)系统的根目录,因为它们不分盘</span></span><br><span class="line"><span class="comment">    d:/a/foo.js     //这种形式也不用,一旦文件位置改变,或者给到别人,马上出错</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">核心模块的本质也是文件</span></span><br><span class="line"><span class="comment">核心模块文件已经被编译到了二进制文件中了,我们只需要按照名字来加载即可</span></span><br><span class="line"><span class="comment">//由于node已经开源,我们可以去GitHub上找到nodejs的源文件,在lib文件夹下可以找到fs,http等</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//第三方模块</span></span><br><span class="line"><span class="comment">//凡是第三方模块都必须通过npm下载</span></span><br><span class="line"><span class="comment">//使用的时候就可以通过require(&#x27;包名&#x27;)的方式来进行加载才可以使用</span></span><br><span class="line"><span class="comment">//不可能有任何一个第三方包和核心模块的名字是一样的</span></span><br><span class="line"><span class="comment">//  加载第三方包的时候,先找到当前文件夹所处的目录中的node_mudules目录</span></span><br><span class="line"><span class="comment">//  找到node_modules/art-template/package.json中的main属性,该属性中就记录了art-template的入口模块,(可以通过该路径找到对应的index.html)</span></span><br><span class="line"><span class="comment">//然后加载使用这个第三方包</span></span><br><span class="line"><span class="comment">//实际上最终加载的还是文件</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//    如果 package.json 文件不存在或者 main 指定的入口模块是也没有</span></span><br><span class="line"><span class="comment">//    则 node 会自动找该目录下的 index.js</span></span><br><span class="line"><span class="comment">//    也就是说 index.js 会作为一个默认备选项</span></span><br><span class="line"><span class="comment">//    </span></span><br><span class="line"><span class="comment">//    如果以上所有任何一个条件都不成立，则会进入上一级目录中的 node_modules 目录查找</span></span><br><span class="line"><span class="comment">//    如果上一级还没有，则继续往上上一级查找</span></span><br><span class="line"><span class="comment">//    。。。</span></span><br><span class="line"><span class="comment">//    如果直到当前磁盘根目录还找不到，最后报错：</span></span><br><span class="line"><span class="comment">//      can not find module xxx</span></span><br><span class="line"><span class="comment">// var template = require(&#x27;art-template&#x27;)</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// 注意：我们一个项目有且只有一个 node_modules，放在项目根目录中，这样的话项目中所有的子目录中的代码都可以加载到第三方包</span></span><br><span class="line"><span class="comment">// 不会出现有多个 node_modules</span></span><br><span class="line"><span class="comment">// 模块查找机制</span></span><br><span class="line"><span class="comment">//    优先从缓存加载</span></span><br><span class="line"><span class="comment">//    核心模块</span></span><br><span class="line"><span class="comment">//    路径形式的文件模块</span></span><br><span class="line"><span class="comment">//    第三方模块</span></span><br><span class="line"><span class="comment">//      node_modules/art-template/</span></span><br><span class="line"><span class="comment">//      node_modules/art-template/package.json</span></span><br><span class="line"><span class="comment">//      node_modules/art-template/package.json main</span></span><br><span class="line"><span class="comment">//      index.js 备选项</span></span><br><span class="line"><span class="comment">//      进入上一级目录找 node_modules</span></span><br><span class="line"><span class="comment">//      按照这个规则依次往上找，直到磁盘根目录还找不到，最后报错：Can not find moudle xxx</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> template=<span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>可参考《深入浅出Node.js》里的模块系统一节</p>
</li>
</ul>
<h2 id="43、包说明文件"><a href="#43、包说明文件" class="headerlink" title="43、包说明文件"></a>43、包说明文件</h2><p>包说明文件指的是package.json</p>
<p>我们在一个项目中安装了jq,bootstrap,art-template等等以后,但是我们看不出来到底依赖了哪几个包</p>
<p>package.json就是来记录此的</p>
<p>我们在安装包的时候,在后面写上   <code>--save</code>,这样会自动添加到package.json中</p>
<p>这个文件可以通过<code>npm init</code> 自动初始化出来(试一下)</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;npm-demo&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.0.1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;这是一个测试项目&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;lipengzhou&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;art-template&quot;</span>: <span class="string">&quot;^4.12.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;jquery&quot;</span>: <span class="string">&quot;^3.2.1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>有了package以后,即使node_modules丢失,也可以直接<code>npm install</code>,就可以自动把之前安装的依赖重新安装上</p>
<h2 id="44、npm常用命令"><a href="#44、npm常用命令" class="headerlink" title="44、npm常用命令"></a>44、npm常用命令</h2><p><code>node package manager </code></p>
<p>npm有两个含义</p>
<ol>
<li><p>npm网站</p>
<p>用户自己写的包传上来,然后可以供其他人免费使用</p>
</li>
<li><p>npm命令行工具</p>
<p>安装了node就安装了npm</p>
<p><code>npm install --global npm</code>自己升级自己</p>
</li>
</ol>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令:"></a>常用命令:</h4><ul>
<li>npm init<ul>
<li>npm init -y 可以跳过向导,快速生成</li>
</ul>
</li>
<li>npm install<ul>
<li>一次性把dependencies选项中的依赖项全部安装</li>
</ul>
</li>
<li>npm install –no-save包名    只下载,不添加依赖</li>
<li>npm install –save 包名<ul>
<li>下载并保存依赖项(package.json)</li>
<li>npm i -S包名</li>
</ul>
</li>
<li>npm uninstall 包名<ul>
<li>只删除,有依赖项会依然保存</li>
</ul>
</li>
<li>npm uninstall –save包名<ul>
<li>删除的同时也会把依赖信息去除</li>
<li>npm un-S 包名</li>
</ul>
</li>
<li>npm help<ul>
<li>查看使用帮助</li>
</ul>
</li>
<li>npm 命令  –help<ul>
<li>查看指定命令使用帮助</li>
</ul>
</li>
</ul>
<h2 id="45、解决npm被墙问题"><a href="#45、解决npm被墙问题" class="headerlink" title="45、解决npm被墙问题"></a>45、解决npm被墙问题</h2><p>默认npm服务器在国外,有时候会被墙,速度很慢</p>
<p>修改淘宝镜像 百度搜索cnpm</p>
<p><a target="_blank" rel="noopener" href="http://npm.taobao.org/">http://npm.taobao.org</a> 淘宝的团队在国内做的一个备份</p>
<p>安装淘宝的cnpm</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --<span class="built_in">global</span> cnpm</span><br><span class="line"><span class="comment">//global是安装到全局,不能省略</span></span><br></pre></td></tr></table></figure>

<p>接下来在安装包的时候,把之前的npm替换成cnpm</p>
<p>比如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install jquery</span><br><span class="line">替换成</span><br><span class="line">cnpm install jquery</span><br></pre></td></tr></table></figure>

<p>如果不想安装<code>cnpm</code>又想使用淘宝的服务器来下载:</p>
<p><code>npm install jquery --registry=https://registry.npm.taobao.org</code></p>
<p>但是这样很麻烦,每次都要增加参数,我们可以把这个选项加入配置文件中</p>
<p><code>npm config set registry https://registry.npm.taobao.org</code></p>
<p>经过了上面的命令配置,以后所有的<code>npm install</code>都是淘宝镜像</p>
<h2 id="46、express介绍和安装"><a href="#46、express介绍和安装" class="headerlink" title="46、express介绍和安装"></a>46、express介绍和安装</h2><p>原生的http在某些方面变相不足以应对我们的开发需求,所以我们就需要使用框架来加快我们的开发效率,框架的目的是提高效率,让我们的代码更高度统一</p>
<p>在node中,有很多web开发框架,我们这里以学习express为主</p>
<p>官网:<a target="_blank" rel="noopener" href="http://www.expressjs.com/">http://www.expressjs.com</a></p>
<p>node名人TJ是express的作者</p>
<p>node创始人Ryan Dahl,现在不归他了</p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>看官网</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir myapp</span><br><span class="line">$ <span class="built_in">cd</span> myapp</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm init</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install express --save</span><br><span class="line">上面是多此一举</span><br><span class="line">$ npm install express //即可</span><br></pre></td></tr></table></figure>

<p>临时使用不添加依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install express --no-save</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="express基本感知"><a href="#express基本感知" class="headerlink" title="express基本感知"></a>express基本感知</h2><p>项目中新建app.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//0 安装</span></span><br><span class="line"><span class="comment">//1 引包</span></span><br><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">//2创建服务器 应用程序</span></span><br><span class="line"><span class="comment">//			也就是原来的http.createserver</span></span><br><span class="line"><span class="keyword">var</span> app=express();</span><br><span class="line"><span class="comment">//当服务器收到get请求 / 时,执行回调处理函数</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;Hello,express!&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//3 端口号</span></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;app is running at port 3000&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="开放资源"><a href="#开放资源" class="headerlink" title="开放资源"></a>开放资源</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> app=express();</span><br><span class="line">app.use(<span class="string">&#x27;/public/&#x27;</span>,express.static(<span class="string">&#x27;./public/&#x27;</span>))<span class="comment">//只要这样,就可以通过/public/xx的方式去访问public里的所有资源了</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;Hello,express!&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;app is running at port 3000&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h2 id="反馈-复习"><a href="#反馈-复习" class="headerlink" title="反馈+复习"></a>反馈+复习</h2><h2 id="文件操作路径和模块标识路径"><a href="#文件操作路径和模块标识路径" class="headerlink" title="文件操作路径和模块标识路径"></a>文件操作路径和模块标识路径</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fl=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&#x27;data/a.txt&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line"><span class="comment">//fs.readFile(&#x27;/data/a.txt&#x27;,function (err,data) &#123;</span></span><br><span class="line">	<span class="comment">//文件操作中的相对路径可以省略  ./</span></span><br><span class="line">    <span class="comment">// 但是  .  不可以省略,如果省略将到该盘的根目录去寻找</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (err) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&#x27;读取失败&#x27;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">console</span>.log(data.toString())</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//在模块加载中,相对路径中的 ./ 等不能省略</span></span><br><span class="line"><span class="comment">//比如</span></span><br><span class="line"><span class="comment">//require(&#x27;foo.js&#x27;)//错误</span></span><br><span class="line"><span class="comment">// .也不能省略,也会去找根目录</span></span><br></pre></td></tr></table></figure>



<h2 id="express-helloworld"><a href="#express-helloworld" class="headerlink" title="express-helloworld"></a>express-helloworld</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 创建 app</span></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;express app is running ...&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="使用nodemon工具自动重启服务"><a href="#使用nodemon工具自动重启服务" class="headerlink" title="使用nodemon工具自动重启服务"></a>使用nodemon工具自动重启服务</h2><p>我们使用一个第三方工具,<code>nodemon</code>来解决频繁修改代码重启服务器问题</p>
<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -global nodemon</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nodemon app.js</span><br></pre></td></tr></table></figure>

<p>通过nodemon启动的js,会监视文件的变化,将自动启动服务器</p>
<h2 id="express中的static-server静态资源服务"><a href="#express中的static-server静态资源服务" class="headerlink" title="express中的static-server静态资源服务"></a>express中的static-server静态资源服务</h2><h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 路由其实就是一张表</span></span><br><span class="line"><span class="comment">// 这个表里面有具体的映射关系</span></span><br><span class="line"><span class="comment">// xxx 大厦</span></span><br><span class="line"><span class="comment">//    xxx 公司</span></span><br><span class="line"><span class="comment">// 看门的老大爷</span></span><br><span class="line"><span class="comment">//    xxx 公司 15 楼 3 号</span></span><br><span class="line"><span class="comment">//    百度公司 4 楼 5 号</span></span><br><span class="line"><span class="comment">//    。。。</span></span><br><span class="line"><span class="comment">// 经过老大爷，你要去哪个公司</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// app</span></span><br><span class="line"><span class="comment">//   .get(&#x27;/login&#x27;, 函数)</span></span><br><span class="line"><span class="comment">//   .get(&#x27;/dsadsa&#x27;, 函数)</span></span><br><span class="line"><span class="comment">//   .post(&#x27;/d/sadsa&#x27;, 函数)</span></span><br><span class="line"><span class="comment">//   .get(&#x27;dsadsa&#x27;, 函数)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>路由器:</p>
<ul>
<li>请求方法</li>
<li>请求路径</li>
<li>请求处理函数</li>
</ul>
<p>get:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>post:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="在express中配置使用art-template模板引擎"><a href="#在express中配置使用art-template模板引擎" class="headerlink" title="在express中配置使用art-template模板引擎"></a>在express中配置使用art-template模板引擎</h2><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save art-template</span><br><span class="line">npm install --save express-art-template</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">&#x27;index.html&#x27;</span>, &#123;</span><br><span class="line">   <span class="attr">title</span>:<span class="string">&#x27;hello world!&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>如果希望修改默认的views试图渲染存储目录,可以</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注意:第一个参数views不能写错</span></span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>,目录路径)</span><br></pre></td></tr></table></figure>



<h2 id="使用express重写留言板案例"><a href="#使用express重写留言板案例" class="headerlink" title="使用express重写留言板案例"></a>使用express重写留言板案例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/public/&#x27;</span>, express.static(<span class="string">&#x27;./public/&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置使用 art-template 模板引擎</span></span><br><span class="line"><span class="comment">// 第一个参数，表示，当渲染以 .art 结尾的文件的时候，使用 art-template 模板引擎</span></span><br><span class="line"><span class="comment">// express-art-template 是专门用来在 Express 中把 art-template 整合到 Express 中</span></span><br><span class="line"><span class="comment">// 虽然外面这里不需要记载 art-template 但是也必须安装</span></span><br><span class="line"><span class="comment">// 原因就在于 express-art-template 依赖了 art-template</span></span><br><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Express 为 Response 相应对象提供了一个方法：render</span></span><br><span class="line"><span class="comment">// render 方法默认是不可以使用，但是如果配置了模板引擎就可以使用了</span></span><br><span class="line"><span class="comment">// res.render(&#x27;html模板名&#x27;, &#123;模板数据&#125;)</span></span><br><span class="line"><span class="comment">// 第一个参数不能写路径，默认会去项目中的 views 目录查找该模板文件</span></span><br><span class="line"><span class="comment">// 也就是说 Express 有一个约定：开发人员把所有的视图文件都放到 views 目录中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果想要修改默认的 views 目录，则可以</span></span><br><span class="line"><span class="comment">// app.set(&#x27;views&#x27;, render函数的默认路径)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 body-parser 中间件（插件，专门用来解析表单 POST 请求体）</span></span><br><span class="line"><span class="comment">//只要加入这个配置,则在req请求对象上会多出一个属性body</span></span><br><span class="line"><span class="comment">//可以直接通过req.body来获取post请求体数据</span></span><br><span class="line"><span class="comment">// parse application/x-www-form-urlencoded</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"><span class="comment">// parse application/json</span></span><br><span class="line">app.use(bodyParser.json())</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> comments = [&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;今天天气不错！&#x27;</span>,</span><br><span class="line">    <span class="attr">dateTime</span>: <span class="string">&#x27;2015-10-16&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三2&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;今天天气不错！&#x27;</span>,</span><br><span class="line">    <span class="attr">dateTime</span>: <span class="string">&#x27;2015-10-16&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三3&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;今天天气不错！&#x27;</span>,</span><br><span class="line">    <span class="attr">dateTime</span>: <span class="string">&#x27;2015-10-16&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三4&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;今天天气不错！&#x27;</span>,</span><br><span class="line">    <span class="attr">dateTime</span>: <span class="string">&#x27;2015-10-16&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;张三5&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;今天天气不错！&#x27;</span>,</span><br><span class="line">    <span class="attr">dateTime</span>: <span class="string">&#x27;2015-10-16&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">&#x27;index.html&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">comments</span>: comments</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/post&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">&#x27;post.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当以 POST 请求 /post 的时候，执行指定的处理函数</span></span><br><span class="line"><span class="comment">// 这样的话我们就可以利用不同的请求方法让一个请求路径使用多次</span></span><br><span class="line">app.post(<span class="string">&#x27;/post&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 1. 获取表单 POST 请求体数据</span></span><br><span class="line">  <span class="comment">// 2. 处理</span></span><br><span class="line">  <span class="comment">// 3. 发送响应</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// req.query 只能拿 get 请求参数</span></span><br><span class="line">  <span class="comment">// console.log(req.query)</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通过req.body来获取表单post</span></span><br><span class="line">  <span class="keyword">var</span> comment = req.body</span><br><span class="line">  comment.dateTime = <span class="string">&#x27;2017-11-5 10:58:51&#x27;</span></span><br><span class="line">  comments.unshift(comment)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// res.send</span></span><br><span class="line">  <span class="comment">// res.redirect</span></span><br><span class="line">  <span class="comment">// 这些方法 Express 会自动结束响应</span></span><br><span class="line">  res.redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  <span class="comment">// res.statusCode = 302</span></span><br><span class="line">  <span class="comment">// res.setHeader(&#x27;Location&#x27;, &#x27;/&#x27;) </span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.get(&#x27;/pinglun&#x27;, function (req, res) &#123;</span></span><br><span class="line"><span class="comment">//   var comment = req.query</span></span><br><span class="line"><span class="comment">//   comment.dateTime = &#x27;2017-11-5 10:58:51&#x27;</span></span><br><span class="line"><span class="comment">//   comments.unshift(comment)</span></span><br><span class="line"><span class="comment">//   res.redirect(&#x27;/&#x27;)</span></span><br><span class="line"><span class="comment">//   // res.statusCode = 302</span></span><br><span class="line"><span class="comment">//   // res.setHeader(&#x27;Location&#x27;, &#x27;/&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;running...&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>index.html跟之前一样,post页面做个修改</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/post&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        &lt;--这里修改一下--&gt;</span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;input_name&quot;</span>&gt;</span>您的名字<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="在express中配置解析表单post请求体数据"><a href="#在express中配置解析表单post请求体数据" class="headerlink" title="在express中配置解析表单post请求体数据"></a>在express中配置解析表单post请求体数据</h2><h2 id="crud-起步"><a href="#crud-起步" class="headerlink" title="crud-起步"></a>crud-起步</h2><p>新建文件夹<code> mkdir  crud-node</code></p>
<p>切换入crud-node<code>cd crud-node</code></p>
<p>一步初始化文件夹<code>npm init -y</code></p>
<p>装express包<code>npm i -s express</code></p>
<p>新建路径:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">crud-node</span><br><span class="line">	--node_modules</span><br><span class="line">		--.................略</span><br><span class="line">	--public</span><br><span class="line">	--views</span><br><span class="line">		--index.html</span><br><span class="line">	--app.js</span><br><span class="line">	--package.json</span><br><span class="line">	--package-lock.json</span><br></pre></td></tr></table></figure>

<p>app.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app=express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	res.send(<span class="string">&#x27;hello,world!&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;running 3000.....&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在命令行启动服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nodemon app</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//此时我们希望发布的不是&#x27;hello,world&#x27;,而是index.html</span><br><span class="line">于是我们需要安装模板引擎</span><br><span class="line">npm install --save art-template express-art-template</span><br><span class="line">同时安装art-template和express-art-template</span><br></pre></td></tr></table></figure>

<p>app.js代码修改为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> app=express()</span><br><span class="line"></span><br><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>,<span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>))</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	res.render(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;running 3000.....&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>此时我们的index.html还是空白的,我们需要为其添加内容,我们直接去bootstrap官网去用模板</p>
<p><a target="_blank" rel="noopener" href="https://v3.bootcss.com/examples/dashboard/">https://v3.bootcss.com/examples/dashboard/</a></p>
<p>将其源代码copy至index.html</p>
<p>由于该文件中引入了bootstrap,于是我们npm安装本地bootstrap</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i -s bootstrap@3.3.7</span><br><span class="line">这里要下载3.3.7版本,因为上面的网址里用的就是此版本</span><br></pre></td></tr></table></figure>

<p>回到index.html将bootstrap的两个引用换成本地,并且到app.js中将node_modules和public都开放</p>
<p>这一步要非常仔细</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Dashboard Template for Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;/node_modules/bootstrap/dist/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- IE10 viewport hack for Surface/desktop Windows 8 bug --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;link href=&quot;../../assets/css/ie10-viewport-bug-workaround.css&quot; rel=&quot;stylesheet&quot;&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;/public/css/dashboard.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Just for debugging purposes. Don&#x27;t actually copy these 2 lines! --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if lt IE 9]&gt;&lt;script src=&quot;../../assets/js/ie8-responsive-file-warning.js&quot;&gt;&lt;/script&gt;&lt;![endif]--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;script src=&quot;../../assets/js/ie-emulation-modes-warning.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--[if lt IE 9]&gt;</span></span><br><span class="line"><span class="comment">  &lt;script src=&quot;https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">  &lt;script src=&quot;https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">&lt;![endif]--&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后把最下面的<code>&lt;script&gt;</code>标签都删了,我们用不到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app=express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/node_modules&#x27;</span>,express.static(<span class="string">&#x27;./node_modules&#x27;</span>))</span><br><span class="line">app.use(<span class="string">&#x27;/public/&#x27;</span>,express.static(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line"><span class="comment">//开放public和node_modules</span></span><br><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>,<span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>))</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	res.render(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;running 3000.....&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>结束后,我们做个测试</p>
<p>app.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>,<span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>))</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	res.render(<span class="string">&#x27;index.html&#x27;</span>,&#123;</span><br><span class="line">		<span class="attr">fruits</span>:[<span class="string">&#x27;苹果&#x27;</span>,<span class="string">&#x27;橘子&#x27;</span>,<span class="string">&#x27;香蕉&#x27;</span>,<span class="string">&#x27;火龙果&#x27;</span>]</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;page-header&quot;</span>&gt;</span>Dashboard<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row placeholders&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;each fruits&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-6 col-sm-3 placeholder&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span> <span class="attr">class</span>=<span class="string">&quot;img-responsive&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Generic placeholder thumbnail&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;&#123;$value&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text-muted&quot;</span>&gt;</span>Something else<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="从文件中读取数据"><a href="#从文件中读取数据" class="headerlink" title="从文件中读取数据"></a>从文件中读取数据</h2><p>新建db.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;students&quot;</span>:[&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;张三三&quot;</span>,<span class="attr">&quot;gender&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="string">&quot;22&quot;</span>,<span class="attr">&quot;hobbies&quot;</span>:<span class="string">&quot;吃饭、睡觉、打豆豆&quot;</span>&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">2</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;张三三&quot;</span>,<span class="attr">&quot;gender&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="string">&quot;22&quot;</span>,<span class="attr">&quot;hobbies&quot;</span>:<span class="string">&quot;吃饭、睡觉、打豆豆&quot;</span>&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">3</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;张三三&quot;</span>,<span class="attr">&quot;gender&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="string">&quot;22&quot;</span>,<span class="attr">&quot;hobbies&quot;</span>:<span class="string">&quot;吃饭、睡觉、打豆豆&quot;</span>&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">4</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;张三三&quot;</span>,<span class="attr">&quot;gender&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="string">&quot;22&quot;</span>,<span class="attr">&quot;hobbies&quot;</span>:<span class="string">&quot;吃饭、睡觉、打豆豆&quot;</span>&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;张三三&quot;</span>,<span class="attr">&quot;gender&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="string">&quot;22&quot;</span>,<span class="attr">&quot;hobbies&quot;</span>:<span class="string">&quot;吃饭、睡觉、打豆豆&quot;</span>&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">6</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;张三三&quot;</span>,<span class="attr">&quot;gender&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="string">&quot;22&quot;</span>,<span class="attr">&quot;hobbies&quot;</span>:<span class="string">&quot;吃饭、睡觉、打豆豆&quot;</span>&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">7</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;张三三&quot;</span>,<span class="attr">&quot;gender&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="string">&quot;22&quot;</span>,<span class="attr">&quot;hobbies&quot;</span>:<span class="string">&quot;吃饭、睡觉、打豆豆&quot;</span>&#125;,&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">8</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;张三三&quot;</span>,<span class="attr">&quot;gender&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="attr">&quot;age&quot;</span>:<span class="string">&quot;22&quot;</span>,<span class="attr">&quot;hobbies&quot;</span>:<span class="string">&quot;吃饭、睡觉、打豆豆&quot;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p>在app.js中读出该内容,然后赋值到students</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> app=express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/node_modules/&#x27;</span>,express.static(<span class="string">&#x27;./node_modules&#x27;</span>))</span><br><span class="line">app.use(<span class="string">&#x27;/public/&#x27;</span>,express.static(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line"></span><br><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>,<span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>))</span><br><span class="line"><span class="comment">//npm i -s express-art-template art-template</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	fs.readFile(<span class="string">&#x27;./db.json&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> res.send(<span class="string">&#x27;err&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//console.log(data.toString())</span></span><br><span class="line"></span><br><span class="line">		res.render(<span class="string">&#x27;index.html&#x27;</span>,&#123;</span><br><span class="line">			<span class="attr">fruits</span>:[<span class="string">&#x27;apple&#x27;</span>,<span class="string">&#x27;orange&#x27;</span>,<span class="string">&#x27;banana&#x27;</span>,<span class="string">&#x27;bluebarrey&#x27;</span>],</span><br><span class="line">			<span class="attr">students</span>:<span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;server running...&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><h2 id="crud-设计路由"><a href="#crud-设计路由" class="headerlink" title="crud-设计路由"></a>crud-设计路由</h2><h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><table>
<thead>
<tr>
<th>请求方法</th>
<th>请求路径</th>
<th>get 参数</th>
<th>post 参数</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>/studens</td>
<td></td>
<td></td>
<td>渲染首页</td>
</tr>
<tr>
<td>GET</td>
<td>/students/new</td>
<td></td>
<td></td>
<td>渲染添加学生页面</td>
</tr>
<tr>
<td>POST</td>
<td>/studens/new</td>
<td></td>
<td>name、age、gender、hobbies</td>
<td>处理添加学生请求</td>
</tr>
<tr>
<td>GET</td>
<td>/students/edit</td>
<td>id</td>
<td></td>
<td>渲染编辑页面</td>
</tr>
<tr>
<td>POST</td>
<td>/studens/edit</td>
<td></td>
<td>id、name、age、gender、hobbies</td>
<td>处理编辑请求</td>
</tr>
<tr>
<td>GET</td>
<td>/students/delete</td>
<td>id</td>
<td></td>
<td>处理删除请求</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>//《图解HTTP》作者  上野宣</p>
<h2 id="路由模块的提取"><a href="#路由模块的提取" class="headerlink" title="路由模块的提取"></a>路由模块的提取</h2><p>我们如果把上面的路由内容,添加在app.js里,则篇幅会很长,我们既然要做模块化,就要分开</p>
<p>新建router.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/students/new&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">&#x27;/students/new&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">&#x27;/students/new&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">&#x27;/students/new&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">&#x27;/students/new&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">&#x27;/students/new&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是现在在router里没有app,我们能想到的办法就是这样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app=<span class="built_in">require</span>(<span class="string">&#x27;./app&#x27;</span>)</span><br><span class="line">app.get(<span class="string">&#x27;/students/new&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>别忘了在app.js里把app暴露出来,在最后加上</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moudule.exports=app</span><br></pre></td></tr></table></figure>



<p>用上面的方法,我们可以把app导入进来,但是如果这样,我们就需要node router命令了</p>
<p>这是不行的</p>
<p>更合理的方式应该是这样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./router&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/node_modules/&#x27;</span>, express.static(<span class="string">&#x27;./node_modules/&#x27;</span>))</span><br><span class="line">app.use(<span class="string">&#x27;/public/&#x27;</span>, express.static(<span class="string">&#x27;./public/&#x27;</span>))</span><br><span class="line"></span><br><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>))</span><br><span class="line"></span><br><span class="line">router(<span class="string">&quot;test&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;running 3000...&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们首先引入了router模块</p>
<p>然后router(app),在这调用router这个函数,并且传参app进去</p>
<p>那么这个函数在哪里呢,在我们的router.js中</p>
<p><code>router.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports=<span class="function"><span class="keyword">function</span> (<span class="params">app</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(app)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候我们会发现,’test’会被输出出来,那么我们把app.js中的字符串’test’换成变量app</p>
<p>然后修改一下router.js(实际上是把原来app.js中的变量app拿到router.js中了)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports=<span class="function"><span class="keyword">function</span> (<span class="params">app</span>) </span>&#123;</span><br><span class="line">	app.get(<span class="string">&#x27;/students&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">/***********************读文件**************************/</span></span><br><span class="line">	fs.readFile(<span class="string">&#x27;./db.json&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// 读文件的时候,第二个参数是可选的,写上utf8就是告诉它把读取到的文件直接按照utf8编码</span></span><br><span class="line">		<span class="comment">//当然,我们也可以通过data.toString()的方式</span></span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error...&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">console</span>.log( <span class="built_in">JSON</span>.parse(data).students)</span><br><span class="line">		res.render(<span class="string">&#x27;index.html&#x27;</span>,&#123;</span><br><span class="line">			<span class="attr">fruits</span>:[<span class="string">&#x27;苹果&#x27;</span>,<span class="string">&#x27;橘子&#x27;</span>,<span class="string">&#x27;香蕉&#x27;</span>,<span class="string">&#x27;火龙果&#x27;</span>],</span><br><span class="line">			<span class="attr">students</span>: <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line"><span class="comment">/***************读文件结束*************************/</span>	</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意:由于在本文件中用到了fs,所以应该在本模块引入fs</p>
<p>实际上上面的方法还不错,但是还是不方便,express提供了一种更好的方式,专门用来包装路由</p>
<p><code>router.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//1创建一个路由容器</span></span><br><span class="line"><span class="keyword">var</span> router=express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">//2把所有的路由都挂载到router容器中</span></span><br><span class="line">router.get(<span class="string">&#x27;/students&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">/***********************读文件**************************/</span></span><br><span class="line">	fs.readFile(<span class="string">&#x27;./db.json&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// 读文件的时候,第二个参数是可选的,写上utf8就是告诉它把读取到的文件直接按照utf8编码</span></span><br><span class="line">		<span class="comment">//当然,我们也可以通过data.toString()的方式</span></span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error...&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">console</span>.log( <span class="built_in">JSON</span>.parse(data).students)</span><br><span class="line">		res.render(<span class="string">&#x27;index.html&#x27;</span>,&#123;</span><br><span class="line">			<span class="attr">fruits</span>:[<span class="string">&#x27;苹果&#x27;</span>,<span class="string">&#x27;橘子&#x27;</span>,<span class="string">&#x27;香蕉&#x27;</span>,<span class="string">&#x27;火龙果&#x27;</span>],</span><br><span class="line">			<span class="attr">students</span>: <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"><span class="comment">/***************读文件结束*************************/</span>	</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//3把router导出</span></span><br><span class="line"><span class="built_in">module</span>.exports=router</span><br></pre></td></tr></table></figure>

<p>总共分了三步,分别是创建路由,挂载到router,导出router,然后第四步是回到app.js中</p>
<p>将原来的router(app)删了,改成</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> app=express()</span><br><span class="line"><span class="keyword">var</span> router=<span class="built_in">require</span>(<span class="string">&#x27;./router&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/node_modules&#x27;</span>,express.static(<span class="string">&#x27;./node_modules&#x27;</span>))</span><br><span class="line">app.use(<span class="string">&#x27;/public/&#x27;</span>,express.static(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>,<span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//router(app)</span></span><br><span class="line"><span class="comment">//4把路由容器挂载到app服务中</span></span><br><span class="line">app.use(router)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;running 3000.....&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>模块职责要单一</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * app.js 入门模块</span></span><br><span class="line"><span class="comment"> * 职责：</span></span><br><span class="line"><span class="comment"> *   创建服务</span></span><br><span class="line"><span class="comment"> *   做一些服务相关配置</span></span><br><span class="line"><span class="comment"> *     模板引擎</span></span><br><span class="line"><span class="comment"> *     body-parser 解析表单 post 请求体</span></span><br><span class="line"><span class="comment"> *     提供静态资源服务</span></span><br><span class="line"><span class="comment"> *   挂载路由</span></span><br><span class="line"><span class="comment"> *   监听端口启动服务</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * router.js 路由模块</span></span><br><span class="line"><span class="comment"> * 职责：</span></span><br><span class="line"><span class="comment"> *   处理路由</span></span><br><span class="line"><span class="comment"> *   根据不同的请求方法+请求路径设置具体的请求处理函数</span></span><br><span class="line"><span class="comment"> * 模块职责要单一，不要乱写</span></span><br><span class="line"><span class="comment"> * 我们划分模块的目的就是为了增强项目代码的可维护性</span></span><br><span class="line"><span class="comment"> * 提升开发效率</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>当然这时候,我们的router.js中只配置了一个路由,我们按照上面的表格中的配置重写一下router.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//1创建一个路由容器</span></span><br><span class="line"><span class="keyword">var</span> router=express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">//2把所有的路由都挂载到router容器中</span></span><br><span class="line">router.get(<span class="string">&#x27;/students&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">/***********************读文件**************************/</span></span><br><span class="line">	fs.readFile(<span class="string">&#x27;./db.json&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// 读文件的时候,第二个参数是可选的,写上utf8就是告诉它把读取到的文件直接按照utf8编码</span></span><br><span class="line">		<span class="comment">//当然,我们也可以通过data.toString()的方式</span></span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error...&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">console</span>.log( <span class="built_in">JSON</span>.parse(data).students)</span><br><span class="line">		res.render(<span class="string">&#x27;index.html&#x27;</span>,&#123;</span><br><span class="line">			<span class="attr">fruits</span>:[<span class="string">&#x27;苹果&#x27;</span>,<span class="string">&#x27;橘子&#x27;</span>,<span class="string">&#x27;香蕉&#x27;</span>,<span class="string">&#x27;火龙果&#x27;</span>],</span><br><span class="line">			<span class="attr">students</span>: <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line"><span class="comment">/***************读文件结束*************************/</span>	</span><br><span class="line">&#125;)</span><br><span class="line">router.get(<span class="string">&#x27;/students/new&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line">router.post(<span class="string">&#x27;/students/new&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line">router.get(<span class="string">&#x27;/students/edit&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line">router.post(<span class="string">&#x27;/students/edit&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line">router.get(<span class="string">&#x27;/students/delet&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//3把router导出</span></span><br><span class="line"><span class="built_in">module</span>.exports=router</span><br></pre></td></tr></table></figure>



<h2 id="处理添加页面及配置body-parser"><a href="#处理添加页面及配置body-parser" class="headerlink" title="处理添加页面及配置body-parser"></a>处理添加页面及配置body-parser</h2><p>在views文件夹中新建new.html,然后把index.html中的代码复制进去,但是要修改几点</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../../favicon.ico&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Dashboard Template for Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;/node_modules/bootstrap/dist/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- IE10 viewport hack for Surface/desktop Windows 8 bug --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;link href=&quot;../../assets/css/ie10-viewport-bug-workaround.css&quot; rel=&quot;stylesheet&quot;&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;/public/css/dashboard.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Just for debugging purposes. Don&#x27;t actually copy these 2 lines! --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--[if lt IE 9]&gt;&lt;script src=&quot;../../assets/js/ie8-responsive-file-warning.js&quot;&gt;&lt;/script&gt;&lt;![endif]--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;script src=&quot;../../assets/js/ie-emulation-modes-warning.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--[if lt IE 9]&gt;</span></span><br><span class="line"><span class="comment">      &lt;script src=&quot;https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">      &lt;script src=&quot;https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">    &lt;![endif]--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-inverse navbar-fixed-top&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container-fluid&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-header&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;navbar-toggle collapsed&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;collapse&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#navbar&quot;</span> <span class="attr">aria-expanded</span>=<span class="string">&quot;false&quot;</span> <span class="attr">aria-controls</span>=<span class="string">&quot;navbar&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;navbar-brand&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Project name<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;navbar&quot;</span> <span class="attr">class</span>=<span class="string">&quot;navbar-collapse collapse&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav navbar-nav navbar-right&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Dashboard<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Settings<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Profile<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Help<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;navbar-form navbar-right&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Search...&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container-fluid&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-3 col-md-2 sidebar&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav nav-sidebar&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Overview <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Reports<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Analytics<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Export<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav nav-sidebar&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>Nav item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>Nav item again<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>One more nav<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>Another nav item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>More navigation<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav nav-sidebar&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>Nav item again<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>One more nav<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>Another nav item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 下面这些圈不要了 --&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--   &lt;h1 class=&quot;page-header&quot;&gt;Dashboard&lt;/h1&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         &lt;div class=&quot;row placeholders&quot;&gt;</span></span><br><span class="line"><span class="comment">            &#123;&#123;each fruits&#125;&#125;</span></span><br><span class="line"><span class="comment">            &lt;div class=&quot;col-xs-6 col-sm-3 placeholder&quot;&gt;</span></span><br><span class="line"><span class="comment">              &lt;img src=&quot;data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==&quot; width=&quot;200&quot; height=&quot;200&quot; class=&quot;img-responsive&quot; alt=&quot;Generic placeholder thumbnail&quot;&gt;</span></span><br><span class="line"><span class="comment">              &lt;h4&gt;&#123;&#123;$value&#125;&#125;&lt;/h4&gt;</span></span><br><span class="line"><span class="comment">              &lt;span class=&quot;text-muted&quot;&gt;Something else&lt;/span&gt;</span></span><br><span class="line"><span class="comment">            &lt;/div&gt;</span></span><br><span class="line"><span class="comment">            &#123;&#123;/each&#125;&#125;</span></span><br><span class="line"><span class="comment">          &lt;/div&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;sub-header&quot;</span>&gt;</span>添加学生<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 1.这里改成添加学生 --&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- /************************此处添加按钮********************************/ --&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- &lt;a class=&quot;btn btn-primary&quot; href=&quot;&quot;&gt;添加学生&lt;/a&gt; --&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 2.a标签去掉 --&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 3.下面的整个table表格不要,换成表单(表单去bootstrap3文档中复制) --&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- &lt;div class=&quot;table-responsive&quot;&gt;</span></span><br><span class="line"><span class="comment">            &lt;table class=&quot;table table-striped&quot;&gt;</span></span><br><span class="line"><span class="comment">              &lt;thead&gt;</span></span><br><span class="line"><span class="comment">                &lt;tr&gt;</span></span><br><span class="line"><span class="comment">                  &lt;th&gt;#&lt;/th&gt;</span></span><br><span class="line"><span class="comment">                  &lt;th&gt;姓名&lt;/th&gt;</span></span><br><span class="line"><span class="comment">                  &lt;th&gt;性别&lt;/th&gt;</span></span><br><span class="line"><span class="comment">                  &lt;th&gt;年龄&lt;/th&gt;</span></span><br><span class="line"><span class="comment">                  &lt;th&gt;爱好&lt;/th&gt;</span></span><br><span class="line"><span class="comment">                &lt;/tr&gt;</span></span><br><span class="line"><span class="comment">              &lt;/thead&gt;</span></span><br><span class="line"><span class="comment">              &lt;tbody&gt;</span></span><br><span class="line"><span class="comment">                &#123;&#123;each students&#125;&#125;</span></span><br><span class="line"><span class="comment">                &lt;tr&gt;</span></span><br><span class="line"><span class="comment">                  &lt;td&gt;&#123;&#123;$value.id&#125;&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                  &lt;td&gt;&#123;&#123;$value.name&#125;&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                  &lt;td&gt;&#123;&#123;$value.gender&#125;&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                  &lt;td&gt;&#123;&#123;$value.age&#125;&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                  &lt;td&gt;&#123;&#123;$value.hobbies&#125;&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                &lt;/tr&gt;</span></span><br><span class="line"><span class="comment">                &#123;&#123;/each&#125;&#125;</span></span><br><span class="line"><span class="comment">              &lt;/tbody&gt;</span></span><br><span class="line"><span class="comment">            &lt;/table&gt;</span></span><br><span class="line"><span class="comment">          &lt;/div&gt; --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;exampleInputEmail1&quot;</span>&gt;</span>Email address<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&quot;exampleInputEmail1&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Email&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;exampleInputPassword1&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&quot;exampleInputPassword1&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Password&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;exampleInputFile&quot;</span>&gt;</span>File input<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;exampleInputFile&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;help-block&quot;</span>&gt;</span>Example block-level help text here.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span> Check me out</span><br><span class="line">                <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/students/new&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	res.render(<span class="string">&#x27;new.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>把index.html中,添加学生的a标签中的路径改了</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/students/new&quot;</span>&gt;</span>添加学生<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样,我们在index.html中就可以直接点击跳转到new页面了</p>
<p>接下来,我们修改一下form表单</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/students/new&quot;</span> <span class="attr">method</span>=<span class="string">&#x27;post&#x27;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- email改成姓名 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&quot;</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- type改成text,添加name --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span><span class="attr">name</span>=<span class="string">&#x27;name&#x27;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Email&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 改成性别 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&quot;</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 后面也不是password了,而是单选框,bootstrap中的单选框我们要到文档中去复制 --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- &lt;input type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;exampleInputPassword1&quot; placeholder=&quot;Password&quot;&gt; --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;radio-inline&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">id</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span> 男</span><br><span class="line">       <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;radio-inline&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>  <span class="attr">id</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span> 女</span><br><span class="line">       <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&quot;</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span><span class="attr">id</span>=<span class="string">&quot;&quot;</span><span class="attr">name</span>=<span class="string">&#x27;age&#x27;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">label</span>&gt;</span>爱好<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span><span class="attr">name</span>=<span class="string">&quot;hobbies&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来,我们回到router.js中,配置路由</p>
<p>一共分三步</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/students/new&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.获取表单数据(但是在express中,获取post的api,要用body-parser)</span></span><br><span class="line">	<span class="comment">// 2.处理</span></span><br><span class="line">	<span class="comment">// 3.发送响应</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>第一步,获取表单数据,配置body-parser</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// var fs=require(&#x27;fs&#x27;)</span></span><br><span class="line"><span class="keyword">var</span> app=express()</span><br><span class="line"><span class="keyword">var</span> router=<span class="built_in">require</span>(<span class="string">&#x27;./router&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> bodyParser=<span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)<span class="comment">//别忘了引入</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/node_modules&#x27;</span>,express.static(<span class="string">&#x27;./node_modules&#x27;</span>))</span><br><span class="line">app.use(<span class="string">&#x27;/public/&#x27;</span>,express.static(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>,<span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置模板引擎和body-parser一定要在app.use(router)挂载路由之前,固定写法</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;))</span><br><span class="line">app.use(bodyParser.json())</span><br><span class="line"></span><br><span class="line"><span class="comment">//router(app)</span></span><br><span class="line"><span class="comment">//把路由容器挂载到app服务中</span></span><br><span class="line">app.use(router)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;running 3000.....&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>然后回到路由文件中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/students/new&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.获取表单数据</span></span><br><span class="line">	<span class="comment">// 2.处理</span></span><br><span class="line">	<span class="comment">// 3.发送响应</span></span><br><span class="line">	<span class="built_in">console</span>.log(req.body)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在new页面输入内容,提交,会在命令行看到输出,这说明我们拿到数据了</p>
<p>接下来是第二步,来处理</p>
<p>将数据保存到db.json文件中,将数据持久化</p>
<p>由于我们写入文件将会把之前的数据都覆盖掉,所以我们只能将之前的数据(字符串的格式)读出来,转化成对象,提取出数组,再往数组里面添加(push)新的元素,然后再转化成字符串写入</p>
<p>当我们在router中,读取文件的时候,我们发现,在上面这里已经读取过一次了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/students&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">/***********************读文件**************************/</span></span><br><span class="line">	fs.readFile(<span class="string">&#x27;./db.json&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// 读文件的时候,第二个参数是可选的,写上utf8就是告诉它把读取到的文件直接按照utf8编码</span></span><br><span class="line">		<span class="comment">//当然,我们也可以通过data.toString()的方式</span></span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error...&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">console</span>.log( <span class="built_in">JSON</span>.parse(data).students)</span><br><span class="line">		res.render(<span class="string">&#x27;index.html&#x27;</span>,&#123;</span><br><span class="line">			<span class="attr">fruits</span>:[<span class="string">&#x27;苹果&#x27;</span>,<span class="string">&#x27;橘子&#x27;</span>,<span class="string">&#x27;香蕉&#x27;</span>,<span class="string">&#x27;火龙果&#x27;</span>],</span><br><span class="line">			<span class="attr">students</span>: <span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line"><span class="comment">/***************读文件结束*************************/</span>	</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>我们反复去读取文件势必又导致了代码的冗余,于是我们将文件处理封装成一个模块,新建一个students.js</p>
<h2 id="封装提取student数据操作模块"><a href="#封装提取student数据操作模块" class="headerlink" title="封装提取student数据操作模块"></a>封装提取student数据操作模块</h2><p><code>students.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">数据操作文件模块</span></span><br><span class="line"><span class="comment">职责:操作文件中的数据,只处理数据,不关心业务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="comment">/*获取所有学生列表*/</span></span><br><span class="line"><span class="built_in">exports</span>.find=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	fs.readFile(dbPath,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">		<span class="comment">//JSON.parse(data)把读到的data转换成对象</span></span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="comment">//但是这里存在一个致命的问题,读文件是一个异步操作,readFile还没读完,后面的代码就继续执行了</span></span><br><span class="line">	<span class="comment">//怎么办?----用回调函数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*添加保存学生*/</span></span><br><span class="line"><span class="built_in">exports</span>.save=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*更新学生*/</span></span><br><span class="line"><span class="built_in">exports</span>.update=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*删除学生*/</span></span><br><span class="line"><span class="built_in">exports</span>.delete=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>思考下面代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> data=<span class="string">&#x27;hello&#x27;</span></span><br><span class="line">		</span><br><span class="line">	&#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用fn,得到data</span></span><br><span class="line">fn()</span><br><span class="line"><span class="built_in">console</span>.log(data)</span><br></pre></td></tr></table></figure>

<p>我们会发现,无论我们在这里面怎样return都无法在外面得到data</p>
<p>我们可以这样通过回调函数来获取</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//var callback=function(data)&#123;console.log(data)&#125;</span></span><br><span class="line">	<span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> data=<span class="string">&#x27;hello&#x27;</span></span><br><span class="line">		callback(data)</span><br><span class="line">	&#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用fn,得到data</span></span><br><span class="line">fn(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>回调函数,获取异步操作的结果</code></p>
<p>所以我们的代码改为</p>
<p><code>router.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> Students=<span class="built_in">require</span>(<span class="string">&#x27;./students&#x27;</span>)</span><br><span class="line"><span class="comment">//1创建一个路由容器</span></span><br><span class="line"><span class="keyword">var</span> router=express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">//2把所有的路由都挂载到router容器中</span></span><br><span class="line">router.get(<span class="string">&#x27;/students&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">/***********************读文件**************************/</span></span><br><span class="line"><span class="comment">/*	fs.readFile(&#x27;./db.json&#x27;,&#x27;utf8&#x27;,function (err,data) &#123;</span></span><br><span class="line"><span class="comment">		// 读文件的时候,第二个参数是可选的,写上utf8就是告诉它把读取到的文件直接按照utf8编码</span></span><br><span class="line"><span class="comment">		//当然,我们也可以通过data.toString()的方式</span></span><br><span class="line"><span class="comment">		if(err)&#123;</span></span><br><span class="line"><span class="comment">			return res.status(500).send(&#x27;Server error...&#x27;)</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">		console.log( JSON.parse(data).students)</span></span><br><span class="line"><span class="comment">		res.render(&#x27;index.html&#x27;,&#123;</span></span><br><span class="line"><span class="comment">			fruits:[&#x27;苹果&#x27;,&#x27;橘子&#x27;,&#x27;香蕉&#x27;,&#x27;火龙果&#x27;],</span></span><br><span class="line"><span class="comment">			students: JSON.parse(data).students</span></span><br><span class="line"><span class="comment">		&#125;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	&#125;)*/</span></span><br><span class="line">	Students.find(<span class="function"><span class="keyword">function</span> (<span class="params">err,students</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		res.render(<span class="string">&#x27;index.html&#x27;</span>,&#123;</span><br><span class="line">				<span class="attr">fruits</span>:[<span class="string">&#x27;苹果&#x27;</span>,<span class="string">&#x27;橘子&#x27;</span>,<span class="string">&#x27;香蕉&#x27;</span>,<span class="string">&#x27;火龙果&#x27;</span>],</span><br><span class="line">				<span class="attr">students</span>: students</span><br><span class="line">			&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"><span class="comment">/***************读文件结束*************************/</span>	</span><br><span class="line">&#125;)</span><br><span class="line">router.get(<span class="string">&#x27;/students/new&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	res.render(<span class="string">&#x27;new.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">router.post(<span class="string">&#x27;/students/new&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.获取表单数据</span></span><br><span class="line">	<span class="comment">// 2.处理</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3.发送响应</span></span><br><span class="line">	<span class="built_in">console</span>.log(req.body)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">router.get(<span class="string">&#x27;/students/edit&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line">router.post(<span class="string">&#x27;/students/new&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line">router.get(<span class="string">&#x27;/students/delet&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//3把router导出</span></span><br><span class="line"><span class="built_in">module</span>.exports=router</span><br></pre></td></tr></table></figure>

<p><code>students.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*获取所有学生列表</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">exports</span>.find=<span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">	fs.readFile(dbPath,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//第二个参数指定编码格式,可选</span></span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> callback(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/*callback中的参数,</span></span><br><span class="line"><span class="comment">			第一个是err,</span></span><br><span class="line"><span class="comment">				成功是null</span></span><br><span class="line"><span class="comment">				失败是错误对象</span></span><br><span class="line"><span class="comment">			第二个是data</span></span><br><span class="line"><span class="comment">				成功是 数组</span></span><br><span class="line"><span class="comment">				失败是undefined</span></span><br><span class="line"><span class="comment">			*/</span></span><br><span class="line">		callback(<span class="literal">null</span>,<span class="built_in">JSON</span>.parse(data).students)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打开<code>http://127.0.0.1:3000/students/</code>,还是正常的显示我们的数据,说明我们读文件的修改是正确的</p>
<h2 id="封装保存学生的api"><a href="#封装保存学生的api" class="headerlink" title="封装保存学生的api"></a>封装保存学生的api</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*添加保存学生</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">exports</span>.save=<span class="function"><span class="keyword">function</span> (<span class="params">student,callback</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//这里也是异步操作,所以也需要回调函数,而且还需要传进去学生</span></span><br><span class="line">	fs.readFile(dbPath,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> callback(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">var</span> students=<span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">		<span class="comment">//在这里获取到的JSON.parse(data)是对象,JSON.parse(data).students是数组</span></span><br><span class="line">		<span class="comment">//接下来要处理id的问题,在数据库里,id是不可以重复的,即使该数据被删除,该id也是不可重复的</span></span><br><span class="line">		<span class="comment">// 但是我们现在在文件里,处理的简单一点,我们找到最后一个对象的id,去再加1</span></span><br><span class="line">		student.id=students[students.length-<span class="number">1</span>].id+<span class="number">1</span></span><br><span class="line">		students.push(student)</span><br><span class="line">		<span class="comment">//现在的students还是一个对象,怎么转成字符串呢?</span></span><br><span class="line">		<span class="keyword">var</span> result=<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">			<span class="attr">students</span>:students</span><br><span class="line">		&#125;)</span><br><span class="line">		fs.writeFile(dbPath,result,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(err)&#123;</span><br><span class="line">				<span class="comment">//错误就把错误对象传给它</span></span><br><span class="line">				<span class="keyword">return</span> callback(err)</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//没有错误就是成功,错误对象就是null</span></span><br><span class="line">			callback(<span class="literal">null</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用的时候应该这样:</span></span><br><span class="line"><span class="comment">/*save(&#123;</span></span><br><span class="line"><span class="comment">	name:&#x27;xx&#x27;,</span></span><br><span class="line"><span class="comment">	age:18</span></span><br><span class="line"><span class="comment">&#125;,function (err) &#123;</span></span><br><span class="line"><span class="comment">	if(err)&#123;</span></span><br><span class="line"><span class="comment">		console.log(&#x27;保存失败&#x27;)</span></span><br><span class="line"><span class="comment">	&#125;else&#123;</span></span><br><span class="line"><span class="comment">		console.log(&#x27;保存成功&#x27;)</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><code>router.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/students/new&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.获取表单数据</span></span><br><span class="line">	<span class="comment">// 2.处理</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3.发送响应</span></span><br><span class="line">	<span class="built_in">console</span>.log(req.body)</span><br><span class="line">	Students.save(req.body,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		res.redirect(<span class="string">&#x27;/students&#x27;</span>)</span><br><span class="line">		<span class="comment">//跳转回students页面,重新读(更新后的)文件</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>回调函数,封装异步api才是node之终极奥义!!!</p>
<h2 id="强调回调函数"><a href="#强调回调函数" class="headerlink" title="强调回调函数"></a>强调回调函数</h2><h2 id="完成渲染编辑学生页面"><a href="#完成渲染编辑学生页面" class="headerlink" title="完成渲染编辑学生页面"></a>完成渲染编辑学生页面</h2><p><code>students.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*更新学生</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">exports</span>.update=<span class="function"><span class="keyword">function</span> (<span class="params">student,callback</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//我们要通过id来进行更新</span></span><br><span class="line">	<span class="comment">//首先还是读文件</span></span><br><span class="line">	fs.readFile(dbPath,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> callback(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">var</span> students=<span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">		<span class="comment">// 要修改谁,就要把谁找出来</span></span><br><span class="line">		<span class="comment">//用es6中的数组方法:find</span></span><br><span class="line">		<span class="comment">//当某个遍历项符合条件item.id===student.id时候,find会终止遍历,同事返回遍历项</span></span><br><span class="line">		<span class="keyword">var</span> stu=students.find(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> item.id===student.id</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="comment">//则接下来,赋值即可</span></span><br><span class="line">		<span class="comment">/*stu.name=student.name</span></span><br><span class="line"><span class="comment">		stu.age=student.age</span></span><br><span class="line"><span class="comment">		...</span></span><br><span class="line"><span class="comment">		这样的方式太麻烦,我们有三项,就写三个,有十项就写十个?用循环*/</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> student)&#123;</span><br><span class="line">			stu[key]=student[key]</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// student是传进来的参数,是新的</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 接下来就要重新写入了,直接到上面去复制即可</span></span><br><span class="line">		<span class="comment">/*********************上面复制下的**************/</span></span><br><span class="line">		<span class="comment">//现在的students还是一个对象,怎么转成字符串呢?</span></span><br><span class="line">		<span class="keyword">var</span> result=<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">			<span class="attr">students</span>:students</span><br><span class="line">		&#125;)</span><br><span class="line">		fs.writeFile(dbPath,result,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(err)&#123;</span><br><span class="line">				<span class="comment">//错误就把错误对象传给它</span></span><br><span class="line">				<span class="keyword">return</span> callback(err)</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//没有错误就是成功,错误对象就是null</span></span><br><span class="line">			callback(<span class="literal">null</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="comment">/*********************复制结束**************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*updata(&#123;</span></span><br><span class="line"><span class="comment">	id:1,</span></span><br><span class="line"><span class="comment">	name:&#x27;xx&#x27;,</span></span><br><span class="line"><span class="comment">	age:15</span></span><br><span class="line"><span class="comment">&#125;,function (err) &#123;</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">&#125;)*/</span></span><br></pre></td></tr></table></figure>

<p><code>router.js</code>简单测试一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> Students=<span class="built_in">require</span>(<span class="string">&#x27;./students&#x27;</span>)</span><br><span class="line"></span><br><span class="line">Students.update(&#123;</span><br><span class="line">	<span class="attr">id</span>:<span class="number">1</span>,</span><br><span class="line">	<span class="attr">name</span>:<span class="string">&#x27;张小三&#x27;</span>,</span><br><span class="line">	<span class="attr">age</span>:<span class="number">19</span></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(err)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&#x27;修改失败&#x27;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&quot;修改成功&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//1创建一个路由容器</span></span><br><span class="line"><span class="keyword">var</span> router=express.Router()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们去查看db.json,是已经修改成功了的</p>
<p>回到index.html</p>
<p>添加<code>操作</code>一栏,添加编辑和删除按钮</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-striped&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span>&gt;</span>#<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span>&gt;</span>爱好<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                &#123;&#123;each students&#125;&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.gender&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.age&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.hobbies&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/students/edit?id=&#123;&#123;$value.id&#125;&#125;&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/students/delete?id=&#123;&#123;$value.id&#125;&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;&#123;/each&#125;&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>studnts.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*获取所有学生列表</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">exports</span>.find=<span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">	fs.readFile(dbPath,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> callback(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/*callback中的参数,</span></span><br><span class="line"><span class="comment">			第一个是err,</span></span><br><span class="line"><span class="comment">				成功是null</span></span><br><span class="line"><span class="comment">				失败是错误对象</span></span><br><span class="line"><span class="comment">			第二个是data</span></span><br><span class="line"><span class="comment">				成功是 数组</span></span><br><span class="line"><span class="comment">				失败是undefined</span></span><br><span class="line"><span class="comment">			*/</span></span><br><span class="line">		callback(<span class="literal">null</span>,<span class="built_in">JSON</span>.parse(data).students)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下面是新增的代码</span></span><br><span class="line"><span class="comment">// 通过id来选择对应的对象</span></span><br><span class="line"><span class="built_in">exports</span>.findById=<span class="function"><span class="keyword">function</span> (<span class="params">id,callback</span>) </span>&#123;</span><br><span class="line">	fs.readFile(dbPath,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> callback(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">var</span> students=<span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">		<span class="keyword">var</span> result=students.find(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> item.id===id</span><br><span class="line">		&#125;)</span><br><span class="line">		callback(<span class="literal">null</span>,result)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后router.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/students/edit&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.在客户端的列表页中处理链接问题(需要有id参数)</span></span><br><span class="line">	<span class="comment">//2.获取要编辑的学生id</span></span><br><span class="line">	<span class="comment">//3.渲染编辑页面</span></span><br><span class="line">	<span class="built_in">console</span>.log(req.query.id)</span><br><span class="line">	Students.findById(<span class="built_in">parseInt</span>(req.query.id),<span class="function"><span class="keyword">function</span> (<span class="params">err,student </span>) </span>&#123;</span><br><span class="line">        <span class="comment">//这里必须把req.query.id处理成数字,如果是字符串会出错</span></span><br><span class="line">        <span class="comment">//如果不想处理成数字,也可以在student.js中,判断条件那里的全等===改成==</span></span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">console</span>.log(student)</span><br><span class="line">		<span class="comment">// res.redirect(&#x27;./students&#x27;)</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这时候,我们在<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/students%E7%82%B9%E5%87%BB%E6%9F%90%E4%B8%AA%E7%BC%96%E8%BE%91,%E5%B0%B1%E4%BC%9A%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%BE%93%E5%87%BA%E5%AF%B9%E5%BA%94%E7%9A%84id%E5%92%8Cstudent">http://127.0.0.1:3000/students点击某个编辑,就会在命令行输出对应的id和student</a></p>
<p>然后继续修改router.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/students/edit&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.在客户端的列表页中处理链接问题(需要有id参数)</span></span><br><span class="line">	<span class="comment">//2.获取要编辑的学生id</span></span><br><span class="line">	<span class="comment">//3.渲染编辑页面</span></span><br><span class="line">	<span class="built_in">console</span>.log(req.query.id)</span><br><span class="line">	Students.findById(<span class="built_in">parseInt</span>(req.query.id),<span class="function"><span class="keyword">function</span> (<span class="params">err,student </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">console</span>.log(student)</span><br><span class="line">		res.render(<span class="string">&#x27;edit.html&#x27;</span>,&#123;</span><br><span class="line">			<span class="attr">student</span>:student</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>新建一个edit.html</p>
<p>把new.html复制粘贴入edit.html,做部分修改</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/students/new&quot;</span> <span class="attr">method</span>=<span class="string">&#x27;post&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- email改成姓名 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&quot;</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- type改成text,添加name --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span><span class="attr">name</span>=<span class="string">&#x27;name&#x27;</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;姓名&quot;</span> <span class="attr">value</span>=<span class="string">&#123;&#123;student.name&#125;&#125;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 改成性别 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&quot;</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 后面也不是password了,而是单选框,bootstrap中的单选框我们要到文档中去复制 --&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- &lt;input type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;exampleInputPassword1&quot; placeholder=&quot;Password&quot;&gt; --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;radio-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">id</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span> 男</span><br><span class="line">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;radio-inline&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span>  <span class="attr">id</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span> 女</span><br><span class="line">          <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&quot;</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span><span class="attr">id</span>=<span class="string">&quot;&quot;</span><span class="attr">name</span>=<span class="string">&#x27;age&#x27;</span><span class="attr">value</span>=<span class="string">&quot;&#123;&#123;student.age&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span>&gt;</span>爱好<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span><span class="attr">name</span>=<span class="string">&quot;hobbies&quot;</span><span class="attr">value</span>=<span class="string">&#123;&#123;student.hobbies&#125;&#125;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加了三个value</p>
<h2 id="实现更新功能"><a href="#实现更新功能" class="headerlink" title="实现更新功能"></a>实现更新功能</h2><p>我们需要通过id来获取某个student</p>
<p>在edit.html中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/students/edit&quot;</span> <span class="attr">method</span>=<span class="string">&#x27;post&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;student.id&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 不希望用户看见,但是需要被提交到服务端的数据 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- email改成姓名 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;&quot;</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>router.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/students/edit&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.处理表单数据</span></span><br><span class="line">	<span class="comment">// 		req.body</span></span><br><span class="line">	<span class="comment">// 2.更新</span></span><br><span class="line">			<span class="comment">// Students.update()</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//发送响应</span></span><br><span class="line">	<span class="built_in">console</span>.log(req.body)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这时候,我们在edit页面,点击submit,命令行将输出对应的student</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/students/edit&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.处理表单数据</span></span><br><span class="line">	<span class="comment">// 		req.body</span></span><br><span class="line">	<span class="comment">// 2.更新</span></span><br><span class="line">			<span class="comment">// Students.update()</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//发送响应</span></span><br><span class="line">	<span class="comment">// console.log(req.body)</span></span><br><span class="line">	Students.update(req.body,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		res.redirect(<span class="string">&#x27;/students&#x27;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>运行报错,是因为,我们之前设置的全等号<code>===</code>,原先是字符串,改成parseInt(id)即可(两个还是三个地方都要改,仔细看看)</p>
<p>留了个坑,编辑完一次后,再次编辑就出错了?</p>
<p>检查一下db.json发现编辑后再存入的时候,id存成了字符串</p>
<p>所以我们去students.js中,修改update</p>
<p>在for循环之前,把字符串处理成数字就行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">student.id=<span class="built_in">parseInt</span>(student.id)</span><br></pre></td></tr></table></figure>



<h2 id="完成删除功能"><a href="#完成删除功能" class="headerlink" title="完成删除功能"></a>完成删除功能</h2><p><code>students.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*删除学生*/</span></span><br><span class="line"><span class="built_in">exports</span>.delete=<span class="function"><span class="keyword">function</span> (<span class="params">id,callback</span>) </span>&#123;</span><br><span class="line">	fs.readFile(dbPath,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) &#123;</span><br><span class="line">		<span class="keyword">return</span> callback(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> students=<span class="built_in">JSON</span>.parse(data).students</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// findIndex方法专门用来根据条件查找元素的下标</span></span><br><span class="line">	<span class="keyword">var</span> deleteId=students.findIndex(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> item.id===<span class="built_in">parseInt</span>(id)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="comment">// 根据下标从数组中删除对应的学生对象</span></span><br><span class="line">	students.splice(deleteId,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 然后要重新把剩下的写入,下面代码直接去上面的save中复制</span></span><br><span class="line">	<span class="keyword">var</span> result=<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">			<span class="attr">students</span>:students</span><br><span class="line">		&#125;)</span><br><span class="line">		fs.writeFile(dbPath,result,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(err)&#123;</span><br><span class="line">				<span class="comment">//错误就把错误对象传给它</span></span><br><span class="line">				<span class="keyword">return</span> callback(err)</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//没有错误就是成功,错误对象就是null</span></span><br><span class="line">			callback(<span class="literal">null</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>router.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/students/delete&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.获取要删除的id</span></span><br><span class="line">	<span class="built_in">console</span>.log(req.query.id)</span><br><span class="line">	<span class="comment">//2.根据id执行删除操作</span></span><br><span class="line">	Students.delete(req.query.id,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		res.redirect(<span class="string">&#x27;/students&#x27;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="comment">//3.根据操作结果发送相应数据</span></span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><h2 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h2><h2 id="ajax方法"><a href="#ajax方法" class="headerlink" title="ajax方法"></a>ajax方法</h2><p>先讲讲什么是ajax </p>
<p>Ajax不是一种新的编程语言,而是一种用于创建更好更快以及交互性更强的Web应用程序的技术</p>
<p>在2005年,Google通过其GoogleSuggest使Ajax变得流行起来</p>
<p>在谷歌搜索框输入关键字时,JavaScript会把这些字符发送到服务器,然后服务器会返回一个搜索建议的列表,就跟当前的百度一样</p>
<p>传统的网页(不使用ajax),想要更新内容或者提交一个表单,都需要重新加载整个网页</p>
<p>使用ajax技术的网页,通过在后台服务器进行少量的数据交换,就可实现异步局部更新</p>
<p>比如:</p>
<ul>
<li>​    注册时,输入用户名自动检测用户是否已存在</li>
<li>​    登录时,提示用户名密码错误</li>
<li>​    删除数据行时,将id发送到后台,后台在数据库中删除,删除成功后,在页面dom中将数据行也删除</li>
</ul>
<p>增加B/S体验性,未来的主流</p>
<p><code>get</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">			<span class="selector-id">#result</span>&#123;</span></span><br><span class="line"><span class="css">				<span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">				<span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="css">				<span class="attribute">border</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="css">			&#125;</span></span><br><span class="line"><span class="css">		</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span>&gt;</span>点击发送请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;result&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">const</span> btn=<span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;button&#x27;</span>)[<span class="number">0</span>]</span></span><br><span class="line"><span class="javascript">	btn.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//1.创建对象</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">const</span> xhr=<span class="keyword">new</span> XMLHttpRequest()</span></span><br><span class="line"><span class="javascript">		<span class="comment">//2.初始化</span></span></span><br><span class="line"><span class="javascript">		xhr.open(<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;http://127.0.0.1:3000/server?a=100&amp;b=22&#x27;</span>)</span></span><br><span class="line"><span class="javascript">		<span class="comment">//3.发送</span></span></span><br><span class="line"><span class="javascript">		xhr.send()</span></span><br><span class="line"><span class="javascript">		<span class="comment">//4.事件绑定</span></span></span><br><span class="line"><span class="javascript">		xhr.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">/*xhr.readyState是xhr对象中的属性,有四个值</span></span></span><br><span class="line"><span class="comment"><span class="javascript">			 * 0 还没开始</span></span></span><br><span class="line"><span class="comment"><span class="javascript">			 * 1 执行完xhr.open</span></span></span><br><span class="line"><span class="comment"><span class="javascript">			 * 2 send方法执行完毕</span></span></span><br><span class="line"><span class="comment"><span class="javascript">			 * 3 服务端返回部分数据</span></span></span><br><span class="line"><span class="comment"><span class="javascript">			 * 4 服务端返回所有数据</span></span></span><br><span class="line"><span class="comment"><span class="javascript">			 * </span></span></span><br><span class="line"><span class="comment"><span class="javascript">			 * </span></span></span><br><span class="line"><span class="comment"><span class="javascript">			 * 本事件将触发四次(每次改变触发一次)</span></span></span><br><span class="line"><span class="comment"><span class="javascript">			*/</span></span></span><br><span class="line"><span class="javascript">			<span class="comment">//判断(服务端返回了所有的结果)</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(xhr.readyState===<span class="number">4</span>)&#123;</span></span><br><span class="line"><span class="javascript">				<span class="comment">//判断响应状态码 200 404 304 401 500</span></span></span><br><span class="line"><span class="javascript">				<span class="comment">//响应状态码2开头的话,就是响应成功</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span>(xhr.status&gt;=<span class="number">200</span>&amp;&amp;xhr.status&lt;<span class="number">300</span>)&#123;</span></span><br><span class="line"><span class="javascript">					<span class="comment">//处理结果 行 头 空行 体</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">console</span>.log(xhr.status)<span class="comment">//状态码</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">console</span>.log(xhr.statusText)<span class="comment">//状态字符串</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">console</span>.log(xhr.getAllResponseHeaders())<span class="comment">//所有响应头</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">console</span>.log(xhr.response)<span class="comment">//响应体</span></span></span><br><span class="line"><span class="javascript">					<span class="built_in">document</span>.getElementById(<span class="string">&quot;result&quot;</span>).innerHTML=xhr.response</span></span><br><span class="line"><span class="javascript">				&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">					</span></span><br><span class="line"><span class="javascript">				&#125;</span></span><br><span class="line"><span class="javascript">			&#125;</span></span><br><span class="line"><span class="javascript">		&#125;</span></span><br><span class="line"><span class="javascript">	&#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>node做后台,<code>app.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入express</span></span><br><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//2创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app=express()</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.创建路由</span></span><br><span class="line"><span class="comment">//request是对请求报文的封装</span></span><br><span class="line"><span class="comment">//response是对响应报文的封装</span></span><br><span class="line">app.get(<span class="string">&#x27;/server&#x27;</span>,<span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//设置响应头,允许跨域</span></span><br><span class="line">	response.setHeader(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>,<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">	<span class="comment">//设置响应体</span></span><br><span class="line">	<span class="keyword">var</span> ranNum=<span class="built_in">JSON</span>.stringify(<span class="built_in">parseInt</span>( <span class="built_in">Math</span>.random()*(<span class="number">999999</span>-<span class="number">100000</span>)+<span class="number">100000</span>))</span><br><span class="line">	response.send(ranNum)</span><br><span class="line">&#125;)</span><br><span class="line">app.post(<span class="string">&#x27;/server&#x27;</span>,<span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//设置响应头,允许跨域</span></span><br><span class="line">	response.setHeader(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>,<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">	<span class="comment">//设置响应体</span></span><br><span class="line">	response.send(<span class="string">&#x27;Hello Ajax post&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;服务启动,端口3000...&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>post</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">			<span class="selector-id">#result</span>&#123;</span></span><br><span class="line"><span class="css">				<span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="css">				<span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="css">				<span class="attribute">border</span>: <span class="number">1px</span> solid black;</span></span><br><span class="line"><span class="css">			&#125;</span></span><br><span class="line"><span class="css">		</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;result&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">const</span> result=<span class="built_in">document</span>.getElementById(<span class="string">&quot;result&quot;</span>)</span></span><br><span class="line"><span class="javascript">	</span></span><br><span class="line"><span class="javascript">	result.addEventListener(<span class="string">&#x27;mouseover&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="built_in">console</span>.log(<span class="string">&#x27;test&#x27;</span>)</span></span><br><span class="line"><span class="javascript">		<span class="comment">//创建对象</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">const</span> xhr=<span class="keyword">new</span> XMLHttpRequest()</span></span><br><span class="line"><span class="javascript">		</span></span><br><span class="line"><span class="javascript">		<span class="comment">//初始化设置类型与url</span></span></span><br><span class="line"><span class="javascript">		xhr.open(<span class="string">&#x27;POST&#x27;</span>,<span class="string">&#x27;http://127.0.0.1:3000/server&#x27;</span>)</span></span><br><span class="line"><span class="javascript">		</span></span><br><span class="line"><span class="javascript">		<span class="comment">//发送</span></span></span><br><span class="line"><span class="javascript">		xhr.send(<span class="string">&#x27;a=100&amp;b=200&#x27;</span>)</span></span><br><span class="line"><span class="javascript">		</span></span><br><span class="line"><span class="javascript">		<span class="comment">//事件绑定</span></span></span><br><span class="line"><span class="javascript">		xhr.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//判断</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span> (xhr.readyState===<span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span>(xhr.status&gt;=<span class="number">200</span>&amp;&amp;xhr.status&lt;<span class="number">300</span>)&#123;</span></span><br><span class="line"><span class="javascript">					result.innerHTML=xhr.response</span></span><br><span class="line"><span class="javascript">				&#125;</span></span><br><span class="line"><span class="javascript">			&#125;</span></span><br><span class="line"><span class="javascript">		&#125;</span></span><br><span class="line"><span class="javascript">	&#125;)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="关于JavaScript模块化问题"><a href="#关于JavaScript模块化问题" class="headerlink" title="关于JavaScript模块化问题"></a>关于JavaScript模块化问题</h2><p>js天生不支持模块化(php天生支持模块化)</p>
<p>node中才有模块化,比如require,exports,,node环境中对js进行了特殊的模块化叫commonJs</p>
<p>在浏览器中也可以像在Node中一样模块化编程,可以用第三方库</p>
<ul>
<li>​    require.js  <code>require.js.org</code></li>
<li>​    sea.js</li>
</ul>
<p>script标签引入js,要考虑先后的问题</p>
<p>无论是commonjs,amd,cmd,umd,ecmascript 6 Modules官方规范都是为了解决js模块化问题</p>
<p>commanjs,amd,cmd等都是民间瞎搞</p>
<p>es6 modules官方对js模块化支持</p>
<h2 id="package-lock文件的作用"><a href="#package-lock文件的作用" class="headerlink" title="package-lock文件的作用"></a>package-lock文件的作用</h2><p>根据官方文档，这个package-lock.json 是在 <code>npm install</code>时候生成一份文件，用以记录当前状态下实际安装的各个npm package的具体来源和版本号。</p>
<p>它有什么用呢？因为npm是一个用于管理package之间依赖关系的管理器，它允许开发者在pacakge.json中间标出自己项目对npm各库包的依赖。你可以选择以如下方式来标明自己所需要库包的版本</p>
<p>这里举个例子：</p>
<p>“dependencies”: {<br> “@types/node”: “<strong>^</strong>8.0.33”,<br>},</p>
<p>这里面的 向上标号<strong>^</strong>是定义了<strong>向后（新）兼容依赖</strong>，指如果 types/node的版本是超过8.0.33，并在大版本号（8）上相同，就允许下载最新版本的 types/node库包，例如实际上可能运行npm install时候下载的具体版本是8.0.35。波浪号</p>
<p>大多数情况这种向新兼容依赖下载最新库包的时候都没有问题，可是因为npm是开源世界，各库包的版本语义可能并不相同，有的库包开发者并不遵守严格这一原则：相同大版本号的同一个库包，其接口符合兼容要求。这时候用户就很头疼了：在完全相同的一个nodejs的代码库，在不同时间或者不同npm下载源之下，下到的各依赖库包版本可能有所不同，因此其依赖库包行为特征也不同有时候甚至完全不兼容。</p>
<p>因此npm最新的版本就开始提供自动生成package-lock.json功能，为的是让开发者知道只要你保存了源文件，到一个新的机器上、或者新的下载源，只要按照这个package-lock.json所标示的具体版本下载依赖库包，就能确保所有库包与你上次安装的完全一样。</p>
<h2 id="MongoDB介绍和安装"><a href="#MongoDB介绍和安装" class="headerlink" title="MongoDB介绍和安装"></a>MongoDB介绍和安装</h2><h3 id="MongoDB介绍"><a href="#MongoDB介绍" class="headerlink" title="MongoDB介绍"></a>MongoDB介绍</h3><p>关系型数据库和非关系型数据库</p>
<p>表就是关系</p>
<p>或者说表之间存在关系</p>
<ul>
<li>所有的关系型数据库都需要通过<code>sql</code>语言来操作</li>
<li>所有的关系型数据库都需要在操作之前设计表结构</li>
<li>而且数据表还支持约束<ul>
<li>唯一的</li>
<li>主键</li>
<li>默认值</li>
<li>非空</li>
</ul>
</li>
<li>非关系型数据库非常灵活</li>
<li>有的非关系型数据库就是key-value键值对</li>
<li>但是MongoDB是长得最像关系型数据库的非关系型数据库<ul>
<li>数据库</li>
<li>数据表=&gt;集合(数组)</li>
<li>表记录=&gt;(文档对象)</li>
</ul>
</li>
<li>MongoDB不需要设计表结构</li>
<li>也就是说你可以任意的往里面存数据,没有结构性一说</li>
</ul>
<h2 id="MongoDB下载与安装"><a href="#MongoDB下载与安装" class="headerlink" title="MongoDB下载与安装"></a>MongoDB下载与安装</h2><p><a target="_blank" rel="noopener" href="https://www.mongodb.com/dr/fastdl.mongodb.org/windows/mongodb-windows-x86_64-4.4.1-signed.msi/download">https://www.mongodb.com/dr/fastdl.mongodb.org/windows/mongodb-windows-x86_64-4.4.1-signed.msi/download</a></p>
<p>填一下基本信息然后就可以下载了</p>
<p>下载好安装包后,选择complete标准安装,不要选择custom自定义安装</p>
<p>后面会跳出新窗口,继续<code>next</code>就行,注意把安装compass的选项去掉</p>
<p>此时我们在终端还是不能通过<code>mongod --version</code>命令来查看版本号,因为path路径没有配置,打开安装路径,我的是</p>
<p><a>C:\Program Files\MongoDB\Server\4.4\bin</a></p>
<p>右键此电脑,属性=&gt;高级系统设置=&gt;高级=&gt;环境变量=&gt;上面的用户变量path(不是下面的)=&gt;编辑,把上面的路径粘贴进去</p>
<p>注意最终是bin目录</p>
<p>然后重启命令行,<code>mongod --version</code>,显示下面这步,就说明成功了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db version v4.4.1</span><br><span class="line">Build Info: &#123;</span><br><span class="line">    &quot;version&quot;: &quot;4.4.1&quot;,</span><br><span class="line">    &quot;gitVersion&quot;: &quot;ad91a93a5a31e175f5cbf8c69561e788bbc55ce1&quot;,</span><br><span class="line">    &quot;modules&quot;: [],</span><br><span class="line">    &quot;allocator&quot;: &quot;tcmalloc&quot;,</span><br><span class="line">    &quot;environment&quot;: &#123;</span><br><span class="line">        &quot;distmod&quot;: &quot;windows&quot;,</span><br><span class="line">        &quot;distarch&quot;: &quot;x86_64&quot;,</span><br><span class="line">        &quot;target_arch&quot;: &quot;x86_64&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="开启-关闭MongoDB"><a href="#开启-关闭MongoDB" class="headerlink" title="开启 关闭MongoDB"></a>开启 关闭MongoDB</h2><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>mongodb默认使用执行mongod命令所处’<code>盘符</code>根目录下的/data/db作为数据存储目录,如果把这个目录给删了,则启动不了mongodb,所以需要我们在第一次执行该命令之前就先自己动手新建一个(原来有就不用了)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod</span><br></pre></td></tr></table></figure>

<p>在没有该目录的时候,执行<code>mongod</code>,出来的结果是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;t&quot;:&#123;&quot;$date&quot;:&quot;2020-10-18T12:05:30.669+08:00&quot;&#125;,&quot;s&quot;:&quot;I&quot;,  &quot;c&quot;:&quot;CONTROL&quot;,  &quot;id&quot;:23138,   &quot;ctx&quot;:&quot;initandlisten&quot;,&quot;msg&quot;:&quot;Shutting down&quot;,&quot;attr&quot;:&#123;&quot;exitCode&quot;:100&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到最后一行是<code>shutting down</code></p>
<p><a>C:\data\db</a></p>
<p>想要修改默认的数据存储目录路径</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath=数据存储目录路径</span><br></pre></td></tr></table></figure>

<h3 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h3><p>ctrl+c或者直接关闭命令行</p>
<h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><p>连接</p>
<p>默认连接本地</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure>

<p>退出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>

<h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><ul>
<li><code>show dbs</code>查看数据库列表<ul>
<li>默认admin和local不要去触碰</li>
</ul>
</li>
<li><code>use 数据库名称</code>用来切换到指定的数据(如果没有会新建,但是要添加一条数据进去)</li>
</ul>
<p>​    比如:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> show dbs</span></span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> use dongruan</span></span><br><span class="line">switched to db dongruan</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show dbs</span></span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db</span></span><br><span class="line">dongruan</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.students.insertOne(<span class="string">&#x27;&#123;name&#x27;</span>:<span class="string">&#x27;jack&#x27;</span>&#125;)</span></span><br><span class="line">uncaught exception: SyntaxError: missing ) after argument list :</span><br><span class="line">@(shell):1:29</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.students.insertOne(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Jack&quot;</span>&#125;)</span></span><br><span class="line">&#123;</span><br><span class="line">        &quot;acknowledged&quot; : true,</span><br><span class="line">        &quot;insertedId&quot; : ObjectId(&quot;5f8bf35416afc76f4429ff0c&quot;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show dbs</span></span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">dongruan  0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line"><span class="meta">&gt;</span></span><br></pre></td></tr></table></figure>

<p>第一次show dbs,查看所有表,此时里面只有系统默认的三个表</p>
<p>我们use dongruan切换到dongruan表,而由上一步我们知道,此时,并没有dongruan这个表,没有表就切换?</p>
<p>​        没有回默认给新建该表,</p>
<p>show dbs查看,此时还是没有该表,必须要插入一条数据后才可以真正拥有她</p>
<p>我们输入db,此时会跳出dongruan,表明我们现在在操作dongruan这张表</p>
<p>则给dongruan添加一条数据</p>
<p>db.students.insertOne({“name”:”Jack”})添加json的键值对</p>
<p>此时我们再次输入show dbs,出来的表格中就有dongruan啦</p>
<ul>
<li><code>show collection</code>查看集合</li>
<li><code>.find()</code>查找具体</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db</span></span><br><span class="line">itcast</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> show collections</span></span><br><span class="line">students</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.students.find()</span></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8bf35416afc76f4429ff0c&quot;), &quot;name&quot; : &quot;Jack&quot; &#125;</span><br><span class="line"><span class="meta">&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里默认自带主键,id不是12345,而是上面的格式,也是唯一不重复的</p>
<h2 id="通过node-js连接MongoDB"><a href="#通过node-js连接MongoDB" class="headerlink" title="通过node.js连接MongoDB"></a>通过node.js连接MongoDB</h2><h3 id="使用官方的mongodb包"><a href="#使用官方的mongodb包" class="headerlink" title="使用官方的mongodb包"></a>使用官方的<code>mongodb</code>包</h3><p><a target="_blank" rel="noopener" href="https://github.com/mongodb/node-mongodb-native">https://github.com/mongodb/node-mongodb-native</a></p>
<p>有教程,我们不用这个方法</p>
<h3 id="使用mongoose第三方"><a href="#使用mongoose第三方" class="headerlink" title="使用mongoose第三方"></a>使用mongoose第三方</h3><p><a target="_blank" rel="noopener" href="https://mongoosejs.com/">https://mongoosejs.com/</a></p>
<p>新建项目</p>
<p><code>mkdir moo</code></p>
<p><code>npm init -y</code></p>
<p><code>npm install mongoose</code></p>
<p>新建demo1.js,把从上面网址里的代码粘贴进去</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接mongoDB数据库</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/test&#x27;</span>, &#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设计一个模型</span></span><br><span class="line"><span class="comment">//其实就是在设计一个数据库</span></span><br><span class="line"><span class="comment">// MongoDB是动态的,非常灵活,只需要在代码中设计你的数据库即可</span></span><br><span class="line"><span class="comment">// mongoose这个包可以让我们的设计编写过程变的非常简单</span></span><br><span class="line"><span class="keyword">const</span> Cat = mongoose.model(<span class="string">&#x27;Cat&#x27;</span>, &#123; <span class="attr">name</span>: <span class="built_in">String</span> &#125;);</span><br><span class="line"><span class="comment">//注意:虽然我们在这里用的是&quot;Cat&quot;,但是实际上会以&quot;cats&quot;命名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//实例化一个Cat</span></span><br><span class="line"><span class="keyword">const</span> kitty = <span class="keyword">new</span> Cat(&#123; <span class="attr">name</span>: <span class="string">&#x27;Zildjian&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 持久化保存kitty实例</span></span><br><span class="line">kitty.save().then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;meow&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>此时我们打开命令行</p>
<p><code>show dbs</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> show dbs</span></span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br></pre></td></tr></table></figure>

<p>跟以前一样</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Ｕｒｎａ\Desktop\111&gt;node demo1</span><br><span class="line">meow</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>demo1.js有往test里添加数据,所以test就存在了</p>
<p>此时我们再次show dbs</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> show dbs</span></span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br><span class="line">test    0.000GB</span><br></pre></td></tr></table></figure>

<p>查看一下集合</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> show collections</span></span><br><span class="line">cats</span><br><span class="line"><span class="meta">&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们写入的是’Cat’,但是在这里会变成小写,复数形式</p>
<p>再查看一下具体数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.cats.find()</span></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c040891c38008b454eebe&quot;), &quot;name&quot; : &quot;Zildjian&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br><span class="line"><span class="bash"></span></span><br></pre></td></tr></table></figure>

<p>通过for循环写入多条数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接mongoDB数据库</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/test&#x27;</span>, &#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设计一个模型</span></span><br><span class="line"><span class="comment">//其实就是在设计一个数据库</span></span><br><span class="line"><span class="comment">// MongoDB是动态的,非常灵活,只需要在代码中设计你的数据库即可</span></span><br><span class="line"><span class="comment">// mongoose这个包可以让我们的设计编写过程变的非常简单</span></span><br><span class="line"><span class="keyword">const</span> Cat = mongoose.model(<span class="string">&#x27;Cat&#x27;</span>, &#123; <span class="attr">name</span>: <span class="built_in">String</span> &#125;);</span><br><span class="line"><span class="comment">//注意:虽然我们在这里用的是&quot;Cat&quot;,但是实际上会以&quot;cats&quot;命名</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">	<span class="comment">//实例化一个Cat</span></span><br><span class="line">	<span class="keyword">const</span> kitty = <span class="keyword">new</span> Cat(&#123; <span class="attr">name</span>: <span class="string">&#x27;喵喵&#x27;</span> +i&#125;);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 持久化保存kitty实例</span></span><br><span class="line">	kitty.save().then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;meow&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>node demo1会得到100声猫叫</p>
<p>再查看数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.cats.find()</span></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c040891c38008b454eebe&quot;), &quot;name&quot; : &quot;Zildjian&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a33d&quot;), &quot;name&quot; : &quot;喵喵0&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a33e&quot;), &quot;name&quot; : &quot;喵喵1&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a33f&quot;), &quot;name&quot; : &quot;喵喵2&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a340&quot;), &quot;name&quot; : &quot;喵喵3&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a341&quot;), &quot;name&quot; : &quot;喵喵4&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a342&quot;), &quot;name&quot; : &quot;喵喵5&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a343&quot;), &quot;name&quot; : &quot;喵喵6&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a344&quot;), &quot;name&quot; : &quot;喵喵7&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a345&quot;), &quot;name&quot; : &quot;喵喵8&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a346&quot;), &quot;name&quot; : &quot;喵喵9&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a347&quot;), &quot;name&quot; : &quot;喵喵10&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a348&quot;), &quot;name&quot; : &quot;喵喵11&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a349&quot;), &quot;name&quot; : &quot;喵喵12&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a34a&quot;), &quot;name&quot; : &quot;喵喵13&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a34b&quot;), &quot;name&quot; : &quot;喵喵14&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a34c&quot;), &quot;name&quot; : &quot;喵喵15&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a34d&quot;), &quot;name&quot; : &quot;喵喵16&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a34e&quot;), &quot;name&quot; : &quot;喵喵17&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f8c0f8b1af18b27b4b7a34f&quot;), &quot;name&quot; : &quot;喵喵18&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">Type &quot;it&quot; for more</span><br></pre></td></tr></table></figure>

<p>只显示了19条,想要继续查看后面的要输入<code>it</code></p>
<h2 id="重新说明MongoDB数据库概念"><a href="#重新说明MongoDB数据库概念" class="headerlink" title="重新说明MongoDB数据库概念"></a>重新说明MongoDB数据库概念</h2><ul>
<li>数据库</li>
<li>集合(数组)</li>
<li>文档(对象)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">qq</span>:&#123;</span><br><span class="line">        <span class="attr">users</span>:[</span><br><span class="line">            &#123;<span class="attr">name</span>:<span class="string">&#x27;张三&#x27;</span>,<span class="attr">age</span>:<span class="number">15</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">name</span>:<span class="string">&#x27;李四&#x27;</span>,<span class="attr">age</span>:<span class="number">16</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">name</span>:<span class="string">&#x27;王五&#x27;</span>,<span class="attr">age</span>:<span class="number">17</span>&#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">produrt</span>:[</span><br><span class="line">        </span><br><span class="line">        ]</span><br><span class="line">      </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">taobao</span>:&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">baidu</span>:&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>一个MongoDB可以有多个数据库</li>
<li>一个数据库里可以有多个集合(就是mysql中的表),实际上是个数组</li>
<li>一个集合里可以有多个文档(表记录)</li>
<li>文档结构很灵活,没有任何限制,不需要像MySQL一样先创建数据库,表,设计表结构,<ul>
<li>在这里只需要:当你需要插入数据的时候,只需要指定往哪个数据库的哪个集合操作即可</li>
<li>一切都由MongoDB来帮你自动完成建库建表的事</li>
</ul>
</li>
</ul>
<h2 id="mongoose开始"><a href="#mongoose开始" class="headerlink" title="mongoose开始"></a>mongoose开始</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> Schema=mongoose.Schema</span><br><span class="line"><span class="comment">//const &#123; Schema &#125; = mongoose;</span></span><br><span class="line"><span class="comment">//1连接mongoDB数据库</span></span><br><span class="line"><span class="comment">//该数据库不需要存在,插入数据后会自动创建</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/dongruan&#x27;</span>, &#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2设计集合结构(表结构)(Defining your schema)</span></span><br><span class="line"><span class="comment">// 字段名称就是表结构中的属性名称</span></span><br><span class="line"><span class="comment">// 约束的目的是为了保证数据的完整性,不要有脏数据</span></span><br><span class="line"><span class="comment">/* const blogSchema = new Schema(&#123;</span></span><br><span class="line"><span class="comment">    title:  String, // String is shorthand for &#123;type: String&#125;</span></span><br><span class="line"><span class="comment">    author: String,</span></span><br><span class="line"><span class="comment">    body:   String,</span></span><br><span class="line"><span class="comment">    comments: [&#123; body: String, date: Date &#125;],</span></span><br><span class="line"><span class="comment">    date: &#123; type: Date, default: Date.now &#125;,</span></span><br><span class="line"><span class="comment">    hidden: Boolean,</span></span><br><span class="line"><span class="comment">    meta: &#123;</span></span><br><span class="line"><span class="comment">      votes: Number,</span></span><br><span class="line"><span class="comment">      favs:  Number</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  &#125;);*/</span></span><br><span class="line">  <span class="keyword">const</span> userSchema=<span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  	<span class="attr">username</span>:&#123;</span><br><span class="line">  		<span class="attr">type</span>:<span class="built_in">String</span>,</span><br><span class="line">  		<span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  	&#125;,</span><br><span class="line">  	<span class="attr">password</span>:&#123;</span><br><span class="line">  		<span class="attr">type</span>:<span class="built_in">String</span>,</span><br><span class="line">  		<span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  	&#125;,<span class="attr">email</span>:&#123;</span><br><span class="line">  		<span class="attr">type</span>:<span class="built_in">String</span></span><br><span class="line">  	&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 3.将文档架构发布为模型(Creating a model)</span></span><br><span class="line">  <span class="comment">//mongoose.model是用来将将一个架构发布为model</span></span><br><span class="line">  <span class="comment">// 第一个参数:传入一个大写名词单数字符串来表示你的集合名称</span></span><br><span class="line">  <span class="comment">// 			mongoose会自动将大写名词的字符串生成小写复数的集合名词</span></span><br><span class="line">  <span class="comment">// 			这里的&#x27;User&#x27;会变成users</span></span><br><span class="line">  <span class="comment">// 第二个参数:架构Schema返回值</span></span><br><span class="line">  <span class="comment">//				模型构造函数</span></span><br><span class="line"><span class="keyword">const</span> User=mongoose.model(<span class="string">&#x27;User&#x27;</span>,userSchema)</span><br><span class="line"><span class="comment">// 4.当我们有了模型构造函数之后,就可以使用这个构造函数对users集合中的数据为所欲为(增删改查)了</span></span><br></pre></td></tr></table></figure>



<h2 id="新增数据"><a href="#新增数据" class="headerlink" title="新增数据"></a>新增数据</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.当我们有了模型构造函数之后,就可以使用这个构造函数对users集合中的数据为所欲为(增删改查)了</span></span><br><span class="line"><span class="keyword">var</span> admin=<span class="keyword">new</span> User(&#123;</span><br><span class="line">	<span class="attr">username</span>:<span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">	<span class="attr">password</span>:<span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">	<span class="attr">email</span>:<span class="string">&#x27;296@qq.com&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">admin.save(<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(err)&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&quot;存储失败&quot;</span>)</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">&quot;存储成功&quot;</span>)</span><br><span class="line">		<span class="built_in">console</span>.log(result)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node demo2</span><br></pre></td></tr></table></figure>



<h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*******************************查询数据*****************************************/</span></span><br><span class="line"><span class="comment">//查询所有</span></span><br><span class="line"><span class="comment">/*User.find(function (err,result) &#123;</span></span><br><span class="line"><span class="comment">	if(err)&#123;</span></span><br><span class="line"><span class="comment">		console.log(err)</span></span><br><span class="line"><span class="comment">	&#125;else&#123;</span></span><br><span class="line"><span class="comment">		console.log(result)</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">&#125;)*/</span></span><br><span class="line"><span class="comment">//按条件查询</span></span><br><span class="line"><span class="comment">/*User.find(&#123;username:&#x27;张三&#x27;&#125;,function (err,result) &#123;</span></span><br><span class="line"><span class="comment">	if(err)&#123;</span></span><br><span class="line"><span class="comment">		console.log(err)</span></span><br><span class="line"><span class="comment">	&#125;else&#123;</span></span><br><span class="line"><span class="comment">		console.log(result)</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">&#125;)*/</span></span><br><span class="line"><span class="comment">//上面这些查询方式都是得到一个数组</span></span><br><span class="line"><span class="comment">// 如果想得到一个对象</span></span><br><span class="line"><span class="comment">/*User.findOne(&#123;username:&#x27;张三&#x27;&#125;,function (err,result) &#123;</span></span><br><span class="line"><span class="comment">	if(err)&#123;</span></span><br><span class="line"><span class="comment">		console.log(err)</span></span><br><span class="line"><span class="comment">	&#125;else&#123;</span></span><br><span class="line"><span class="comment">		console.log(result)</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">&#125;)*/</span></span><br><span class="line"><span class="comment">// 多个查询条件呢?</span></span><br></pre></td></tr></table></figure>



<h2 id="删除数据和更新数据"><a href="#删除数据和更新数据" class="headerlink" title="删除数据和更新数据"></a>删除数据和更新数据</h2><h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*****************************删除数据*******************************/</span></span><br><span class="line">User.remove(&#123;</span><br><span class="line">	<span class="attr">username</span>:<span class="string">&#x27;张三&#x27;</span></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) &#123;<span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>)&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">			<span class="built_in">console</span>.log(result)</span><br><span class="line">		&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有几个张三,删几个张三</span></span><br><span class="line"><span class="comment">//通过id删除</span></span><br><span class="line">User.remove(&#123;</span><br><span class="line">	<span class="attr">_id</span>:<span class="string">&#x27;5f8d107a6c88ed03503d6e0a&#x27;</span></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) &#123;<span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>)&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">			<span class="built_in">console</span>.log(result)</span><br><span class="line">		&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*************更新数据***********************/</span></span><br><span class="line"><span class="comment">//通过id</span></span><br><span class="line"><span class="comment">/*User.findByIdAndUpdate(&quot;5f8d10ed133b84135007cd61&quot;,&#123;password:&#x27;123&#x27;&#125;,function (err,result) &#123;</span></span><br><span class="line"><span class="comment">	if (err) &#123;console.log(&#x27;err&#x27;)&#125;</span></span><br><span class="line"><span class="comment">		else&#123;</span></span><br><span class="line"><span class="comment">			console.log(&#x27;success&#x27;)</span></span><br><span class="line"><span class="comment">			console.log(result)</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">&#125;)*/</span></span><br><span class="line"><span class="comment">//通过其他属性</span></span><br><span class="line"><span class="comment">/*User.updateOne(&#123;username:&#x27;admin&#x27;&#125;,&#123;password:&#x27;123456&#x27;&#125;,function (err,result) &#123;</span></span><br><span class="line"><span class="comment">	if (err) &#123;console.log(&#x27;err&#x27;)&#125;</span></span><br><span class="line"><span class="comment">		else&#123;</span></span><br><span class="line"><span class="comment">			console.log(&#x27;success&#x27;)</span></span><br><span class="line"><span class="comment">			console.log(result)</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">&#125;)*/</span></span><br><span class="line"><span class="comment">//无返回值</span></span><br><span class="line"><span class="comment">//或者使用</span></span><br><span class="line">User.findOneAndUpdate(&#123;<span class="attr">username</span>:<span class="string">&#x27;admin&#x27;</span>&#125;,&#123;<span class="attr">password</span>:<span class="string">&#x27;123&#x27;</span>&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) &#123;<span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>)&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">			<span class="built_in">console</span>.log(result)</span><br><span class="line">		&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//有返回值</span></span><br><span class="line"><span class="comment">// result返回的是未修改之前的数据</span></span><br></pre></td></tr></table></figure>



<h2 id="把CRUD案例改为MongoDB数据库版本"><a href="#把CRUD案例改为MongoDB数据库版本" class="headerlink" title="把CRUD案例改为MongoDB数据库版本"></a>把CRUD案例改为MongoDB数据库版本</h2><p>把之前的crud项目复制一份,为其安装mongoose</p>
<p><code>npm i mongoose --save</code></p>
<p>新建studentsmongo.js代替之前的student.js,我们现在不需要之前的student.js去读写文件了</p>
<p><code>studentsmongo.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">&#x27;mongoose&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://localhost/dongruan&#x27;</span>, &#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Schema &#125; = mongoose;</span><br><span class="line"><span class="comment">//const Schema=mongoose.Schema</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> studentScchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">	<span class="attr">name</span>:&#123;</span><br><span class="line">		<span class="attr">type</span>:<span class="built_in">String</span>,</span><br><span class="line">		<span class="attr">required</span>:<span class="literal">true</span><span class="comment">//指定是否必须</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">gender</span>:&#123;</span><br><span class="line">		<span class="attr">type</span>:<span class="built_in">Number</span>,</span><br><span class="line">		<span class="attr">enum</span>:[<span class="number">0</span>,<span class="number">1</span>],<span class="comment">//枚举,指定必须这其中的数字</span></span><br><span class="line">		<span class="attr">default</span>:<span class="number">0</span><span class="comment">//默认为0</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">age</span>:&#123;</span><br><span class="line">		<span class="attr">type</span>:<span class="built_in">Number</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">hobbies</span>:&#123;</span><br><span class="line">		<span class="attr">type</span>:<span class="built_in">String</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=mongoose.model(<span class="string">&#x27;Student&#x27;</span>,studentSchema)</span><br></pre></td></tr></table></figure>

<p>回到router.js</p>
<h3 id="首页渲染"><a href="#首页渲染" class="headerlink" title="首页渲染"></a>首页渲染</h3><p>引入新编辑的studentsmongo.js文件,把原来对’./students.js’引入删除</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> Students=<span class="built_in">require</span>(<span class="string">&#x27;./studentsmongo&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// var Students=require(&#x27;./students&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>执行node app</p>
<p>打开<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/students%E5%8D%B3%E5%8F%AF%E7%9C%8B%E5%88%B0%E6%96%B0%E7%9A%84%E4%BF%A1%E6%81%AF">http://127.0.0.1:3000/students即可看到新的信息</a></p>
<p>但是此时数据都不对,我们需要进行修改,比如id,我们不能用数据库自带的,应该使用其index+1</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$index+1&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.gender&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.age&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.hobbies&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/students/edit?id=&#123;&#123;$value.id&#125;&#125;&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/students/delete?id=&#123;&#123;$value.id&#125;&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>首页渲染工作我们就完成了</p>
<h3 id="添加学生"><a href="#添加学生" class="headerlink" title="添加学生"></a>添加学生</h3><p>接下来我们点击添加学生进入new.html</p>
<p>输入了信息后点击submit时候,报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/students/new&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.获取表单数据</span></span><br><span class="line">	<span class="comment">// 2.处理</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3.发送响应</span></span><br><span class="line">	<span class="comment">// console.log(req.body)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*Students.save(req.body,function (err) &#123;</span></span><br><span class="line"><span class="comment">		if(err)&#123;</span></span><br><span class="line"><span class="comment">			return res.status(500).send(&#x27;Server error&#x27;)</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">		res.redirect(&#x27;/students&#x27;)</span></span><br><span class="line"><span class="comment">		//跳转回students页面,重新读(更新后的)文件</span></span><br><span class="line"><span class="comment">	&#125;)*/</span></span><br><span class="line">	<span class="keyword">new</span> Students(req.body).save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		res.redirect(<span class="string">&#x27;/students&#x27;</span>)</span><br><span class="line">		<span class="comment">//跳转回students页面,重新读(更新后的)文件</span></span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>储存的时候应该调用save方法,详情查看新增数据章节</p>
<h3 id="更新学生信息"><a href="#更新学生信息" class="headerlink" title="更新学生信息"></a>更新学生信息</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/students/edit&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.在客户端的列表页中处理链接问题(需要有id参数)</span></span><br><span class="line">	<span class="comment">//2.获取要编辑的学生id</span></span><br><span class="line">	<span class="comment">//3.渲染编辑页面</span></span><br><span class="line">	<span class="built_in">console</span>.log(req.query.id)</span><br><span class="line">    <span class="comment">//Students.findById(parseInt(req.query.id),function (err,student ) &#123;</span></span><br><span class="line">	Students.findById(req.query.id,<span class="function"><span class="keyword">function</span> (<span class="params">err,student </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">console</span>.log(student)</span><br><span class="line">		res.render(<span class="string">&#x27;edit.html&#x27;</span>,&#123;</span><br><span class="line">			<span class="attr">student</span>:student</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这里有一点需要注意,老版本的mongoose在这里处理id 的时候,可能会得到字符串带引号,到时候可以用正则处理以下字符串把引号去掉</p>
<p>再edit页面,我们重新修改了数据,然后点击提交</p>
<p>原来的代码是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/students/edit&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.处理表单数据</span></span><br><span class="line">	<span class="comment">// 		req.body</span></span><br><span class="line">	<span class="comment">// 2.更新</span></span><br><span class="line">			<span class="comment">// Students.update()</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//发送响应</span></span><br><span class="line">	<span class="comment">// console.log(req.body)</span></span><br><span class="line">	Students.update(req.body,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		res.redirect(<span class="string">&#x27;/students&#x27;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>用上面的代码也能实现我们想要的功能,</p>
<p>mongoose是有update方法的,但是这个方法是给老方法,新的修改方式应该是这样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/students/edit&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//1.处理表单数据</span></span><br><span class="line">	<span class="comment">// 		req.body</span></span><br><span class="line">	<span class="comment">// 2.更新</span></span><br><span class="line">			<span class="comment">// Students.update()</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//发送响应</span></span><br><span class="line">	<span class="comment">// console.log(req.body)</span></span><br><span class="line">	Students.findByIdAndUpdate(req.body.id,req.body,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">&#x27;Server error&#x27;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		res.redirect(<span class="string">&#x27;/students&#x27;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>因为<code>update</code>本身的意义不够清楚，所以3.0以后才出现了<code>updateMany</code>和<code>updateOne</code>两个替代方法。</p>
<p>创建之前crud项目的副本</p>
<p>安装mongoose</p>
<p>新建studentsMongo.js代替之前的students.js</p>
<p>然后在router.js中引入studentsMongo.js,去掉student.js</p>
<p>index.html修改id为index+1</p>
<p>post(students/new)路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Students.save(req.body,function (err) &#123;</span></span><br><span class="line"><span class="keyword">new</span> Students(req.body).save(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br></pre></td></tr></table></figure>

<p>get(students/edit)</p>
<p>去掉了parseInt</p>
<p>get(students/delete)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Students.findByIdAndDelete(req.query.id,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br></pre></td></tr></table></figure>



<h2 id="使用Node操作MySQL数据库"><a href="#使用Node操作MySQL数据库" class="headerlink" title="使用Node操作MySQL数据库"></a>使用Node操作MySQL数据库</h2><h2 id="回调地狱"><a href="#回调地狱" class="headerlink" title="回调地狱"></a>回调地狱</h2><p>callback hell</p>
<p>我们在一个项目中用到多个回调函数时候,比如:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&#x27;./a.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(err)&#123;</span><br><span class="line">		<span class="comment">// return console.log(err)</span></span><br><span class="line">		<span class="keyword">throw</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line">fs.readFile(<span class="string">&#x27;./b.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(err)&#123;</span><br><span class="line">		<span class="keyword">throw</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line">fs.readFile(<span class="string">&#x27;./c.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(err)&#123;</span><br><span class="line">		<span class="keyword">throw</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们分别读a.txt,b.txt,c.txt三个文件,我们没法控制其顺序,不一定谁先加载,谁先执行</p>
<p>通过回调嵌套的方式来保证顺序</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fs.readFile(<span class="string">&#x27;./a.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(err)&#123;</span><br><span class="line">		<span class="comment">// return console.log(err)</span></span><br><span class="line">		<span class="keyword">throw</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">	fs.readFile(<span class="string">&#x27;./b.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(err)&#123;</span><br><span class="line">			<span class="keyword">throw</span> err</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">console</span>.log(data)</span><br><span class="line">		fs.readFile(<span class="string">&#x27;./c.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(err)&#123;</span><br><span class="line">				<span class="keyword">throw</span> err</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">console</span>.log(data)</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>如果更多呢?</p>
<p><img src="D:\东软广州\nodeNote\hadouken-code.jpg"></p>
<p>恶心!!!</p>
<h2 id="Promise语法API"><a href="#Promise语法API" class="headerlink" title="Promise语法API"></a>Promise语法API</h2><p>为了解决以上编码方式带来的问题(回调地狱嵌套),所以在EcmaScript6中新增了一个api:<code>promise</code></p>
<p><img src="F:/桌面文件/node/promise.png"></p>
<ul>
<li><p>resolved决定;rejected:拒绝;pending:悬而未决的</p>
</li>
<li><p>promise承诺,是es6的一个api,不是node所特有的,是一个构造函数</p>
</li>
<li><p>Promise容器一旦开始创建,就开始执行里面的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// promise是es6中新增的一个api</span></span><br><span class="line"><span class="comment">// promise是一个构造函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">	<span class="comment">//创建Promise容器</span></span><br><span class="line">	<span class="comment">// 1.给别人一个承诺</span></span><br><span class="line">		<span class="comment">// Promise容器一旦开始创建,就开始执行里面的代码</span></span><br><span class="line">	<span class="comment">//2.是一个异步任务</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">        fs.readFile(<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="comment">//Promise承诺容器中的任务失败了</span></span><br><span class="line">                <span class="built_in">console</span>.log(err)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// Promise承诺容器中的任务成功了</span></span><br><span class="line">                <span class="built_in">console</span>.log(data)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">4</span>) </span><br></pre></td></tr></table></figure>

<p>结果是1243,承诺本身不是异步,而内部的任务是异步</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise1=<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">	fs.readFile(<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="comment">//Promise承诺容器中的任务失败了</span></span><br><span class="line">			reject(err)</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">// Promise承诺容器中的任务成功了</span></span><br><span class="line">			resolve(data)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">promise1.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//resolve()</span></span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//reject()</span></span><br><span class="line">	<span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>then方法里的第一个参数是resolve,第二个是reject</p>
<p>接下来,我们复制多个promise,修改一下被读文件的路径</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise1=<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">	fs.readFile(<span class="string">&#x27;a.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="comment">//Promise承诺容器中的任务失败了</span></span><br><span class="line">			reject(err)</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">// Promise承诺容器中的任务成功了</span></span><br><span class="line">			resolve(data)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> promise2=<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">	fs.readFile(<span class="string">&#x27;b.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="comment">//Promise承诺容器中的任务失败了</span></span><br><span class="line">			reject(err)</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">// Promise承诺容器中的任务成功了</span></span><br><span class="line">			resolve(data)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> promise3=<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">	fs.readFile(<span class="string">&#x27;c.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="comment">//Promise承诺容器中的任务失败了</span></span><br><span class="line">			reject(err)</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">// Promise承诺容器中的任务成功了</span></span><br><span class="line">			resolve(data)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise1.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//resolve()</span></span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">    <span class="comment">//return 123</span></span><br><span class="line">	<span class="keyword">return</span> promise2<span class="comment">//这里return的值,就是后面then函数的参数</span></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//reject()</span></span><br><span class="line">	<span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">	<span class="keyword">return</span> promise3</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这样加载顺序就一定是按照我们预先设置好的来</p>
<p>这种叫链式编程</p>
<h2 id="封装Promise版本的readFile"><a href="#封装Promise版本的readFile" class="headerlink" title="封装Promise版本的readFile"></a>封装Promise版本的readFile</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pReadFile</span>(<span class="params">filePath</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</span><br><span class="line">		fs.readFile(filePath,<span class="string">&#x27;utf8&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (err) &#123;</span><br><span class="line">				<span class="comment">//Promise承诺容器中的任务失败了</span></span><br><span class="line">				reject(err)</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">// Promise承诺容器中的任务成功了</span></span><br><span class="line">				resolve(data)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pReadFile(<span class="string">&#x27;./a.txt&#x27;</span>)</span><br><span class="line">	.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(data)</span><br><span class="line">		<span class="keyword">return</span> pReadFile(<span class="string">&#x27;./b.txt&#x27;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(data)</span><br><span class="line">		<span class="keyword">return</span> pReadFile(<span class="string">&#x27;./c.txt&#x27;</span>)</span><br><span class="line">	&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(data)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>所有异步都可以这样封装</p>
<h2 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h2><h3 id="了解"><a href="#了解" class="headerlink" title="了解"></a>了解</h3><p>​    node应用由模块组成，采用的commonjs模块规范。每一个文件就是一个模块，拥有自己独立的作用域，变量，以及方法等，对其他的模块都不可见。CommonJS规范规定，每个模块内部，module变量代表当前模块。这个变量是一个对象，它的exports属性（即module.exports）是对外的接口。加载某个模块，其实是加载该模块的module.exports属性。require方法用于加载模块。</p>
<h3 id="CommonJS模块的特点如下。"><a href="#CommonJS模块的特点如下。" class="headerlink" title="CommonJS模块的特点如下。"></a>CommonJS模块的特点如下。</h3><p>所有代码都运行在模块作用域，不会污染全局作用域。</p>
<p>模块可以多次加载，但是只会在第一次加载时运行一次，然后运行结果就被缓存了，以后再加载，就直接读取缓存结果。要想让模块再次运行，必须清除缓存。</p>
<p>模块加载的顺序，按照其在代码中出现的顺序。</p>
<h3 id="2-module对象"><a href="#2-module对象" class="headerlink" title="2.module对象"></a>2.module对象</h3><p>​    1.module.exports属性 </p>
<p>module.exports属性表示当前模块对外输出的接口，其他文件加载该模块，实际上就是读取module.exports变量。</p>
<p>​    2.exports变量</p>
<p>node为每一个模块提供了一个exports变量(可以说是一个对象)，指向 module.exports。这相当于每个模块中都有一句这样的命令 var exports = module.exports;</p>
<p>这样，在对外输出时，可以在这个变量上添加方法。例如 exports.add = function (r){return Math.PI * r *r};注意：不能把exports直接指向一个值，这样就相当于切断了 exports 和module.exports 的关系。例如 exports=function(x){console.log(x)};</p>
<p>一个模块的对外接口，就是一个单一的值，不能使用exports输出，必须使用 module.exports输出。module.exports=function(x){console.log(x);}; </p>
<p><strong>这两个不好区分，那就放弃 exports，只用 module.exports 就好（手动机智）</strong></p>
<h3 id="require命令"><a href="#require命令" class="headerlink" title="require命令"></a>require命令</h3><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><p>require命令用于加载模块文件，相当于读入并执行一个js文件，然后返回该模块的module.exports对象，没有发现指定模块，则就会报错。</p>
<p>例如 example.js  exports.name = ‘tom’;exports.age = 50;</p>
<p>在 同目录下的 demo.js 文件中 var example = require(‘./example.js’);</p>
<p>console.log(example.name); // tom</p>
<p>console.log(example.age); // 50</p>
<p>或者 example.js function fn(){console.log(1)};</p>
<p>var name = ‘tom’</p>
<p>module.exports = {fn:fn,name:name} 这里可以简写一下，es6的对象简写，key 和 value 一致，可以只写一个。  module.exports = {fn,name}；</p>
<p>在 同目录下的 demo.js 文件中 var example = require(‘./example.js’);</p>
<p>example.fn(); // 1</p>
<p>console.log(example.name); // tom</p>
<h4 id="加载规则。"><a href="#加载规则。" class="headerlink" title="加载规则。"></a>加载规则。</h4><p>根据参数的不同格式，require命令去不同路径寻找模块文件。</p>
<p>（1）如果参数字符串以“/”开头，则表示加载的是一个位于绝对路径的模块文件。比如，require(‘/home/marco/foo.js’)将加载/home/marco/foo.js。(不采用)</p>
<p>（2）如果参数字符串以“./”开头，则表示加载的是一个位于相对路径（跟当前执行脚本的位置相比）的模块文件。比如，require(‘./circle’)将加载当前脚本同一目录的circle.js。</p>
<p>（3）如果参数字符串不以“./“或”/“开头，则表示加载的是一个默认提供的核心模块（位于Node的系统安装目录中），或者一个位于各级node_modules目录的已安装模块（全局安装或局部安装）。</p>
<p>举例来说，脚本/home/user/projects/foo.js执行了require(‘bar.js’)命令，Node会依次搜索以下文件。</p>
<p>/usr/local/lib/node/bar.js</p>
<p>/home/user/projects/node_modules/bar.js</p>
<p>/home/user/node_modules/bar.js</p>
<p>/home/node_modules/bar.js</p>
<p>/node_modules/bar.js</p>
<p>这样设计的目的是，使得不同的模块可以将所依赖的模块本地化。</p>
<p>（4）如果参数字符串不以“./“或”/“开头，而且是一个路径，比如require(‘example-module/path/to/file’)，则将先找到example-module的位置，然后再以它为参数，找到后续路径。</p>
<p>（5）如果指定的模块文件没有发现，Node会尝试为文件名添加.js、.json、.node后，再去搜索。.js件会以文本格式的JavaScript脚本文件解析，.json文件会以JSON格式的文本文件解析，.node文件会以编译后的二进制文件解析。</p>
<p>（6）如果想得到require命令加载的确切文件名，使用require.resolve()方法。</p>
<h4 id="模块的缓存"><a href="#模块的缓存" class="headerlink" title="模块的缓存"></a>模块的缓存</h4><p>第一次加载该模块，node会缓存该模块。再次加载，直接从缓存中取出该模块的module.exports属性。</p>
<p>require(‘./example.js’);</p>
<p>require(‘./example.js’).message=”hello”;</p>
<p>require(‘./example.js’).message    // “hello”</p>
<p>删除模块的缓存 缓存保存在require.cache中，可操作该属性进行删除</p>
<p>// 删除指定模块的缓存 </p>
<p>delete require.cache[moduleName];</p>
<p>// 删除所有模块的缓存Object.keys(require.cache).forEach(function(key){deleterequire.cache[key];})</p>
<h3 id="模块的加载机制"><a href="#模块的加载机制" class="headerlink" title="模块的加载机制"></a>模块的加载机制</h3><p>​    commonsJS的加载机制，输入的是被输出值的拷贝。也就是说，一旦输出一个值，模块内部的变化就影响不到这个值了。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/13610935-1d33c08b39a5c501.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/814/format/webp" alt="img"></p>

            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2021年10月16日 10:37</p>
        <p>原始链接： <a class="post-url" href="/2021/05/16/Nodejs/" title="Nodejs">http://example.com/2021/05/16/Nodejs/</a></p>
        <footer>
            <a href="http://example.com">
                <img src="/images/logo.png" alt="ZhangLichao">
                ZhangLichao
            </a>
        </footer>
    </div>
</div>

      
        
            
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;">赏</a>
</div>

<div id="reward" class="post-modal reward-lay">
    <a class="close" href="javascript:;" id="reward-close">×</a>
    <span class="reward-title">
        <i class="icon icon-quote-left"></i>
        请我吃糖~
        <i class="icon icon-quote-right"></i>
    </span>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/images/wechat_code.jpg" alt="打赏二维码">
        </div>
        <div class="reward-select">
            
            <label class="reward-select-item checked" data-id="wechat" data-wechat="/images/wechat_code.jpg">
                <img class="reward-select-item-wechat" src="/images/wechat.png" alt="微信">
            </label>
            
            
            <label class="reward-select-item" data-id="alipay" data-alipay="/images/alipay_code.jpg">
                <img class="reward-select-item-alipay" src="/images/alipay.png" alt="支付宝">
            </label>
            
        </div>
    </div>
</div>


        
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://example.com/2021/05/16/Nodejs/&title=《Nodejs》 — ������&pic=http://example.comimages/logo.png" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://example.com/2021/05/16/Nodejs/&title=《Nodejs》 — ������&source=" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/2021/05/16/Nodejs/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Nodejs》 — ������&url=http://example.com/2021/05/16/Nodejs/&via=http://example.com" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://example.com/2021/05/16/Nodejs/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://example.com/2021/05/16/Nodejs/" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Node-js"><span class="post-toc-text">Node.js</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%E4%B9%A0node%EF%BC%9F"><span class="post-toc-text">1、为什么要学习node？</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BC%81%E4%B8%9A%E9%9C%80%E6%B1%82"><span class="post-toc-text">企业需求</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text"></span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91%E8%83%BD%E5%8A%9B"><span class="post-toc-text">基本的网站开发能力</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2%E3%80%81Node%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="post-toc-text">2、Node是什么？</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%B8%80%E8%88%AC%E5%90%8E%E7%AB%AF%E8%AF%AD%E8%A8%80%E6%98%AF%E4%BB%80%E4%B9%88"><span class="post-toc-text">一般后端语言是什么</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3%E3%80%81Node%E4%BB%8B%E7%BB%8D"><span class="post-toc-text">3、Node介绍</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84js"><span class="post-toc-text">浏览器中的js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Node%E4%B8%AD%E7%9A%84js"><span class="post-toc-text">Node中的js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#node%E7%89%B9%E7%82%B9"><span class="post-toc-text">node特点</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#node%E4%BB%8B%E7%BB%8D"><span class="post-toc-text">node介绍</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#node%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="post-toc-text">node预备知识</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%8E%A8%E8%8D%90%E4%B8%80%E4%BA%9B%E8%B5%84%E6%BA%90"><span class="post-toc-text">推荐一些资源</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%BF%99%E9%97%A8%E8%AF%BE%E7%A8%8B%E8%83%BD%E5%AD%A6%E5%88%B0%E5%95%A5"><span class="post-toc-text">这门课程能学到啥</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#B-S%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B"><span class="post-toc-text">B&#x2F;S编程模型</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%A8%A1%E5%9D%97%E5%8C%96%E7%BC%96%E7%A8%8B"><span class="post-toc-text">模块化编程</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Node%E5%B8%B8%E7%94%A8API"><span class="post-toc-text">Node常用API</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><span class="post-toc-text">异步编程</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Express-Web%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6"><span class="post-toc-text">Express Web开发框架</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#ECMAScript6"><span class="post-toc-text">ECMAScript6</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4%E3%80%81Node%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="post-toc-text">4、Node环境安装</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%85%88%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%AE%89%E8%A3%85node"><span class="post-toc-text">先查看是否已经安装node</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E4%B8%8B%E8%BD%BD"><span class="post-toc-text">下载</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%AE%89%E8%A3%85"><span class="post-toc-text">安装</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5%E3%80%81%E4%BD%BF%E7%94%A8Node%E6%89%A7%E8%A1%8Cjs%E8%84%9A%E6%9C%AC"><span class="post-toc-text">5、使用Node执行js脚本</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6%E3%80%81Hello%EF%BC%8CNode%EF%BC%81"><span class="post-toc-text">6、Hello，Node！</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#7%E3%80%81%E5%86%99%E6%96%87%E4%BB%B6%E5%92%8C%E7%AE%80%E5%8D%95%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="post-toc-text">7、写文件和简单的错误处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="post-toc-text">写入文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="post-toc-text">错误处理</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#8%E3%80%81%E7%AE%80%E5%8D%95%E7%9A%84http%E6%9C%8D%E5%8A%A1"><span class="post-toc-text">8、简单的http服务</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#9%E3%80%81%E5%8F%91%E9%80%81%E5%93%8D%E5%BA%94"><span class="post-toc-text">9、发送响应</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#10%E3%80%81%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E8%AF%B7%E6%B1%82%E8%B7%AF%E5%BE%84%E8%BF%94%E5%9B%9E%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE"><span class="post-toc-text">10、根据不同请求路径返回不同数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#11%E3%80%81node%E4%B8%AD%E7%9A%84js%E2%80%94%E2%80%94%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97"><span class="post-toc-text">11、node中的js——核心模块</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%8A%E5%9B%BE%E7%AE%AD%E5%A4%B4%E4%B8%8B%E9%9D%A2%E6%9C%89%E6%88%91%E4%BB%AC%E5%9C%A8%E7%94%A8%E7%9A%84HTTP%E6%A8%A1%E5%9D%97"><span class="post-toc-text">上图箭头下面有我们在用的HTTP模块</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#12%E3%80%81node%E4%B8%AD%E7%9A%84js%E2%80%94%E2%80%94%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F"><span class="post-toc-text">12、node中的js——模块系统</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#a-js%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="post-toc-text">a.js中的代码</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#b-js%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="post-toc-text">b.js中的代码</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%9C%A8node%E4%B8%AD%E6%B2%A1%E6%9C%89%E5%85%A8%E5%B1%80%E4%BD%9C%E7%94%A8%E5%9F%9F%EF%BC%8C%E5%8F%AA%E6%9C%89%E6%A8%A1%E5%9D%97%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="post-toc-text">在node中没有全局作用域，只有模块作用域</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E2%80%9D-%E2%80%9C%E4%B8%8D%E5%8F%AF%E4%BB%A5%E7%9C%81%E7%95%A5%E5%91%A2%EF%BC%9F"><span class="post-toc-text">为什么”.&#x2F;“不可以省略呢？</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%97%A2%E7%84%B6%E6%98%AF%E6%A8%A1%E5%9D%97%E4%BD%9C%E7%94%A8%E5%9F%9F%EF%BC%8C%E9%BB%98%E8%AE%A4%E9%83%BD%E6%98%AF%E5%B0%81%E9%97%AD%E7%9A%84%EF%BC%8C%E9%82%A3%E5%A6%82%E4%BD%95%E8%AE%A9%E6%A8%A1%E5%9D%97%E4%B9%8B%E9%97%B4%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1%E5%91%A2%EF%BC%9F"><span class="post-toc-text">既然是模块作用域，默认都是封闭的，那如何让模块之间进行通信呢？</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#a-js"><span class="post-toc-text">a.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#b-js"><span class="post-toc-text">b.js</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#13%E3%80%81ip%E5%9C%B0%E5%9D%80%E5%92%8C%E7%AB%AF%E5%8F%A3%E5%8F%B7%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="post-toc-text">13、ip地址和端口号的概念</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#14%E3%80%81%E7%AB%AF%E5%8F%A3%E5%8F%B7%E8%A1%A5%E5%85%85"><span class="post-toc-text">14、端口号补充</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#15%E3%80%81%E5%93%8D%E5%BA%94%E5%BC%8F%E5%86%85%E5%AE%B9%E7%B1%BB%E5%9E%8BContent-type"><span class="post-toc-text">15、响应式内容类型Content-type</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%A7%A3%E5%86%B3%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98"><span class="post-toc-text">解决乱码问题</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#16%E3%80%81%E5%8F%91%E9%80%81%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BB%A5%E5%8F%8AContent-type%E5%86%85%E5%AE%B9%E7%B1%BB%E5%9E%8B"><span class="post-toc-text">16、发送文件中的数据以及Content-type内容类型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#html%E6%96%87%E4%BB%B6%E6%80%8E%E4%B9%88%E5%8F%91%E9%80%81"><span class="post-toc-text">html文件怎么发送</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E5%9B%BE%E7%89%87%E6%80%8E%E4%B9%88%E8%AF%BB%EF%BC%9F"><span class="post-toc-text">问题：图片怎么读？</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#17%E3%80%81%E6%80%BB%E7%BB%93"><span class="post-toc-text">17、总结</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#18%E3%80%81%E5%8F%8D%E9%A6%88"><span class="post-toc-text">18、反馈</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#19%E3%80%81%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E5%8F%8A%E4%BB%A3%E7%A0%81%E4%B8%AD%E7%9A%84%E5%88%86%E5%8F%B7%E9%97%AE%E9%A2%98"><span class="post-toc-text">19、代码风格及代码中的分号问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC"><span class="post-toc-text">代码风格</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%88%86%E5%8F%B7%E9%97%AE%E9%A2%98"><span class="post-toc-text">分号问题</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#20%E3%80%81%E5%88%9D%E6%AD%A5%E5%AE%9E%E7%8E%B0Apache%E5%8A%9F%E8%83%BD"><span class="post-toc-text">20、初步实现Apache功能</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#21%E3%80%81Apache-2"><span class="post-toc-text">21、Apache-2</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#22%E3%80%81Apache%E5%AE%8C%E6%88%90%E7%9B%AE%E5%BD%95%E5%88%97%E8%A1%A8%E6%B8%B2%E6%9F%93"><span class="post-toc-text">22、Apache完成目录列表渲染</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#23%E3%80%81%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E4%B8%8D%E5%85%B3%E5%BF%83%E5%86%85%E5%AE%B9"><span class="post-toc-text">23、模板引擎不关心内容</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#24%E3%80%81%E5%9C%A8node%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="post-toc-text">24、在node中使用模板引擎</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#25%E3%80%81%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E8%A7%A3%E6%9E%90%E6%9B%BF%E6%8D%A2HTML"><span class="post-toc-text">25、使用模板引擎解析替换HTML</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#26%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93"><span class="post-toc-text">26、客户端渲染和服务端渲染</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#27%E3%80%81%E5%A4%84%E7%90%86%E7%BD%91%E7%AB%99%E4%B8%AD%E7%9A%84%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="post-toc-text">27、处理网站中的静态资源</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#app-js%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="post-toc-text">app.js中的代码</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%9C%A8index-html%E4%BB%A3%E7%A0%81"><span class="post-toc-text">在index.html代码</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#28%E3%80%81%E8%B5%B0%E9%80%9A%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC%E5%8A%A0%E5%85%A5404%E5%A4%84%E7%90%86"><span class="post-toc-text">28、走通页面跳转加入404处理</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#29%E3%80%81%E6%B8%B2%E6%9F%93%E8%AF%84%E8%AE%BA%E9%A6%96%E9%A1%B5"><span class="post-toc-text">29、渲染评论首页</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%AF%84%E8%AE%BA%E9%A1%B5%E4%BB%A3%E7%A0%81"><span class="post-toc-text">评论页代码</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%B8%B2%E6%9F%93"><span class="post-toc-text">渲染</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#30%E3%80%81%E5%A4%84%E7%90%86%E8%A1%A8%E5%8D%95get%E6%8F%90%E4%BA%A4"><span class="post-toc-text">30、处理表单get提交</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#31%E3%80%81%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E9%87%8D%E5%AE%9A%E5%90%91"><span class="post-toc-text">31、表单提交重定向</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#32%E3%80%81%E6%80%BB%E7%BB%93"><span class="post-toc-text">32、总结</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#33%E3%80%81node%E4%B8%AD%E7%9A%84console"><span class="post-toc-text">33、node中的console</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#34%E3%80%81%E5%8F%8D%E9%A6%88-each%E5%92%8CforEach"><span class="post-toc-text">34、反馈-each和forEach</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#35%E3%80%81%E5%8F%8D%E9%A6%88%E7%BB%93%E6%9D%9F"><span class="post-toc-text">35、反馈结束</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#36%E3%80%81%E5%A4%8D%E4%B9%A0"><span class="post-toc-text">36、复习</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#37%E3%80%81%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F-%E5%9F%BA%E6%9C%AC%E8%A7%84%E5%88%99"><span class="post-toc-text">37、模块系统-基本规则</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="post-toc-text">什么是模块化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CommonJs%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83"><span class="post-toc-text">CommonJs模块规范</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#38%E3%80%81%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%AF%BC%E5%87%BA%E7%9A%84%E4%BD%BF%E7%94%A8%E8%A7%84%E5%88%99"><span class="post-toc-text">38、加载和导出的使用规则</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#a-js%E4%BB%A3%E7%A0%81"><span class="post-toc-text">a.js代码</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#b-js%E4%BB%A3%E7%A0%81"><span class="post-toc-text">b.js代码</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%8A%A0%E8%BD%BDrequire"><span class="post-toc-text">加载require</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%AF%BC%E5%87%BAexports"><span class="post-toc-text">导出exports</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#39%E3%80%81exports%E5%92%8Cmodule-expots%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="post-toc-text">39、exports和module-expots的区别</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#40%E3%80%81%E5%A4%8D%E4%B9%A0"><span class="post-toc-text">40、复习</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#41%E3%80%81%E4%BC%98%E5%85%88%E4%BB%8E%E7%BC%93%E5%AD%98%E5%8A%A0%E8%BD%BD"><span class="post-toc-text">41、优先从缓存加载</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#42%E3%80%81require%E6%96%B9%E6%B3%95%E5%8A%A0%E8%BD%BD%E8%A7%84%E5%88%99"><span class="post-toc-text">42、require方法加载规则</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#43%E3%80%81%E5%8C%85%E8%AF%B4%E6%98%8E%E6%96%87%E4%BB%B6"><span class="post-toc-text">43、包说明文件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#44%E3%80%81npm%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="post-toc-text">44、npm常用命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="post-toc-text">常用命令:</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#45%E3%80%81%E8%A7%A3%E5%86%B3npm%E8%A2%AB%E5%A2%99%E9%97%AE%E9%A2%98"><span class="post-toc-text">45、解决npm被墙问题</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#46%E3%80%81express%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E8%A3%85"><span class="post-toc-text">46、express介绍和安装</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="post-toc-text">安装</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#express%E5%9F%BA%E6%9C%AC%E6%84%9F%E7%9F%A5"><span class="post-toc-text">express基本感知</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%BC%80%E6%94%BE%E8%B5%84%E6%BA%90"><span class="post-toc-text">开放资源</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%80%BB%E7%BB%93"><span class="post-toc-text">总结</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8F%8D%E9%A6%88-%E5%A4%8D%E4%B9%A0"><span class="post-toc-text">反馈+复习</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E8%B7%AF%E5%BE%84%E5%92%8C%E6%A8%A1%E5%9D%97%E6%A0%87%E8%AF%86%E8%B7%AF%E5%BE%84"><span class="post-toc-text">文件操作路径和模块标识路径</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#express-helloworld"><span class="post-toc-text">express-helloworld</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8nodemon%E5%B7%A5%E5%85%B7%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1"><span class="post-toc-text">使用nodemon工具自动重启服务</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#express%E4%B8%AD%E7%9A%84static-server%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1"><span class="post-toc-text">express中的static-server静态资源服务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="post-toc-text">路由</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9C%A8express%E4%B8%AD%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8art-template%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="post-toc-text">在express中配置使用art-template模板引擎</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8express%E9%87%8D%E5%86%99%E7%95%99%E8%A8%80%E6%9D%BF%E6%A1%88%E4%BE%8B"><span class="post-toc-text">使用express重写留言板案例</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9C%A8express%E4%B8%AD%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90%E8%A1%A8%E5%8D%95post%E8%AF%B7%E6%B1%82%E4%BD%93%E6%95%B0%E6%8D%AE"><span class="post-toc-text">在express中配置解析表单post请求体数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#crud-%E8%B5%B7%E6%AD%A5"><span class="post-toc-text">crud-起步</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BB%8E%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="post-toc-text">从文件中读取数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="post-toc-text">总结</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#crud-%E8%AE%BE%E8%AE%A1%E8%B7%AF%E7%94%B1"><span class="post-toc-text">crud-设计路由</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#-1"><span class="post-toc-text"></span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97%E7%9A%84%E6%8F%90%E5%8F%96"><span class="post-toc-text">路由模块的提取</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%A4%84%E7%90%86%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E5%8F%8A%E9%85%8D%E7%BD%AEbody-parser"><span class="post-toc-text">处理添加页面及配置body-parser</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%B0%81%E8%A3%85%E6%8F%90%E5%8F%96student%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%9D%97"><span class="post-toc-text">封装提取student数据操作模块</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%B0%81%E8%A3%85%E4%BF%9D%E5%AD%98%E5%AD%A6%E7%94%9F%E7%9A%84api"><span class="post-toc-text">封装保存学生的api</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%BC%BA%E8%B0%83%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="post-toc-text">强调回调函数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%8C%E6%88%90%E6%B8%B2%E6%9F%93%E7%BC%96%E8%BE%91%E5%AD%A6%E7%94%9F%E9%A1%B5%E9%9D%A2"><span class="post-toc-text">完成渲染编辑学生页面</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%9B%B4%E6%96%B0%E5%8A%9F%E8%83%BD"><span class="post-toc-text">实现更新功能</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%8C%E6%88%90%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD"><span class="post-toc-text">完成删除功能</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="post-toc-text">总结</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="post-toc-text">回调函数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ajax%E6%96%B9%E6%B3%95"><span class="post-toc-text">ajax方法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%85%B3%E4%BA%8EJavaScript%E6%A8%A1%E5%9D%97%E5%8C%96%E9%97%AE%E9%A2%98"><span class="post-toc-text">关于JavaScript模块化问题</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#package-lock%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="post-toc-text">package-lock文件的作用</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MongoDB%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%AE%89%E8%A3%85"><span class="post-toc-text">MongoDB介绍和安装</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#MongoDB%E4%BB%8B%E7%BB%8D"><span class="post-toc-text">MongoDB介绍</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MongoDB%E4%B8%8B%E8%BD%BD%E4%B8%8E%E5%AE%89%E8%A3%85"><span class="post-toc-text">MongoDB下载与安装</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%BC%80%E5%90%AF-%E5%85%B3%E9%97%ADMongoDB"><span class="post-toc-text">开启 关闭MongoDB</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%90%AF%E5%8A%A8"><span class="post-toc-text">启动</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%85%B3%E9%97%AD"><span class="post-toc-text">关闭</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="post-toc-text">连接数据库</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="post-toc-text">基本命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%80%9A%E8%BF%87node-js%E8%BF%9E%E6%8E%A5MongoDB"><span class="post-toc-text">通过node.js连接MongoDB</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%98%E6%96%B9%E7%9A%84mongodb%E5%8C%85"><span class="post-toc-text">使用官方的mongodb包</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8mongoose%E7%AC%AC%E4%B8%89%E6%96%B9"><span class="post-toc-text">使用mongoose第三方</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%87%8D%E6%96%B0%E8%AF%B4%E6%98%8EMongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E5%BF%B5"><span class="post-toc-text">重新说明MongoDB数据库概念</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#mongoose%E5%BC%80%E5%A7%8B"><span class="post-toc-text">mongoose开始</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE"><span class="post-toc-text">新增数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="post-toc-text">查询数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%92%8C%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="post-toc-text">删除数据和更新数据</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="post-toc-text">删除数据</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="post-toc-text">更新数据</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%8A%8ACRUD%E6%A1%88%E4%BE%8B%E6%94%B9%E4%B8%BAMongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC"><span class="post-toc-text">把CRUD案例改为MongoDB数据库版本</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%A6%96%E9%A1%B5%E6%B8%B2%E6%9F%93"><span class="post-toc-text">首页渲染</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%AD%A6%E7%94%9F"><span class="post-toc-text">添加学生</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%9B%B4%E6%96%B0%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF"><span class="post-toc-text">更新学生信息</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8Node%E6%93%8D%E4%BD%9CMySQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="post-toc-text">使用Node操作MySQL数据库</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1"><span class="post-toc-text">回调地狱</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Promise%E8%AF%AD%E6%B3%95API"><span class="post-toc-text">Promise语法API</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%B0%81%E8%A3%85Promise%E7%89%88%E6%9C%AC%E7%9A%84readFile"><span class="post-toc-text">封装Promise版本的readFile</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="post-toc-text">总结</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BA%86%E8%A7%A3"><span class="post-toc-text">了解</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CommonJS%E6%A8%A1%E5%9D%97%E7%9A%84%E7%89%B9%E7%82%B9%E5%A6%82%E4%B8%8B%E3%80%82"><span class="post-toc-text">CommonJS模块的特点如下。</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-module%E5%AF%B9%E8%B1%A1"><span class="post-toc-text">2.module对象</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#require%E5%91%BD%E4%BB%A4"><span class="post-toc-text">require命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="post-toc-text">基本用法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%8A%A0%E8%BD%BD%E8%A7%84%E5%88%99%E3%80%82"><span class="post-toc-text">加载规则。</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%A8%A1%E5%9D%97%E7%9A%84%E7%BC%93%E5%AD%98"><span class="post-toc-text">模块的缓存</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6"><span class="post-toc-text">模块的加载机制</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>
    

<nav id="article-nav">
  
    <a href="/2021/10/16/Java%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" id="article-nav-newer" class="article-nav-link-wrap">

      <span class="article-nav-title">
        <i class="fa fa-hand-o-left" aria-hidden="true"></i>
        
          Java基础语法
        
      </span>
    </a>
  
  
    <a href="/2021/05/16/VUE/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">VUE笔记</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>



    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2021 ZhangLichao<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "http://example.com",
      animate: true,
      isHome: false,
      share: true,
      reward: 1
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/life/">life</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/welcome/" style="font-size: 10px;">welcome</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="/">
                    <i class="fa fa-home"></i><span>首页</span>
                </a>
            </li>
            
            <li>
                <a  href="/archives">
                    <i class="fa fa-archive"></i><span>归档</span>
                </a>
            </li>
            
            <li>
                <a  href="/about">
                    <i class="fa fa-user"></i><span>关于我</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/welcome/" style="font-size: 10px;">welcome</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>

<script src="/js/search.js"></script>


<script src="/js/main.js"></script>



  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  
<script src="/js/particles.js"></script>








  
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">

  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  
<script src="/js/animate.js"></script>



  
<script src="/js/pop-img.js"></script>

  <script>
     $(".article-entry p img").popImg();
  </script>

  </div>
</body>
</html>